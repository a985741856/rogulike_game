{"version":3,"sources":["assets\\common-plugin\\Scripts\\GameItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { SubLocation } from \"./YZ_Constant\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameItem extends cc.Component {\r\n\r\n    /*\r\n    {\r\n        \"icon\": \"http://ff.td68x.com/xcx/ylyxhz/451m.png\",\r\n        \"name\": \"点亮它的色彩\",\r\n        \"path\": \"\",\r\n        \"qr_code\": \"\",\r\n        \"appid\": \"wx35562d816d9ed9fb\"\r\n    }\r\n    */\r\n    data: any = null;\r\n\r\n    icon: cc.Sprite = null;\r\n    labelName: cc.Label = null;\r\n    labelShadow: cc.Label = null;\r\n\r\n    _dataDirty: boolean = false;\r\n    _redPoint: cc.Node = null;\r\n    public _location: SubLocation = null;\r\n    mask: cc.Node = null;\r\n    _subNameLength: number = 4;\r\n\r\n    onLoad() {\r\n        this.mask = this.node.getChildByName(\"Mask\");\r\n        this.icon = this.mask.getChildByName(\"Icon\").getComponent(cc.Sprite);\r\n        this.labelName = this.node.getChildByName(\"Label\").getComponent(cc.Label);\r\n        this.labelShadow = this.node.getChildByName(\"LabelShadow\").getComponent(cc.Label);\r\n        if (this._location && (this._location == SubLocation.isYzBanner || this._location == SubLocation.isScrollbar || this._location == SubLocation.isMoreGame || this._location == SubLocation.isBoxInsertAd || this._location == SubLocation.isBeforGameOverAd)) {\r\n            this._redPoint = this.mask.getChildByName(\"redpoint\");\r\n            if (this.data && this.data.red && this.data.red != \"0\") {\r\n                if (this.data.red == \"1\") {\r\n                    this._redPoint.getComponent(\"YZ_ActionScale\").isRunAction = false;\r\n                }\r\n            } else {\r\n                this._redPoint && this._redPoint.destroy();\r\n            }\r\n        }\r\n    }\r\n\r\n    public init(data: any, location: SubLocation) {\r\n        this.data = data;\r\n        this._dataDirty = true;\r\n        this._location = location;\r\n        let checkSubString = [SubLocation.isBoxInsertAd, SubLocation.isBeforGameOverAd, SubLocation.isVerticalPanel]\r\n        if (checkSubString.indexOf(this._location) > -1) {\r\n            this._subNameLength = 6;\r\n        } else if (this._location == SubLocation.isMoreGame) {\r\n            this._subNameLength = 8;\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this._dataDirty) {\r\n            this._dataDirty = false;\r\n            this.updateItem();\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        if (!this.data) return;\r\n        this.node.on(cc.Node.EventType.TOUCH_END, (event: cc.Event) => {\r\n\r\n            if (PlatUtils.IsDouyin) {\r\n                utils.Tool_Douyin.showMoreGamesModal();\r\n                return;\r\n            }\r\n            this._postClickData(this.data.appid);\r\n            if (this.data.is_jump && this.data.is_jump == \"true\" && this.data.appid) {\r\n                utils.showLog(\"直接跳转!\", this.data.appid);\r\n                utils.navigateToMiniGame(this.data, (ret) => {\r\n                    if (ret) {\r\n                        // 上报数据\r\n                        if (this.data && this.data.appid) {\r\n                            this._postData(this.data.appid);\r\n                        }\r\n                    }\r\n                });\r\n            } else if (this.data.is_jump && this.data.is_jump == \"false\" && this.data.qr_code) {\r\n                if (PlatUtils.IsWechat) {\r\n                    utils.showLog(\"二维码跳转!\", this.data.qr_code);\r\n                    utils.wechatTool.previewImage(this.data.qr_code);\r\n                    // 上报数据\r\n                    if (this.data && this.data.appid) {\r\n                        this._postData(this.data.appid);\r\n                    }\r\n                } else {\r\n                    utils.showLog(\"不支持二维码跳转!\");\r\n                }\r\n            } else {\r\n                utils.showLog(\"没有is_jump直接跳转!\", this.data.appid);\r\n                if (this.data.appid) {\r\n                    utils.navigateToMiniGame(this.data, (ret) => {\r\n                        if (ret) {\r\n                            // 上报数据\r\n                            if (this.data.appid) {\r\n                                this._postData(this.data.appid);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.node.targetOff(this);\r\n    }\r\n\r\n\r\n\r\n    updateItem() {\r\n        if (this.data) {\r\n            if (this.data.name) {\r\n                let gameName: string = this.data.name;\r\n\r\n                if (this.data.name.length > this._subNameLength) {\r\n                    gameName = gameName.slice(0, this._subNameLength);\r\n                    gameName += \"...\";\r\n                }\r\n                this.labelName.string = gameName;\r\n                this.labelShadow.string = gameName;\r\n            }\r\n\r\n            if (this.data.icon) {\r\n                CompatibleTool.LoadRes(this.data.icon, (err, texture) => {\r\n                    if (!err && cc.isValid(this) && this.icon && this.icon.spriteFrame) {\r\n                        this.icon.spriteFrame = new cc.SpriteFrame(texture);\r\n                    }\r\n                });\r\n            }\r\n        } else {\r\n            this.mask.active = false;\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n      * 上报跳转成功\r\n      * @param appid \r\n      */\r\n    _postData(appid: string) {\r\n        utils.postDataByLocation(appid, this._location, 1);\r\n    }\r\n\r\n\r\n    /**\r\n     * 上报点击\r\n     * @param appid \r\n     */\r\n    _postClickData(appid: string) {\r\n        utils.postDataByLocation(appid, this._location, 0);\r\n    }\r\n}\r\n"]}