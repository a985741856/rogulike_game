{"version":3,"sources":["assets\\scripts\\Game\\bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport { NODATA } from \"dns\";\r\nimport { cocosz } from \"../Framework/CocosZ\";\r\nimport { ZindexLayer } from \"../Framework/Constant\";\r\nimport { gameMgr } from \"./gameMgr\";\r\nimport Person from \"./person\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bullet extends cc.Component {\r\n\r\n    @property()\r\n    bulletId: number = 0;\r\n\r\n    id: number = 1;\r\n\r\n    atk: number = 10;\r\n\r\n    atker: cc.Node = null\r\n\r\n    @property()\r\n    canMove: boolean = true;\r\n\r\n    @property({ tooltip: \"能否阻断\" })\r\n    canBreak: boolean = true;\r\n\r\n    @property({ tooltip: \"能否穿透敌人\" })\r\n    canPenetrate: boolean = false;\r\n\r\n    @property({ tooltip: \"能否穿透墙壁\" })\r\n    canWall: boolean = false;\r\n\r\n    @property(cc.Prefab)\r\n    boomEffect: cc.Prefab = null;\r\n\r\n    @property(cc.Prefab)\r\n    hitEffect: cc.Prefab = null;\r\n\r\n    @property({ type: cc.String, tooltip: \"子弹音效\" })\r\n    hitAudio: string = \"\";\r\n\r\n    @property({ tooltip: \"敌人受伤是否发出音效\" })\r\n    isHartMusic: boolean = true;\r\n\r\n    @property()\r\n    hitEffectType: number = 0;\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    @property()\r\n    hartInterval: number = 0;\r\n\r\n    @property({ tooltip: \"击中效果设置角度\" })\r\n    isHitEffectAngle: boolean = false;\r\n\r\n    @property({ tooltip: \"每帧设置角度\" })\r\n    isAngle: boolean = false;\r\n\r\n    @property({ tooltip: \"是否爆炸子弹\" })\r\n    isBoom: boolean = false;\r\n\r\n    @property({ tooltip: \"是否记录受伤者\" })\r\n    isRecord: boolean = true;\r\n\r\n    // 方向\r\n    dir: cc.Vec2 = null;\r\n\r\n    start() {\r\n        gameMgr && gameMgr.setMapTs.checkNode(this.node, true);\r\n        if (this.node.zIndex == 0) {\r\n            if (this.isBoom) {\r\n                this.node.zIndex = ZindexLayer.zindex_bomb;\r\n            }\r\n            else if (\"liewen\" === this.node.name) {\r\n                this.node.zIndex = ZindexLayer.zinedx_floorLiewen;\r\n            } else {\r\n                this.node.zIndex = ZindexLayer.zindex_bullet + this.bulletId;\r\n            }\r\n        }\r\n        // gameMgr\r\n        if (this.node.name == \"bullet_sd\" || this.node.name == \"bullet_hdl\") {\r\n            let box = this.node.getComponent(cc.BoxCollider)\r\n            if (box) {\r\n                cc.tween(box.size).to(0.3, { height: 550 }).start();\r\n                cc.tween(box.offset).to(0.3, { x: 700 }).start();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this._lastPos = null;\r\n    }\r\n\r\n    private _lastPos: cc.Vec2 = null;\r\n    protected lateUpdate(dt: number): void {\r\n        // 每帧设置角度\r\n        if (this.isAngle) {\r\n            if (this._lastPos) {\r\n                let div = this.node.getPosition().subSelf(this._lastPos);\r\n                if (false == div.equals(cc.Vec2.ZERO)) {\r\n                    this.node.angle = -cc.v2(div).signAngle(cc.v2(1, 0)) / Math.PI * 180;\r\n                    this._lastPos = this.node.getPosition();\r\n                }\r\n            } else {\r\n                this._lastPos = this.node.getPosition();\r\n            }\r\n        }else{\r\n            \r\n        }\r\n    }\r\n\r\n    // 已攻击对象\r\n    atkedArr: cc.Node[] = [];\r\n    onCollisionEnter(other: any, self: any) {\r\n        if (other.tag == 1) {\r\n            // console.log(other);\r\n            let ts = other.getComponent(Person)\r\n            if (ts.id == this.id) {\r\n                return;\r\n            }\r\n            // 能倍阻断并且不能穿透玩家\r\n            if (this.canBreak && !this.canPenetrate) {\r\n                this.node.destroy();\r\n            } else {\r\n                if (this.atkedArr.includes(other.node)) {\r\n                    return;\r\n                } else if (this.isRecord) {\r\n                    this.atkedArr.push(other.node);\r\n                }\r\n            }\r\n            // 击中效果\r\n            if (this.hitEffect && !cocosz.isPause) {\r\n                let node = cc.instantiate(this.hitEffect);\r\n                node.zIndex = ZindexLayer.zindex_effect_hit;\r\n                if (this.hitEffectType == 1) {\r\n                    node.parent = other.node;\r\n                    // 击中特效方向\r\n                    if (this.isHitEffectAngle) {\r\n                        node.angle = -cc.v2(this.dir).signAngle(cc.v2(1, 0)) / Math.PI * 180;\r\n                    }\r\n                }\r\n                else {\r\n                    let pos = this.node.getPosition();\r\n                    let dt = this.node.width;\r\n                    if (dt < 5) {\r\n                        let box = this.node.getComponent(cc.BoxCollider);\r\n                        if (box) {\r\n                            dt += box.offset.x;\r\n                        }\r\n                    }\r\n                    pos = pos.add(cc.v2(dt, 0).rotate(this.node.angle / 180 * Math.PI));\r\n                    node.parent = this.node.parent;\r\n                    node.setPosition(pos);\r\n                }\r\n                if (this.hitAudio) {\r\n                    gameMgr.playEffect(this.hitAudio, this.node);\r\n                }\r\n\r\n            }\r\n            // 爆炸效果\r\n            if (this.boomEffect) {\r\n                let boom = cc.instantiate(this.boomEffect)\r\n                boom.parent = this.node.parent;\r\n                boom.setPosition(this.node.getPosition());\r\n                boom.zIndex = ZindexLayer.zindex_bomb;\r\n                gameMgr.playEffect(\"explo\", boom);\r\n                let bullet = boom.getComponent(Bullet);\r\n                bullet.atk = this.atk;\r\n                bullet.atker = this.atker;\r\n                bullet.id = this.id;\r\n                bullet.dir = this.dir;\r\n                return;\r\n            }\r\n            // 血液效果\r\n            if (gameMgr.blood && self.world && self.world.points && self.world.points[0]) {\r\n                let blood: cc.Node = null;\r\n                blood = cc.instantiate(gameMgr.blood);\r\n                blood.parent = gameMgr.map;\r\n                blood.zIndex = ZindexLayer.zindex_blood;;\r\n                let pos: cc.Vec2 = blood.parent.convertToNodeSpaceAR(cc.v2(self.world.points[0].x, self.world.points[0].y));\r\n                if (this.dir) {\r\n                    let angle = -cc.v2(this.dir).signAngle(cc.v2(0, 1)) / Math.PI * 180;\r\n                    blood.angle = angle;\r\n                }\r\n                blood.setPosition(pos);\r\n            }\r\n            // 击退\r\n            if (this.isBoom) {\r\n                let dir = other.node.getPosition().subSelf(this.node.getPosition()).normalizeSelf();\r\n                // 方向为0，随机方向\r\n                if (dir.equals(cc.Vec2.ZERO)) {\r\n                    dir = cc.v2(1, 0).rotateSelf(2 * Math.PI * Math.random());\r\n                }\r\n                this.dir = dir.mulSelf(3);\r\n            } else if (!this.canMove && this.dir && this.dir.mag() < 2) {\r\n                this.dir.normalizeSelf().mulSelf(2);\r\n            }\r\n            // 敌人受伤\r\n            ts.hart(this.atk, this.atker, this.dir, this.isHartMusic);\r\n            if (this.hartInterval) {\r\n                this.schedule(() => {\r\n                    if (ts && ts.isValid && this.atkedArr.includes(ts.node)) {\r\n                        ts.hart(this.atk, this.atker, this.dir, this.isHartMusic);\r\n                    }\r\n                }, this.hartInterval)\r\n            }\r\n        }\r\n        // 障碍物\r\n        else if (other.tag == 5) {\r\n            // 爆炸效果\r\n            if (this.boomEffect) {\r\n                let boom = cc.instantiate(this.boomEffect)\r\n                boom.parent = this.node.parent;\r\n                boom.setPosition(this.node.getPosition());\r\n                let bullet = boom.getComponent(Bullet);\r\n                bullet.atk = this.atk;\r\n                bullet.atker = this.atker;\r\n                bullet.id = this.id;\r\n                gameMgr.playEffect(\"explo\", boom);\r\n            }\r\n            // 销毁子弹\r\n            if (this.canBreak && !this.canWall) {\r\n                let pos = this.node.getPosition();\r\n                let dt = this.node.width;\r\n                if (dt < 5) {\r\n                    let box = this.node.getComponent(cc.BoxCollider);\r\n                    if (box) { dt += box.offset.x; }\r\n                }\r\n                pos = pos.add(cc.v2(dt, 0).rotate(this.node.angle / 180 * Math.PI));\r\n\r\n                if (this.hitEffect && this.hitEffectType != 1) {\r\n                    let node = cc.instantiate(this.hitEffect);\r\n                    node.parent = this.node.parent;\r\n                    node.setPosition(pos);\r\n                    node.zIndex = ZindexLayer.zindex_effect_hit;\r\n                }\r\n                else {\r\n                    let node = cc.instantiate(gameMgr.spark);\r\n                    node.parent = this.node.parent;\r\n                    node.setPosition(pos);\r\n                    node.zIndex = ZindexLayer.zindex_effect_spark;\r\n                }\r\n                this.node.destroy();\r\n            }\r\n        }\r\n    }\r\n}"]}