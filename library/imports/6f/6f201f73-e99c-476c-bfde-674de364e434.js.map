{"version":3,"sources":["assets\\common-plugin\\Scripts\\RewardBoxPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\nimport YZ_Constant, { BannerLocation, YZ_Reward } from \"./YZ_Constant\";\nimport AldUtils from \"./AldUtils\";\nimport PlatUtils from \"./PlatUtils\";\nimport YZ_LocalStorage from \"./YZ_LocalStorage\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n\n/**\n * 五倍奖励宝箱\n */\n@ccclass\nexport default class RewardBoxPanel extends cc.Component {\n\n    @property(cc.Node)\n    checked: cc.Node = null\n\n    @property(cc.Node)\n    doubleBtn: cc.Node = null\n\n    @property(cc.Node)\n    tripleVideoBtn: cc.Node = null\n\n    @property(cc.Node)\n    tripleBtn: cc.Node = null\n\n    @property(cc.Label)\n    goldLabel: cc.Label = null\n\n    @property(cc.Node)\n    tirpNode: cc.Node = null\n\n\n    @property(cc.Node)\n    light: cc.Node = null\n\n    @property(cc.Node)\n    panel: cc.Node = null\n\n    @property(cc.Node)\n    closeBtn: cc.Node = null\n\n\n    /**\n     * 奖励回调\n     */\n    rewardCallFunc: Function = null;\n\n    /**\n     * 奖励值\n     */\n    rewardValue: number = 0;\n\n\n\n    private set boxGetRewardCount(value: number) {\n        this._boxGetRewardCount = value;\n        YZ_LocalStorage.setItem(YZ_Constant.ST_GET_BOX_REWARD_COUNT, value + '');\n    }\n\n    _boxGetRewardCount: number = 0;\n\n    private get boxGetRewardCount() {\n        return this._boxGetRewardCount;\n    }\n\n\n    onLoad() {\n        if (utils.otherConfig && utils.otherConfig.group) {\n            this.node.group = utils.otherConfig.group;\n        }\n\n        this.rewardCallFunc = utils.rewardCallFunc;\n\n        this.rewardValue = utils.rewardValue;\n\n        if (cc.winSize.height < cc.winSize.width) {\n            utils.adManager.HideBanner(BannerLocation.Game);\n        } else {\n            utils.adManager.ShowBanner(BannerLocation.Game);\n        }\n        this.panel.scale = 0;\n\n        this._boxGetRewardCount = YZ_LocalStorage.getItem(YZ_Constant.ST_GET_BOX_REWARD_COUNT) || 0;\n        // let result = utils.controView(ViewLocation.box);\n        // this.checked.active = result.isSelect;\n        // this.tripLabel.string = result.msg;\n        // if (result.btnType) {\n        //     this.btnLabel.string = \"领取五倍奖励\"\n        // } else {\n        //     this.btnLabel.string = \"领取奖励\"\n        // }\n\n        AldUtils.SendEvent(\"奖励宝箱显示成功！\");\n        this.goldLabel.string = \"/\" + this.rewardValue.toString();\n    }\n\n    onEnable() {\n        utils.showSkipBtn(this.closeBtn, true);\n        let ratio: number = 1;\n        if (cc.winSize.height < cc.winSize.width) {\n            // 横屏游戏\n            ratio = cc.winSize.width / 1920 * 0.6;\n        } else {\n            ratio = cc.winSize.width / 1080;\n        }\n        if (PlatUtils.IsTest) {\n            utils.ServerConfig.reward_box_change_count = 5;\n        }\n        this.panel.runAction(cc.sequence(cc.scaleTo(0.3, ratio).easing(cc.easeBackOut()), cc.callFunc(() => {\n\n            let changeCount = utils.ServerConfig.reward_box_change_count ? parseInt(utils.ServerConfig.reward_box_change_count) : 0;\n\n            if (utils.ServerConfig.reward_box_change_count != undefined && this.boxGetRewardCount >= changeCount) {\n                this.tripleVideoBtn.active = true;\n                this.tripleBtn.active = false\n                utils.showScaleAction(this.tripleVideoBtn, this.doubleBtn, true, true);\n            } else {\n                this.tripleVideoBtn.active = false;\n                utils.showScaleAction(this.tripleBtn, null, false, true);\n            }\n            this.light.runAction(cc.rotateBy(3, +360).repeatForever())\n        })));\n    }\n\n\n    onDestroy() {\n        utils.adManager.HideBanner(BannerLocation.Game)\n        if (utils.rewardBoxPanelCloseFunc) {\n            utils.rewardBoxPanelCloseFunc();\n            utils.rewardBoxPanelCloseFunc = null;\n        } else {\n            utils.rewardCloseFunc && utils.rewardCloseFunc();\n            utils.rewardCloseFunc = null;\n        }\n\n    }\n\n    onClose() {\n        this.panel.runAction(cc.sequence(cc.scaleTo(0.3, 0).easing(cc.easeBackIn()), cc.callFunc(() => {\n            this.node.destroy();\n        })));\n    }\n\n    // /**\n    // * 初始化事件回调\n    // * @param closeCallFunc \n    // * @param rewardCallFunc \n    // */\n    // init(closeCallFunc: Function, rewardCallFunc: Function, reward: number) {\n    //     this.closeCallFunc = closeCallFunc;\n    //     this.rewardCallFunc = rewardCallFunc;\n    //     this.rewardValue = reward;\n    // }\n\n\n    onPlayVideo() {\n        utils.adManager.ShowVideo((ret, msg) => {\n            if (ret) {\n                utils.showMsg(`获得${this._multiple}倍奖励! +${this.rewardValue * this._multiple}`);\n                this.rewardValue = this.rewardValue * this._multiple;\n                this.boxGetRewardCount++;\n                let result: YZ_Reward = new YZ_Reward();\n                result.rewardValue = this.rewardValue;\n                if (this.rewardCallFunc) {\n                    this.rewardCallFunc(result);\n                }\n                this.onClose();\n                AldUtils.SendEvent(\"宝箱获取奖励成功！\");\n            } else {\n                utils.showMsg(msg ? msg : \"视频广告播放失败！\");\n                AldUtils.SendEvent(\"宝箱视频播放失败！\");\n            }\n        })\n    }\n\n\n    _multiple: number = 1;\n    /**\n     * 领取金币\n     */\n    onGetGold(event, data) {\n        this._multiple = parseInt(data);\n        switch (event.target.name) {\n\n            case \"BtnTripleVideo\":\n                AldUtils.SendEvent(\"点击宝箱视频获取按钮！\");\n                this.onPlayVideo();\n                break;\n            case \"BtnDouble\":\n            case \"BtnTriple\":\n                AldUtils.SendEvent(\"点击宝箱普通获取按钮！\");\n                utils.showMsg(`获得${this._multiple}倍奖励! +${this.rewardValue * this._multiple}`);\n                this.boxGetRewardCount++;\n                if (this.rewardCallFunc) {\n                    let result: YZ_Reward = new YZ_Reward();\n                    result.rewardValue = this.rewardValue * this._multiple;\n                    this.rewardCallFunc(result);\n                }\n                this.onClose();\n                break;\n        }\n    }\n\n}\n"]}