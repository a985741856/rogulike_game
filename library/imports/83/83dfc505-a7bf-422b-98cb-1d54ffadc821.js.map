{"version":3,"sources":["assets\\scripts\\UI\\UIWeaponLevelPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"../../common-plugin/Scripts/Utils\";\r\nimport { cocosz } from \"../Framework/CocosZ\";\r\nimport { PanelName } from \"../Framework/Constant\";\r\nimport Msg from \"../Framework/Msg\";\r\nimport UIPage from \"../Framework/UIPage\";\r\nimport GameDate from \"../Game/gameDate\";\r\nimport Weapon from \"../Game/weapon\";\r\n// @ts-ignore\r\nconst i18n = require('LanguageData');\r\n\r\nconst { ccclass } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class UIWeaponLevelPanel extends UIPage {\r\n\r\n    private _panel: cc.Node = null;\r\n\r\n    weapon: cc.Sprite = null;\r\n\r\n    weaponId: number = 0;\r\n    isRange: boolean = true;\r\n\r\n    constructor() {\r\n        super(PanelName.UIWeaponLevelPanel);\r\n        this.isValid() && this.onLoad();\r\n    }\r\n\r\n    protected onLoad() {\r\n        this._panel = this._page.getChildByName(\"Panel\");\r\n        this.weapon = this._panel.getChildByName(\"weapon\").getComponent(cc.Sprite);\r\n\r\n        let btnNames: string[] = [\"BtnPass\", \"BtnVideo\"];\r\n        for (let i = 0; i < btnNames.length; i++) {\r\n            let btn: cc.Node = cc.find(btnNames[i], this._panel);\r\n            if (btn) {\r\n                btn.on(cc.Node.EventType.TOUCH_END, this._onBtnClickedHandler, this);\r\n            }\r\n        }\r\n    }\r\n    protected onOpen() {\r\n        utils.SendEvent(\"页面-武器升级\");\r\n        // 暂停游戏逻辑\r\n        cocosz.pauseCount++;\r\n        let weaponName = \"\";\r\n        let level = 0;\r\n        let rangeLevel = cocosz.dataMgr.getGunInfo(cocosz.dataMgr.CurRange).Level;\r\n        let meleeLevel = cocosz.dataMgr.getGunInfo(cocosz.dataMgr.CurMelee).Level;\r\n        if (rangeLevel < 3) {\r\n            // 显示远程\r\n            this.isRange = true;\r\n            this.weaponId = cocosz.dataMgr.CurRange;\r\n            weaponName = Weapon.WeaponName[this.weaponId];\r\n            level = rangeLevel;\r\n            this.weapon.spriteFrame = cocosz.resMgr.getRes(\"w_\" + weaponName, cc.SpriteFrame);\r\n        } else if (meleeLevel < 3) {\r\n            // 显示近程\r\n            this.isRange = false;\r\n            this.weaponId = cocosz.dataMgr.CurMelee;\r\n            weaponName = Weapon.WeaponName[this.weaponId]\r\n            level = meleeLevel;\r\n            this.weapon.spriteFrame = cocosz.resMgr.getRes(\"w_\" + weaponName, cc.SpriteFrame);\r\n        } else {\r\n            // 直接关闭\r\n            cocosz.uiMgr.closePanel(PanelName.UIWeaponLevelPanel);\r\n            return;\r\n        }\r\n        // 显示数据\r\n        let info = GameDate.Weapon[weaponName]\r\n        let txt1 = cc.find(\"kuang/txt1\", this._panel);\r\n        if (txt1) {\r\n            let richText = txt1.getComponent(cc.RichText);\r\n            if (richText) {\r\n                let curNum = info.atk[level];\r\n                let nextNum = info.atk[3];\r\n                let difNum = nextNum - curNum;\r\n                richText.string = `<outline color=black width=2><color=white>${i18n.t(\"try.gjl\") + \": \" + curNum}</c><color=green}>${difNum > 0 ? (\" +\" + difNum) : \"\"}</c></outline>`;\r\n            }\r\n        }\r\n        let txt2 = cc.find(\"kuang/txt2\", this._panel);\r\n        if (txt2) {\r\n            let richText = txt2.getComponent(cc.RichText);\r\n            if (richText) {\r\n                let curNum = 1 / info.atkSpeed[level];\r\n                let nextNum = 1 / info.atkSpeed[3];\r\n                let difNum = nextNum - curNum;\r\n                richText.string = `<outline color=black width=2><color=white>${i18n.t(\"try.gjpl\") + \": \" + curNum}</c><color=green}>${difNum > 0 ? (\" +\" + difNum) : \"\"}</c></outline>`;\r\n            }\r\n        }\r\n        let txt3 = cc.find(\"kuang/txt3\", this._panel);\r\n        if (txt3) {\r\n            let richText = txt3.getComponent(cc.RichText);\r\n            if (richText) {\r\n                let curNum = info.atkRange;\r\n                richText.string = `<outline color=black width=2><color=white>${i18n.t(\"try.gjfw\") + \": \" + curNum}</c></outline>`;\r\n            }\r\n        }\r\n        let txt4 = cc.find(\"kuang/txt4\", this._panel);\r\n        if (txt4) {\r\n            let richText = txt4.getComponent(cc.RichText);\r\n            if (richText) {\r\n                let curNum = info.bulletTotal[level];\r\n                let nextNum = info.bulletTotal[3];\r\n                let difNum = nextNum - curNum;\r\n                richText.string = `<outline color=black width=2><color=white>${i18n.t(\"try.dyl\") + \": \" + (this.isRange ? curNum : \"♾\")}</c><color=green}>${difNum > 0 ? (\" +\" + difNum) : \"\"}</c></outline>`;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onClose() {\r\n        cocosz.gameMgr.gameStart(cocosz.curLevel);\r\n    }\r\n\r\n    /**\r\n     * 所有按钮点击事件\r\n     * @param event \r\n     * @param data \r\n     */\r\n    private async _onBtnClickedHandler(event: cc.Event, data: any) {\r\n        //播放按钮点击音效\r\n        await cocosz.audioMgr.playBtnEffect().catch();\r\n        switch (event.target.name) {\r\n            case \"BtnPass\": {\r\n                cocosz.uiMgr.closePanel(PanelName.UIWeaponLevelPanel);\r\n                break;\r\n            }\r\n            case \"BtnVideo\": {\r\n                utils.SendEvent(\"视频-弹窗武器升级-播放\")\r\n                cocosz.watchAD(() => {\r\n                    // 视频成功\r\n                    utils.SendEvent(\"视频-弹窗武器升级-成功\")\r\n                    let info = cocosz.dataMgr.getGunInfo(this.weaponId);\r\n                    info.Level = 3;// 升到最高级别\r\n                    cocosz.dataMgr.setGunInfo(this.weaponId, info);\r\n                    Msg.Show(i18n.t(\"msg.sjcg\"));//升级成功\r\n                    cocosz.uiMgr.closePanel(PanelName.UIWeaponLevelPanel);\r\n                }, () => {\r\n                    // 视频失败\r\n                    utils.SendEvent(\"视频-弹窗武器升级-失败\")\r\n                    cocosz.uiMgr.closePanel(PanelName.UIWeaponLevelPanel);\r\n                })\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}