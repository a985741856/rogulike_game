{"version":3,"sources":["assets\\common-plugin\\Scripts\\AdAgentIOS.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AdAgent from \"./AdAgent\";\r\nimport { BannerLocation, BannerLocationToString } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst ST_JNIMessage: string = \"JNIMessage\";\r\nconst ST_VideoCallback: string = \"VideoCallback\";\r\n\r\n@ccclass\r\nexport default class AdAgentIOS extends AdAgent {\r\n\r\n    private _className: string = \"JNIHelper\";\r\n\r\n    private _videoCallback: Function = null;\r\n\r\n\r\n    public get ServerConfig() {\r\n        return utils.Tool_IOS.ServerConfig;\r\n    }\r\n\r\n\r\n    public Init() {\r\n        if (PlatUtils.IsNativeIOS) {\r\n\r\n            cc.game.on(ST_JNIMessage, (event: any) => {\r\n                if (event.type == ST_VideoCallback) {\r\n                    if (this._videoCallback) {\r\n                        if (!event.ret) {\r\n                            this._videoCallback(event.ret, event.message ? event.message : \"视频播放失败！\");\r\n                        } else {\r\n                            this._videoCallback(event.ret);\r\n                        }\r\n                    }\r\n\r\n                }\r\n            });\r\n\r\n\r\n        }\r\n    }\r\n\r\n\r\n    _showBannerTimerId: number = 0;\r\n\r\n    public ShowBanner(location: BannerLocation = BannerLocation.Home, args: any = null) {\r\n        if (PlatUtils.IsNativeIOS) {\r\n            utils.showLog(\"AdAgentNative ShowBanner\");\r\n\r\n            // let interval: number = 18;\r\n            // if (this.ServerConfig && this.ServerConfig.refresh_ad_time) {\r\n            //     interval = this.ServerConfig.refresh_ad_time;\r\n            // }\r\n\r\n            // try {\r\n            jsb.reflection.callStaticMethod(this._className, \"showBanner:\", BannerLocationToString(location));\r\n            // } catch (error) {\r\n            //     utils.showLog(error);\r\n            // }\r\n\r\n            // clearInterval(this._showBannerTimerId);\r\n            // this._showBannerTimerId = setInterval(function () {\r\n            //     utils.showLog(`定时刷新显示Banner广告！location:${location}; args:${JSON.stringify(args)}; 间隔时间:${interval}`);\r\n            //     this.ShowBanner(location, args);\r\n            // }.bind(this), interval * 1000);\r\n\r\n        }\r\n    }\r\n\r\n\r\n    public HideBanner(location: BannerLocation = BannerLocation.Home) {\r\n        clearInterval(this._showBannerTimerId);\r\n        jsb.reflection.callStaticMethod(this._className, \"hideBanner:\", BannerLocationToString(location));\r\n    }\r\n\r\n\r\n\r\n    public ShowInterstitial() {\r\n        if (PlatUtils.IsNativeIOS) {\r\n            try {\r\n                let delayShowTime = 1;\r\n                if (this.ServerConfig && this.ServerConfig.intersititia_delay_show_time) {\r\n                    delayShowTime = this.ServerConfig.intersititia_delay_show_time;\r\n                }\r\n                utils.showLog(\"AdAgentNative ShowInterstitial 延迟\", delayShowTime, \"秒调用！\");\r\n\r\n                utils.delayCall(() => {\r\n                    jsb.reflection.callStaticMethod(this._className, \"showInterstitial\");\r\n                }, delayShowTime);\r\n            } catch (error) {\r\n                utils.showLog(error);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    public ShowVideo(callback: Function) {\r\n        if (PlatUtils.IsNativeIOS) {\r\n            utils.showLog(\"AdAgentNative ShowVideo\");\r\n            this._videoCallback = callback;\r\n            try {\r\n                jsb.reflection.callStaticMethod(this._className, \"showVideo\");\r\n            } catch (error) {\r\n                utils.showLog(error);\r\n                if (callback) {\r\n                    callback(false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public showFullScreenVideo(callback?: Function) {\r\n        if (PlatUtils.IsNativeIOS) {\r\n            utils.showLog(\"AdAgentNative ShowVideo\");\r\n            this._videoCallback = callback;\r\n            try {\r\n                jsb.reflection.callStaticMethod(this._className, \"showFullScreenVideo\");\r\n            } catch (error) {\r\n                utils.showLog(error);\r\n                if (callback) {\r\n                    callback(false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class NativeIosCallBack {\r\n\r\n    /**\r\n     *  1：播放完成\r\n     *  2：播放失败\r\n     *  3：无广告\r\n     * \r\n     */\r\n    public static videoCallBack(result: string, msg: string) {\r\n        utils.showLog(\"视频广告回调函数 ------>#result=\" + result + \" #msg=\" + msg ? msg : \"\");\r\n        if (result == \"1\") {\r\n            //播放成功\r\n            cc.game.emit(ST_JNIMessage, { type: ST_VideoCallback, ret: true });\r\n        } else {\r\n            //播放失败\r\n            cc.game.emit(ST_JNIMessage, { type: ST_VideoCallback, ret: false, message: msg });\r\n        }\r\n    }\r\n}\r\nwindow[\"NativeIosCallBack\"] = NativeIosCallBack;\r\n"]}