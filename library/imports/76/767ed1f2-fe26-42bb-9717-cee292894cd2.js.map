{"version":3,"sources":["assets\\common-plugin\\Scripts\\AdAgentKwai.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AdAgent from \"./AdAgent\";\r\nimport { BannerLocation } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class AdAgentKwai extends AdAgent {\r\n\r\n    _sysData: any = null;\r\n    _bannerAd: any = null;\r\n    _videoAd: any = null;\r\n    _videoCallback: Function = null;\r\n    _isVideoShow: boolean = false;\r\n    _isVideoLoaded: boolean = false;\r\n    //@ts-ignore\r\n    kwaigame: any = window.kwaigame;\r\n    canShowVideo: boolean = false;\r\n    public Init() {\r\n        if (PlatUtils.IsKwai) {\r\n            // this.kwaigame.getSystemInfo({\r\n            //     response: (result) => {\r\n            //         this._sysData = result;\r\n            //         utils.showLog(\"快手>>>获取系统信息:\" + JSON.stringify(result));\r\n            //     }\r\n            // });\r\n            // utils.showLog(this.kwaigame.isSupport({ feature: this.kwaigame.Support.features.RewardVideo }) + \"<<<<<\");\r\n            // this.canShowVideo = this.kwaigame.isSupport({ feature: this.kwaigame.Support.features.RewardVideo });\r\n            // utils.showLog(`当前平台：${this.canShowVideo == true ? \"支持\" : \"不支持\"}视频广告！`);\r\n            // if (this.canShowVideo) {\r\n            utils.registerServerInitEvent(() => {\r\n                this._initVideoAd();\r\n            }, this)\r\n            // }\r\n        }\r\n    }\r\n\r\n\r\n    public ShowBanner(location: BannerLocation = BannerLocation.Home, args: any = null) {\r\n        utils.showLog(\"快手平台没有banner广告！\");\r\n    }\r\n\r\n    /**\r\n    * 显示结算广告\r\n    * @param data 参数： closeBtn:\r\n    * statement_type \r\n    * 1:只显示小游戏插屏广告\r\n    * 2:只显示6个互推广告\r\n    * 3:显示插屏广告+6个互推\r\n    */\r\n    showStatementAds(): any {\r\n        let result: any = { \"type\": 0, \"node\": null };\r\n        let node: cc.Node = null;\r\n        let resType: number = 0;\r\n\r\n        utils.showLog(\"结算广告 >> 显示插屏广告+6个互推\");\r\n        this.ShowInterstitial();\r\n        node = utils.showCrossWidget6();\r\n        resType = 1;\r\n        result.type = resType;\r\n        result.node = node;\r\n        return result;\r\n    }\r\n\r\n    public HideBanner(location: BannerLocation = BannerLocation.Home) {\r\n\r\n    }\r\n\r\n\r\n    _interstitialAd: any = null;\r\n    public ShowInterstitial(location: BannerLocation = BannerLocation.Home) {\r\n        utils.showLog(\"显示快手插屏\");\r\n        if (utils.config.kwaiConfig.insertId) {\r\n            if (!this._interstitialAd) {\r\n                this._interstitialAd = this.kwaigame.createInterstitialAd({ adUnitId: utils.config.kwaiConfig.insertId })\r\n\r\n                this._interstitialAd.onError(err => {\r\n                    utils.showLog(\"插屏广告显示异常：\" + JSON.stringify(err));\r\n                })\r\n\r\n                this._interstitialAd.onClose(res => {\r\n                    utils.showLog(\"用户点击了【关闭广告】按钮\");\r\n                })\r\n            }\r\n            this._interstitialAd && this._interstitialAd.show()\r\n                .then(() => utils.showLog('插屏 广告显示成功！')).catch((err) => {\r\n                    utils.showLog(\"插屏 广告显示失败 >>\" + JSON.stringify(err));\r\n                })\r\n\r\n        } else {\r\n            utils.showLog(\"未配置插屏广告ID\");\r\n        }\r\n\r\n    }\r\n\r\n    public ShowVideo(callback: Function) {\r\n        if (PlatUtils.IsKwai) {\r\n            // 视频广告\r\n            if (this._videoCallback) {\r\n                return;\r\n            } else {\r\n                this._videoCallback = callback;\r\n            }\r\n            this._isVideoShow = true;\r\n\r\n            if (!this._videoAd) {\r\n                this._initVideoAd();\r\n                if (this._videoCallback) {\r\n                    this._videoCallback(false, \"激励视频加载失败!\");\r\n                    this._videoCallback = null;\r\n                }\r\n            } else {\r\n\r\n                this._videoAd.show({\r\n                    success: () => {\r\n                        utils.showLog(\"激励视频播放成功\");\r\n                    },\r\n                    fail: (error) => {\r\n                        utils.showLog(\"激励视频播放失败: \" + JSON.stringify(error));\r\n                        if (this._videoCallback) {\r\n                            this._videoCallback(false, \"激励视频加载失败!\");\r\n                            this._videoCallback = null;\r\n                        }\r\n                    }\r\n                })\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    _initVideoAd() {\r\n        if (!this._videoAd) {\r\n            let param: any = {};\r\n            param.adUnitId = utils.config.kwaiConfig.videoId;\r\n            this._videoAd = this.kwaigame.createRewardedVideoAd(param);\r\n            if (this._videoAd) {\r\n                utils.showLog(\"激励广告组件获取成功!\");\r\n                this._videoAd.onClose((result) => {\r\n                    utils.showLog(\"激励视频关闭回调: \" + JSON.stringify(result));\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(false, \"视频播放完毕才能够获取奖励!\");\r\n                        this._videoCallback = null;\r\n                    }\r\n                });\r\n                this._videoAd.onReward((result) => {\r\n                    utils.showLog(\"激励视频奖励回调: \" + JSON.stringify(result));\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(true, \"\");\r\n                        this._videoCallback = null;\r\n                    }\r\n\r\n                });\r\n            } else {\r\n                utils.showLog(\"激励广告组件获取失败\");\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n"]}