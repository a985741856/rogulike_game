{"version":3,"sources":["assets\\common-plugin\\Scripts\\NativeTryGameNode.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,iCAAgC;AAChC,yCAAoC;AACpC,+DAA0D;AAC1D,mDAA8C;AAExC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA+C,qCAAY;IAA3D;QAAA,qEAoIC;QAnIG,WAAK,GAAQ,IAAI,CAAC;QAClB,WAAK,GAAc,IAAI,CAAC;QACxB,gBAAU,GAAa,IAAI,CAAC;QAC5B,uBAAiB,GAAW,CAAC,CAAC,CAAC;QAC/B,eAAS,GAAQ,IAAI,CAAC;QACtB,YAAM,GAAW,CAAC,CAAC,CAAC;QACpB,cAAQ,GAAY,KAAK,CAAC,CAAC,UAAU;QACrC,cAAQ,GAAY,KAAK,CAAC;QAC1B,WAAK,GAAY,IAAI,CAAC;;IA2H1B,CAAC;IAzHG,kCAAM,GAAN;QACI,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QACrE,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5C,CAAC;IAED;;;;;;;;;;;;;;;;;;;OAmBG;IACI,gCAAI,GAAX,UAAY,IAAS;QACjB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAElB,aAAK,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAC1B,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;YACtC,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC;YACtD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACxB,IAAI,mBAAS,CAAC,QAAQ,EAAE;gBACpB,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC;aACnK;SACJ;aAAM;YACH,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SAC5B;IACL,CAAC;IAED;;OAEG;IACH,wCAAY,GAAZ;QACI,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC9B,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACrD,CAAC;IAED,oCAAQ,GAAR;QAAA,iBAoBC;QAnBG,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACjD,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,UAAC,KAAK;YAC9C,IAAI,KAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC;gBAAE,OAAO;YACnC,IAAI,SAAS,GAAG,KAAI,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC;YACtD,IAAI,IAAI,GAAG,KAAI,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;YACpD,IAAI,SAAS,EAAE;gBACX,SAAS,CAAC,aAAa,CAAC;oBACpB,IAAI,EAAE,IAAI;iBACb,CAAC,CAAC;gBACH,aAAK,CAAC,OAAO,CAAC,QAAQ,GAAG,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,OAAO,GAAG,IAAI,CAAC,CAAA;aACtF;YACD,aAAK,CAAC,gBAAgB,GAAG,IAAI,CAAC;YAC9B,aAAK,CAAC,WAAW,CAAC,MAAM,CAAC,KAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAA;YAExC,IAAI,aAAK,CAAC,kBAAkB,EAAE;gBAC1B,aAAK,CAAC,kBAAkB,CAAC,YAAY,CAAC,8BAAoB,CAAC,CAAC,IAAI,EAAE,CAAC;aACtE;QACL,CAAC,EAAE,IAAI,CAAC,CAAC;IACb,CAAC;IAED,qCAAS,GAAT;QACI,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC9B,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IAED,gCAAI,GAAJ;QAAA,iBA0CC;QAzCG,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO;QAE1B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QAErB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAC9B,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE;YACtC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;SACnB;QACD,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;QACnD,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YAC7B,IAAI,SAAS,GAAG,mBAAS,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;YACjI,IAAI,CAAC,SAAS,IAAI,mBAAS,CAAC,QAAQ,EAAE;gBAClC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAA;aAChE;YACD,wBAAc,CAAC,OAAO,CAAC,SAAS,EAAE,UAAC,GAAG,EAAE,OAAO;gBAC3C,IAAI,CAAC,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,KAAI,CAAC,IAAI,KAAI,CAAC,KAAK,EAAE;oBACxC,KAAI,CAAC,KAAK,CAAC,WAAW,GAAG,IAAI,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;oBACrD,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;oBAC5C,IAAI,KAAI,CAAC,QAAQ,EAAE;wBACf,aAAK,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;wBAChC,KAAI,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;wBACzB,KAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;qBACzB;iBACJ;gBACD,KAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YAC1B,CAAC,CAAC,CAAC;YAEH,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC;YACtD,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;YACpD,IAAI,SAAS,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE;gBACtC,SAAS,CAAC,YAAY,CAAC;oBACnB,IAAI,EAAE,IAAI;iBACb,CAAC,CAAC;gBACH,SAAS,CAAC,YAAY,GAAG,IAAI,CAAC;aACjC;SAEJ;aAAM;YACH,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;SACzB;QAED,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC,CAAC;IACxD,CAAC;IAnIgB,iBAAiB;QADrC,OAAO;OACa,iBAAiB,CAoIrC;IAAD,wBAAC;CApID,AAoIC,CApI8C,EAAE,CAAC,SAAS,GAoI1D;kBApIoB,iBAAiB","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\nimport PlatUtils from \"./PlatUtils\";\nimport NativeTryGamesWidget from \"./NativeTryGamesWidget\";\nimport CompatibleTool from \"./CompatibleTool\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class NativeTryGameNode extends cc.Component {\n    _data: any = null;\n    _icon: cc.Sprite = null;\n    _nameLabel: cc.Label = null;\n    _gameJumpInterval: number = -1;\n    _jumpInfo: any = null;\n    _index: number = -1;\n    _jumping: boolean = false; // 控制是否在跳转\n    _isFirst: boolean = false;\n    _mask: cc.Node = null;\n\n    onLoad() {\n        this._icon = cc.find(\"Mask/Icon\", this.node).getComponent(cc.Sprite);\n        this._mask = cc.find(\"Mask\", this.node);\n    }\n\n    /**\n     * \n     * @param data 交叉推广数据\n     * data:[{\"date\":{\n                    \"jump_list\": [\n                        {                                                        // 交叉推广挂件内容信息\n                            \"icon\": \"http://xcx.youletd.com/img/icon/fgdxc.png\",\n                            \"name\": \"翻滚的香肠大冒险\",\n                            \"path\": \"\",\n                            \"js_jump\": \"true\",\n                            \"qr_code\": \"http://xcx.youletd.com/img/qrcode/q_fgdxc.jpg\",\n                            \"appid\": \"wx2c4ed4218224b042\"\n                            }\n                        ]\n                    }\n                \"tryGameAd\":tryGameAd\n            }\n            ]\n     * \n     */\n    public init(data: any) {\n        this._data = data;\n\n        utils.showLog(\"原生抖动Node\");\n        if (this._data) {\n            this._jumpInfo = this._data.jump_list;\n            this._gameJumpInterval = this._data.jump_refresh_time;\n            this._isFirst = true;\n            this.node.active = true;\n            if (PlatUtils.IsHuaWei) {\n                this.node.getChildByName(\"source\").getComponent(cc.Label).string = this._jumpInfo[this._index].date[0].source ? this._jumpInfo[this._index].date[0].source : \"\";\n            }\n        } else {\n            this.node.active = false;\n        }\n    }\n\n    /**\n     * 跳转成功过后显示下一个\n     */\n    showNextItem() {\n        this.unscheduleAllCallbacks();\n        this.jump();\n        this.schedule(this.jump, this._gameJumpInterval);\n    }\n    _nativeAd;\n    onEnable() {\n        this.jump();\n        this.schedule(this.jump, this._gameJumpInterval);\n        this.node.on(cc.Node.EventType.TOUCH_START, (event) => {\n            if (this.node.opacity == 0) return;\n            let tryGameAd = this._jumpInfo[this._index].tryGameAd;\n            let adid = this._jumpInfo[this._index].date[0].adId;\n            if (tryGameAd) {\n                tryGameAd.reportAdClick({\n                    adId: adid\n                });\n                utils.showLog(\"抖动试玩上报\" + \"tryGameAd:\" + JSON.stringify(tryGameAd) + \"adid:\" + adid)\n            }\n            utils.nativeNeedChange = true;\n            utils.tryGameDate.splice(this._index, 1)\n\n            if (utils._nativeTryGameNode) {\n                utils._nativeTryGameNode.getComponent(NativeTryGamesWidget).init();\n            }\n        }, this);\n    }\n\n    onDisable() {\n        this.unscheduleAllCallbacks();\n        this.node.targetOff(this);\n    }\n\n    jump() {\n        if (this._jumping) return;\n\n        this._jumping = true;\n\n        this._index = this._index + 1;\n        if (this._index >= this._jumpInfo.length) {\n            this._index = 0;\n        }\n        let contentSize = this._icon.node.getContentSize();\n        if (this._jumpInfo[this._index]) {\n            let remoteUrl = PlatUtils.IsOPPO ? this._jumpInfo[this._index].date[0].iconUrlList[0] : this._jumpInfo[this._index].date[0].icon;\n            if (!remoteUrl || PlatUtils.IsHuaWei) {\n                remoteUrl = this._jumpInfo[this._index].date[0].imgUrlList[0]\n            }\n            CompatibleTool.LoadRes(remoteUrl, (err, texture) => {\n                if (!err && cc.isValid(this) && this._icon) {\n                    this._icon.spriteFrame = new cc.SpriteFrame(texture);\n                    this._icon.node.setContentSize(contentSize);\n                    if (this._isFirst) {\n                        utils.showLog(\"当前试玩第一次加载！！！！！\");\n                        this._mask.active = true;\n                        this._isFirst = false;\n                    }\n                }\n                this._jumping = false;\n            });\n\n            let tryGameAd = this._jumpInfo[this._index].tryGameAd;\n            let adid = this._jumpInfo[this._index].date[0].adId;\n            if (tryGameAd && !tryGameAd.isReportShow) {\n                tryGameAd.reportAdShow({\n                    adId: adid\n                });\n                tryGameAd.isReportShow = true;\n            }\n\n        } else {\n            this._jumping = false;\n        }\n\n        this.node.opacity == 0 && (this.node.opacity = 255);\n    }\n}\n"]}