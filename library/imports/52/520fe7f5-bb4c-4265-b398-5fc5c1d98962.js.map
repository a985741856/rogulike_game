{"version":3,"sources":["assets\\common-plugin\\Scripts\\AdAgentQTT.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AdAgent from \"./AdAgent\";\r\nimport { BannerLocation } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 趣头条广告组件\r\n */\r\n@ccclass\r\nexport default class AdAgentQTT extends AdAgent {\r\n\r\n    _bannerAd: any = null;\r\n    _videoAd: any = null;\r\n\r\n    _isInsertAdShow: boolean = false;\r\n    _isInsertAdLoaded: boolean = false;\r\n\r\n    _videoCallback: Function = null;\r\n    _isVideoLoaded: boolean = false;\r\n    _isVideoShow: boolean = false;\r\n\r\n    //@ts-ignore\r\n    qttGame = window.qttGame;\r\n\r\n\r\n    public get ServerConfig() {\r\n        if (utils._tool_QTT && utils._tool_QTT.ServerConfig) {\r\n            return utils._tool_QTT.ServerConfig;\r\n        }\r\n        return {};\r\n    }\r\n    /**\r\n     * 当视频广告资源不足\r\n     * 备选互动广告\r\n     * -- 平台强制添加 ---\r\n     */\r\n    options: any = null;\r\n\r\n\r\n    public Init() {\r\n        if (PlatUtils.IsQTT) {\r\n            if (!utils.config.qttconfig.showAd) {\r\n                cc.warn(\"广告开关关闭状态，所有广告不显示！要显示广告，请打开 CommonUtils 组件上VIVIO 配置下的广告开关！\");\r\n            }\r\n\r\n\r\n            // this.options = {};\r\n            // this.options.gametype = 1;//互动游戏类型，1(砸金蛋)  2(laba)  3(大转盘)\r\n            // this.options.rewardtype = 1;//互动广告框，只有 1\r\n            // this.options.data = {};\r\n            // this.options.data.title = \"获得奖励\";//互动抽中奖后的道具提示文字\r\n            // this.options.data.url = \"//newidea4-gamecenter-frontend.1sapp.com/game/prod/fkxxl_img/1.png\";//互动抽中奖后的道具图标(可选)\r\n            // this.options.callback = (res) => {\r\n            //     //回调函数\r\n            //     utils.showLog(\"播放互动广告>> #res=\", res)\r\n            //     if (res == 1) {\r\n            //         //播放完成，发放奖励\r\n            //         if (this._videoCallback) {\r\n            //             this._videoCallback(true, \"\");\r\n            //             this._videoCallback = null;\r\n            //         }\r\n            //     } else {\r\n            //         //res = 0    填充不足\r\n            //         if (this._videoCallback) {\r\n            //             this._videoCallback(false, \"广告加载失败,请稍后再试!\");\r\n            //             this._videoCallback = null;\r\n            //         }\r\n            //     }\r\n            // };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建互动广告\r\n     */\r\n    private createOption() {\r\n        let options: any = {};\r\n        options.gametype = (Math.floor(Math.random() * 3 + 1));//互动游戏类型，1(砸金蛋)  2(laba)  3(大转盘)\r\n        options.rewardtype = 1;//互动广告框，只有 1\r\n        options.data = {};\r\n        options.data.title = \"获得奖励\";//互动抽中奖后的道具提示文字\r\n        options.data.url = \"//newidea4-gamecenter-frontend.1sapp.com/game/prod/fkxxl_img/1.png\";//互动抽中奖后的道具图标(可选)\r\n        options.callback = (res) => {\r\n            //回调函数\r\n            utils.showLog(\"播放互动广告>> #res=\", res)\r\n            if (res == 1) {\r\n                //播放完成，发放奖励\r\n                if (this._videoCallback) {\r\n                    this._videoCallback(true, \"\");\r\n                    this._videoCallback = null;\r\n                }\r\n            } else {\r\n                //res = 0    填充不足\r\n                if (this._videoCallback) {\r\n                    this._videoCallback(false, \"广告加载失败,请稍后再试!\");\r\n                    this._videoCallback = null;\r\n                }\r\n            }\r\n        };\r\n        return options;\r\n    }\r\n\r\n    /**\r\n     * 显示banner\r\n     */\r\n    public ShowBanner(): void {\r\n        if (PlatUtils.IsQTT) {\r\n            if (!utils.config.qttconfig.showAd) {\r\n                return;\r\n            }\r\n            var options: any = {};\r\n            options.index = location; //\r\n\r\n            if (cc.winSize.height < cc.winSize.width) {\r\n                //横屏游戏\r\n                options.x = 1;\r\n                options.y = 1;\r\n                options.w = cc.winSize.width;\r\n                options.stage_width = cc.winSize.width;\r\n                options.stage_height = cc.winSize.height;\r\n            }\r\n            this.qttGame.showBanner(options);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 隐藏banner\r\n     */\r\n    public HideBanner(): void {\r\n        if (PlatUtils.IsQTT) {\r\n            if (!utils.config.qttconfig.showAd) {\r\n                return;\r\n            }\r\n            this.qttGame.hideBanner();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 暂时没有插屏广告\r\n     * @param location \r\n     */\r\n    public ShowInterstitial(location: BannerLocation = BannerLocation.Home): void {\r\n        // if (PlatUtils.IsQTT) {\r\n        //     if (!utils.config.qttconfig.showAd) {\r\n        //         return;\r\n        //     }\r\n        // }\r\n        return;\r\n    }\r\n\r\n    /**\r\n     * 显示互动直弹广告 \r\n     */\r\n    public showInteractiveAd(): void {\r\n        if (PlatUtils.IsQTT) {\r\n            if (!this.checkInsertAdShow()) {\r\n                return;\r\n            }\r\n            var options: any = {};\r\n            options.rewardtype = 1; //互动广告框，只有 1\r\n\r\n\r\n            utils.showLog(\"互动直弹时间间隔开始\");\r\n            this._insertLastShowTime = new Date().getTime();\r\n            this.qttGame.showHDReward(options);\r\n        }\r\n    }\r\n\r\n    _insertLastShowTime = 0;\r\n    /**\r\n     * 验证插屏是否能展示\r\n     * 2、时间限制 默认30秒\r\n     */\r\n    private checkInsertAdShow(): boolean {\r\n        let intervalTime = this.ServerConfig.intersititial_interval_time ? this.ServerConfig.intersititial_interval_time : 30;\r\n        let curTime: number = new Date().getTime();\r\n        let interval: number = (curTime - this._insertLastShowTime) / 1000;\r\n\r\n        utils.showLog(\"qtt服务器插屏间隔显示时间为：\" + intervalTime + \"秒！\");\r\n        utils.showLog(\"qtt插屏当前广告间隔时间：\" + interval + \"秒！\");\r\n\r\n        if (intervalTime > 0 && interval < intervalTime) {\r\n            utils.showLog(\"qtt插屏广告显示的间隔少于\" + intervalTime + \"秒。插屏不显示\");\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 显示视频广告\r\n     * @param callback 回调函数\r\n     */\r\n    public ShowVideo(callback: Function) {\r\n        if (PlatUtils.IsQTT) {\r\n            this._videoCallback = callback;\r\n\r\n            if (!utils.config.qttconfig.showAd) {\r\n                if (this._videoCallback) {\r\n                    this._videoCallback(false, \"暂无视频广告!\");\r\n                    this._videoCallback = null;\r\n                }\r\n                return;\r\n            }\r\n            this._isVideoShow = true;\r\n            let opt = this.createOption();\r\n            this.qttGame.showVideo((res) => {\r\n                utils.showLog(\"播放视频广告>> #res=\", res)\r\n                if (res == 1) {\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(true, \"\");\r\n                        this._videoCallback = null;\r\n                    }\r\n                } else {\r\n                    if (this._videoCallback) {\r\n                        if (res == 0) {\r\n                            this._videoCallback(false, \"广告加载失败,请稍后再试!\");\r\n                        } else if (res == 2) {\r\n                            this._videoCallback(false, \"视频播放完毕才能够获取奖励!\");\r\n                        }\r\n                        this._videoCallback = null;\r\n                    }\r\n                }\r\n            }, opt);\r\n        }\r\n    }\r\n\r\n\r\n}\r\n"]}