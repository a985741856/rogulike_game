{"version":3,"sources":["assets\\scripts\\Game\\setMap.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { cocosz } from \"../Framework/CocosZ\";\r\nimport { ZindexLayer } from \"../Framework/Constant\";\r\nimport { gameMgr } from \"./gameMgr\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class setMap extends cc.Component {\r\n    @property([cc.SpriteFrame])\r\n    dmmArr: cc.SpriteFrame[] = [];\r\n\r\n    dikuai: cc.Node = null;\r\n\r\n    protected onLoad(): void {\r\n        gameMgr.setMapTs = this;\r\n        // 躲猫猫图片\r\n        gameMgr.dmmArr = this.dmmArr;\r\n        // 地块\r\n        this.dikuai = this.node.getChildByName(\"dikuai\");\r\n        if (this.dikuai) {\r\n            this.dikuai.zIndex = cc.macro.MIN_ZINDEX;\r\n        }\r\n        // 获取坐标\r\n        if ([1, 2, 4].includes(cocosz.gameMode) && this.node.getChildByName(\"point\")) {\r\n            let point = this.node.getChildByName(\"point\");\r\n            for (let i = 0; i < point.childrenCount; i++) {\r\n                gameMgr.posList[i] = i;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        gameMgr.setMapTs = null;;\r\n    }\r\n\r\n    protected start(): void {\r\n        for (let i = 0; i < this.node.children.length; i++) {\r\n            // 初始zindex\r\n            const child = this.node.children[i];\r\n        }\r\n    }\r\n\r\n\r\n    time: number = -1;\r\n    lateUpdate() {\r\n        if (cocosz.isPause || gameMgr.isWin || gameMgr.isFail) return;\r\n        if (this.time++ % 30 == 0) {\r\n            this.checkAllNode();\r\n        }\r\n    }\r\n\r\n    mainCameraPos: cc.Vec2 = cc.Vec2.ZERO;\r\n    distanceX: number = 2500;\r\n    distanceY: number = 1500;\r\n    checkAllNode() {\r\n        if (gameMgr && gameMgr.mainCamereRootNode) {\r\n            this.mainCameraPos = gameMgr.mainCamereRootNode.getPosition();\r\n            this.distanceX = cc.winSize.width / 2 / gameMgr.mainCamera.zoomRatio + 500;\r\n            this.distanceY = cc.winSize.height / 2 / gameMgr.mainCamera.zoomRatio + 500;\r\n        }\r\n        // 地图节点\r\n        let excludeArr = [\"guide\", \"guidePath\", \"player\", \"colllider\", \"dikuai\", \"point\", \"itemPoint\", \"tree\", \"tipLayer\", \"jingyanLayer\", \"posLayer\",\"propLayer\"];\r\n        for (let i = 0; i < this.node.childrenCount; i++) {\r\n            let child = this.node.children[i];\r\n            if (excludeArr.includes(child.name) == false) {\r\n                this.checkNode(child)\r\n            }\r\n        }\r\n        // 地图地块\r\n        let dikuai = this.node.getChildByName(\"dikuai\");\r\n        if (dikuai) {\r\n            for (let i = 0; i < dikuai.childrenCount; i++) {\r\n                let child = dikuai.children[i];\r\n                this.checkNode(child);\r\n            }\r\n        }\r\n    }\r\n\r\n    checkNode(n: cc.Node, isRefresh: boolean = false) {\r\n        if (isRefresh) {\r\n            if (gameMgr && gameMgr.mainCamereRootNode) {\r\n                this.mainCameraPos = gameMgr.mainCamereRootNode.getPosition();\r\n                this.distanceX = cc.winSize.width / 2 / gameMgr.mainCamera.zoomRatio + 500;\r\n                this.distanceY = cc.winSize.height / 2 / gameMgr.mainCamera.zoomRatio + 500;\r\n            }\r\n        }\r\n        if (n && n.isValid && n.activeInHierarchy) {\r\n            if (n.parent.name == this.node.name || n.parent.name == \"dikuai\") {\r\n                if (n.opacity == 0 || n.opacity == 255) {\r\n                    if (((n.x + n.width * Math.abs(n.scaleX) / 2) < (this.mainCameraPos.x - this.distanceX)) || ((n.x - n.width * Math.abs(n.scaleX) / 2) > (this.mainCameraPos.x + this.distanceX) ||\r\n                        (n.y + n.height * Math.abs(n.scaleY) / 2) < (this.mainCameraPos.y - this.distanceY)) || ((n.y - n.height * Math.abs(n.scaleY) / 2) > (this.mainCameraPos.y + this.distanceY)\r\n                        )) {\r\n                        n.opacity = 0;\r\n                        return false;\r\n                    } else {\r\n                        n.opacity = 255;\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // 释放资源节点\r\n    release(call: Function) {\r\n        // 删除dikaui子节点\r\n        if (this.dikuai && this.dikuai.isValid && this.dikuai.childrenCount) {\r\n            for (let i = 0; i < 2; i++) {\r\n                let child = this.dikuai.children[i];\r\n                if (child && child.isValid) {\r\n                    child.destroy();\r\n                }\r\n            }\r\n            setTimeout(() => { this.release(call); });\r\n        }\r\n        // 删除普通节点\r\n        else if (this.node.childrenCount) {\r\n            for (let i = 0; i < 10; i++) {\r\n                let child = this.node.children[i];\r\n                if (child && child.isValid) {\r\n                    child.destroy();\r\n                }\r\n            }\r\n            setTimeout(() => { this.release(call); });\r\n        }\r\n        // 结束后回调\r\n        else {\r\n            call && call();\r\n        }\r\n    }\r\n}\r\n"]}