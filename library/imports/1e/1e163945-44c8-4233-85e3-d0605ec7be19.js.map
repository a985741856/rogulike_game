{"version":3,"sources":["assets\\common-plugin\\Scripts\\GameBoxSlideItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 游戏盒子顶部的幻灯片\r\n */\r\n@ccclass\r\nexport default class GameBoxSlideItem extends cc.Component {\r\n\r\n    data: any = null;\r\n    itemSprite: cc.Sprite = null;\r\n    _dataDirty: boolean = false;\r\n\r\n    lastPostTime: number = 0; //最后一次上报时间\r\n\r\n\r\n    onLoad() {\r\n        this.itemSprite = this.node.getComponent(cc.Sprite);\r\n    }\r\n    // start() {\r\n    //     this.initUi();\r\n    //     this.initListener();\r\n    // }\r\n\r\n    /**\r\n     * 初始化UI\r\n     */\r\n    protected initUi(): void {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * 初始化监听事件\r\n     */\r\n    protected initListener(): void {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * 初始化数据\r\n     */\r\n    public initData(data: string): void {\r\n        utils.showLog(\"#slideData=\", data)\r\n        this.data = data;\r\n        this._dataDirty = true;\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this._dataDirty) {\r\n            this._dataDirty = false;\r\n            this.updateItem();\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, (event: cc.Event) => {\r\n            this._postData(this.data.app_id);\r\n            if (this.data.app_id && utils.wechatTool.checkAppId(this.data.app_id)) {\r\n\r\n                utils.showLog(\"直接跳转!\", this.data.app_id);\r\n                //@ts-ignore\r\n                wx.navigateToMiniProgram({\r\n                    appId: this.data.app_id,\r\n                    path: this.data.app_path ? this.data.app_path : \"\",\r\n                    success(res) {\r\n                    },\r\n                    fail(res) {\r\n                        // utils.showLog(\"跳转失败！\", id);\r\n                        utils.showLog(`跳转失败!  res=${JSON.stringify(res)}`);\r\n                    }\r\n                });\r\n            } else if (this.data.qr_code) {\r\n                if (PlatUtils.IsWechat) {\r\n                    utils.showLog(\"二维码跳转!\", this.data.qr_code);\r\n                    utils.wechatTool.previewImage(this.data.qr_code);\r\n                    // 上报数据\r\n                    // if (this.data && this.data.app_id) {\r\n                    //     this._postData(this.data.app_id);\r\n                    // }\r\n                } else {\r\n                    utils.showLog(\"不支持二维码跳转!\");\r\n                }\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.node.targetOff(this);\r\n    }\r\n\r\n    updateItem() {\r\n        if (this.data && this.data.banner) {\r\n            CompatibleTool.LoadRes(this.data.banner, (err, texture) => {\r\n                utils.showLog(err, \"err\")\r\n                if (!err && cc.isValid(this) && this.itemSprite) {\r\n                    utils.showLog(this.node.active, \"node <<<\")\r\n                    this.itemSprite.spriteFrame = new cc.SpriteFrame(texture);\r\n                }\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    _postData(appid: string) {\r\n        // let curTime: number = new Date().getTime();\r\n        // let interval: number = (curTime - this.lastPostTime) / 1000;\r\n\r\n        // if (interval >= 3) {\r\n        let url: string = `https://apps.youlesp.com/gbs?m=rclickV2&app_id=${appid}&game_id=${utils.config.wechatconfig.appID}`;\r\n        utils.showLog(\"上报数据, url=\", url);\r\n        utils.commomHttpRequest(url, (ret, data) => {\r\n            if (ret) {\r\n                // this.lastPostTime = curTime;\r\n                utils.showLog(\"数据上报成功！\");\r\n            } else {\r\n                utils.showLog(\"数据上报失败！\");\r\n            }\r\n        });\r\n        // } else {\r\n        //     cc.warn(\"上报的间隔时间小于3秒\");\r\n        // }\r\n\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}