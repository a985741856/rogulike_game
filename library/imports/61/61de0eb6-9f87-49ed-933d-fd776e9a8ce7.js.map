{"version":3,"sources":["packages\\i18n\\runtime-scripts\\LanguageData.js"],"names":["Polyglot","require","polyInst","window","i18n","languages","curLang","CC_EDITOR","Editor","Profile","load","err","profile","data","loadLanguageData","initPolyglot","language","replace","phrases","allowMissing","module","exports","init","inst","t","key","opt","updateSceneRenderers","rootNodes","cc","director","getScene","children","allLocalizedLabels","i","length","labels","getComponentsInChildren","Array","prototype","push","apply","label","node","active","updateLabel","allLocalizedSprites","sprites","sprite","updateSprite"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Polyglot = require('polyglot.min');\n\nlet polyInst = null;\nif (!window.i18n) {\n    window.i18n = {\n        languages: {},\n        curLang:''\n    };\n}\n\nif (CC_EDITOR) {\n    Editor.Profile.load('profile://project/i18n.json', (err, profile) => {\n        window.i18n.curLang = profile.data['default_language'];\n        if (polyInst) {\n            let data = loadLanguageData(window.i18n.curLang) || {};\n            initPolyglot(data);\n        }\n    });\n}\n\nfunction loadLanguageData (language) {\n    return window.i18n.languages[language];\n}\n\nfunction initPolyglot (data) {\n    if (data) {\n        if (polyInst) {\n            polyInst.replace(data);\n        } else {\n            polyInst = new Polyglot({ phrases: data, allowMissing: true });\n        }\n    }\n}\n\nmodule.exports = {\n    /**\n     * This method allow you to switch language during runtime, language argument should be the same as your data file name\n     * such as when language is 'zh', it will load your 'zh.js' data source.\n     * @method init\n     * @param language - the language specific data file name, such as 'zh' to load 'zh.js'\n     */\n    init (language) {\n        if (language === window.i18n.curLang) {\n            return;\n        }\n        let data = loadLanguageData(language) || {};\n        window.i18n.curLang = language;\n        initPolyglot(data);\n        this.inst = polyInst;\n    },\n    /**\n     * this method takes a text key as input, and return the localized string\n     * Please read https://github.com/airbnb/polyglot.js for details\n     * @method t\n     * @return {String} localized string\n     * @example\n     *\n     * var myText = i18n.t('MY_TEXT_KEY');\n     *\n     * // if your data source is defined as\n     * // {\"hello_name\": \"Hello, %{name}\"}\n     * // you can use the following to interpolate the text\n     * var greetingText = i18n.t('hello_name', {name: 'nantas'}); // Hello, nantas\n     */\n    t (key, opt) {\n        if (polyInst) {\n            return polyInst.t(key, opt);\n        }\n    },\n\n    inst: polyInst,\n\n    updateSceneRenderers () { // very costly iterations\n        let rootNodes = cc.director.getScene().children;\n        // walk all nodes with localize label and update\n        let allLocalizedLabels = [];\n        for (let i = 0; i < rootNodes.length; ++i) {\n            let labels = rootNodes[i].getComponentsInChildren('LocalizedLabel');\n            Array.prototype.push.apply(allLocalizedLabels, labels);\n        }\n        for (let i = 0; i < allLocalizedLabels.length; ++i) {\n            let label = allLocalizedLabels[i];\n            if(!label.node.active)continue;\n            label.updateLabel();\n        }\n        // walk all nodes with localize sprite and update\n        let allLocalizedSprites = [];\n        for (let i = 0; i < rootNodes.length; ++i) {\n            let sprites = rootNodes[i].getComponentsInChildren('LocalizedSprite');\n            Array.prototype.push.apply(allLocalizedSprites, sprites);\n        }\n        for (let i = 0; i < allLocalizedSprites.length; ++i) {\n            let sprite = allLocalizedSprites[i];\n            if(!sprite.node.active)continue;\n            sprite.updateSprite(window.i18n.curLang);\n        }\n    }\n};"]}