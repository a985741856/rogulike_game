{"version":3,"sources":["assets\\common-plugin\\Scripts\\YZ_Tool_Xiaomi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\nimport YZ_Constant, { LevelStatus } from \"./YZ_Constant\";\r\nimport YZ_LocalStorage from \"./YZ_LocalStorage\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst ST_ServerUrl: string = \"http://apps.youlesp.com/gss?\";\r\nconst POST_ServerUrl: string = \"http://report.youlesp.com/gss?\";\r\nlet ST_DefaultServerConfig: string = \"\";\r\nconst ST_NativeInsertAdClickTimes: string = \"NativeInsertAdClickTimes\";\r\nconst ST_LastDateTime: string = \"LastDateTime\";\r\nconst ST_InsertAdShowCounts: string = \"NativeInsertAdShowCount\"; //插屏显示次数\r\nconst ST_BannerAdCloseCounts: string = \"ST_BannerAdCloseCounts\"; //banner广告关闭次数\r\nconst ST_YZBannerShowCounts: string = \"YZBannerShowCounts\"; //banner广告关闭次数\r\n\r\n\r\n@ccclass\r\nexport default class YZ_Tool_Xiaomi {\r\n\r\n\r\n    _sysInfo: any = null;\r\n    public get SysInfo() {\r\n        return this._sysInfo || {};\r\n    }\r\n\r\n    _serverConfig: any = null;\r\n    public get ServerConfig() {\r\n        return this._serverConfig;\r\n    }\r\n\r\n    _nativeInsertAdClickTimes: number = 0;\r\n    public get NativeInsertAdClickTimes() {\r\n        return this._nativeInsertAdClickTimes;\r\n    }\r\n\r\n    _insertAdShowCounts: number = 0;\r\n    /**\r\n     * 插屏广告展示次数\r\n     */\r\n    public get insertAdShowCounts() {\r\n        return this._insertAdShowCounts;\r\n    }\r\n\r\n    _bannerAdCloseCounts: number = 0;\r\n    /**\r\n     * banner关闭次数\r\n     */\r\n    public get bannerAdCloseCounts() {\r\n        return this._bannerAdCloseCounts;\r\n    }\r\n\r\n\r\n    _yzBannerShowCounts: number = 0;\r\n    /**\r\n     * 自定义banner展示次数\r\n     */\r\n    public get yzBannerShowCounts() {\r\n        return this._yzBannerShowCounts;\r\n    }\r\n\r\n    //设备UID\r\n    _uid: string = \"0\";\r\n\r\n    public get uid() {\r\n        // if (this._service_uid != \"0\") return this._uid;\r\n        // this._login();\r\n        return \"0\";\r\n    }\r\n\r\n    //服务器返回UID\r\n    _service_uid: string = \"0\";\r\n\r\n    /**\r\n     * 服务器返回UID\r\n     */\r\n    public get serviceId() {\r\n        if (this._service_uid != \"0\") return this._service_uid;\r\n        this.reportLogin();\r\n        return \"0\";\r\n    }\r\n\r\n\r\n    _loginTime: number = 0;\r\n    _loginInterval: number = 30;\r\n    async _login() {\r\n\r\n        let curTime: number = new Date().getTime();\r\n        let interval: number = (curTime - this._loginTime) / 1000;\r\n        if (interval > 0 && interval < this._loginInterval) {\r\n            utils.showLog(`登录请求间隔小于：${this._loginInterval}秒`);\r\n            return;\r\n        }\r\n        this._loginTime = curTime;\r\n        let self = this;\r\n        utils.showLog(\"vivo暂时不获取uid，uid全部为0\");\r\n        this._uid = \"0\";\r\n        this.reportLogin();\r\n\r\n    }\r\n\r\n    _reportLoginTime: number = 0;\r\n    _reportLoginInterval: number = 30;\r\n    isReport: boolean = false;\r\n\r\n    public countNativeInserClick() {\r\n        this._nativeInsertAdClickTimes++;\r\n        YZ_LocalStorage.setItem(utils.config.xiaomiConfig.appID + \"_\" + ST_NativeInsertAdClickTimes, this._nativeInsertAdClickTimes);\r\n    }\r\n\r\n    /**\r\n     * 增加插屏显示的次数\r\n     */\r\n    public countInserShowCount() {\r\n        this._insertAdShowCounts++;\r\n        YZ_LocalStorage.setItem(utils.config.xiaomiConfig.appID + \"_\" + ST_InsertAdShowCounts, this._insertAdShowCounts);\r\n    }\r\n\r\n    /**\r\n     * 增加banner的关闭次数\r\n     */\r\n    public countBannerCloseCount() {\r\n        this._bannerAdCloseCounts++;\r\n        YZ_LocalStorage.setItem(utils.config.xiaomiConfig.appID + \"_\" + ST_BannerAdCloseCounts, this._bannerAdCloseCounts);\r\n    }\r\n\r\n    /**\r\n    * 增加自定义banner的显示次数\r\n    */\r\n    public countYzBannerShowCount() {\r\n        this._yzBannerShowCounts++;\r\n        YZ_LocalStorage.setItem(utils.config.xiaomiConfig.appID + \"_\" + ST_YZBannerShowCounts, this._yzBannerShowCounts);\r\n    }\r\n\r\n    /**\r\n     * 上报登录接口获取UID\r\n     */\r\n    reportLogin() {\r\n        if (this.isReport) return;\r\n        this.isReport = true;\r\n        let self = this;\r\n        let curTime: number = new Date().getTime();\r\n        let interval: number = (curTime - this._reportLoginTime) / 1000;\r\n        if (interval > 0 && interval < this._reportLoginInterval) {\r\n            utils.showLog(`上报登录获取UID小于：${this._reportLoginInterval}秒`);\r\n            return;\r\n        }\r\n        this._reportLoginTime = curTime;\r\n        let method = \"m=login\";\r\n        let url: string = ST_ServerUrl + method + `&device_data=${encodeURI(JSON.stringify(this._sysInfo))}`;\r\n\r\n        utils.commomHttpRequest(url, (ret, data) => {\r\n            if (ret) {\r\n                if (data) {\r\n                    let result = JSON.parse(data);\r\n                    utils.showLog(\"data=\" + data);\r\n                    utils.showLog(\"result=\" + result);\r\n                    utils.showLog(\"result.uid=\" + result.uid);\r\n                    if (result.uid) {\r\n                        self._service_uid = \"\" + result.uid;\r\n                        utils.showLog(\"服务器请求登录成功! _service_uid=\" + self._service_uid);\r\n                        YZ_LocalStorage.setItem(YZ_Constant.ST_SERVICE_UID, self._service_uid);\r\n                    }\r\n                }\r\n            } else {\r\n                utils.showLog(\"获取数据失败1\");\r\n            }\r\n            this.isReport = false;\r\n        })\r\n    }\r\n    /**\r\n     * \r\n     * @param data 配置数据\r\n     */\r\n    public init(data: string) {\r\n        if (PlatUtils.IsXiaoMi) {\r\n\r\n            if (data) {\r\n                let configObj: any = JSON.parse(data);\r\n                if (configObj && configObj.xiaomi) {\r\n                    ST_DefaultServerConfig = JSON.stringify(configObj.xiaomi);\r\n                }\r\n            }\r\n            this._service_uid = YZ_LocalStorage.getItem(YZ_Constant.ST_SERVICE_UID);\r\n            this._service_uid = this._service_uid ? this._service_uid : \"0\";\r\n\r\n            //@ts-ignore\r\n            if (qg.getUpdateManager) {\r\n                //@ts-ignore\r\n                const updateManager = qg.getUpdateManager()\r\n                updateManager.onCheckForUpdate(function (res) {\r\n                    // 请求完新版本信息的回调\r\n                    utils.showLog('onCheckForUpdate', res.hasUpdate)\r\n                })\r\n                updateManager.onUpdateReady(function () {\r\n                    // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启\r\n                    updateManager.applyUpdate()\r\n                })\r\n\r\n                updateManager.onUpdateFailed(function () {\r\n                    // 新版本下载失败\r\n                    utils.showMsg(\"自动更新失败，请手动重启游戏！\");\r\n                })\r\n            }\r\n            this.getSystemInfo();\r\n            this._loadConfig();\r\n        }\r\n    }\r\n\r\n\r\n\r\n    _loadConfig() {\r\n        if (PlatUtils.IsXiaoMi) {\r\n            let method: string = \"m=g\";\r\n            let url: string = ST_ServerUrl + method\r\n            utils.commomHttpRequest(url, (ret, data) => {\r\n                if (ret) {\r\n                    utils.showLog(\"小米服务器配置数据获取成功: data = \" + data);\r\n                    if (data) {\r\n                        let result = JSON.parse(data);\r\n                        if (result) {\r\n                            if (!utils.DebugLoacalConfig) {\r\n                                this._serverConfig = result;\r\n                                if (this._serverConfig.is_show_log_view && this._serverConfig.is_show_log_view == \"true\") {\r\n                                    utils.showLogView = true;\r\n                                }\r\n                            } else {\r\n                                utils.showLog(\"开启了本地数据测试，使用本地配置!\");\r\n                            }\r\n                        } else {\r\n                            utils.showLog(\"小米服务器配置数据不是合法的JSON数据, 使用本地配置!\");\r\n                        }\r\n                    }\r\n                } else {\r\n                    utils.showLog(\"小米服务器配置数据获取失败, 使用本地配置!\");\r\n                }\r\n\r\n                if (!this._serverConfig) {\r\n                    this._serverConfig = JSON.parse(ST_DefaultServerConfig);\r\n                } else {\r\n                    if (this._serverConfig.is_local_pos_id\r\n                        && this._serverConfig.is_local_pos_id == \"false\") {\r\n                        // 使用服务器下发的广告id\r\n                        utils.showLog(\"使用服务器下发的广告id\");\r\n                        utils.config.xiaomiConfig.insertId = this._serverConfig.intersititia_pos_id;\r\n                        utils.config.xiaomiConfig.videoId = this._serverConfig.video_pos_id;\r\n                        utils.config.xiaomiConfig.nativeInsertIds = this.ServerConfig.native_intersititial_pos_id;\r\n                        utils.config.xiaomiConfig.nativeBannerIds = this.ServerConfig.native_banner_pos_id;\r\n                        utils.config.xiaomiConfig.nativeTryGameIds = this.ServerConfig.native_trygame_pos_id;\r\n                        utils.config.xiaomiConfig.bannerId = this._serverConfig.banner_pos_id;\r\n\r\n                    } else {\r\n                        utils.showLog(\"使用本地配置的广告ID\");\r\n                    }\r\n                    if (this.ServerConfig.native_banner_configs) {\r\n                        for (let i = 0; i < this.ServerConfig.native_banner_configs.length; i++) {\r\n                            utils.showLog(\"获取到原生广告配置:\" + this.ServerConfig.native_banner_configs[i].location, \">>>>\", JSON.stringify(this.ServerConfig.native_banner_configs[i]));\r\n                            utils.config.xiaomiConfig.setNativeBannerInfo(this.ServerConfig.native_banner_configs[i].location, this.ServerConfig.native_banner_configs[i]);\r\n                        }\r\n                    }\r\n                }\r\n                utils.emitServerInitEvent();\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 比较当前平台版本是否高于指定的版本号\r\n     * @param miniVersion 最低平台版本号\r\n     */\r\n    public isOverMiniVersion(miniVersion: string) {\r\n        if (PlatUtils.IsXiaoMi) {\r\n            if (this._sysInfo && this._sysInfo.platformVersionCode) {\r\n                return this._sysInfo.platformVersionCode >= miniVersion;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 上报关卡数据\r\n     * @param level 当前关卡ID\r\n     * @param levelName 关卡名称\r\n     * @param status 状态\r\n     */\r\n    public postLevel(level: string, status: LevelStatus, levelName?: string) {\r\n        if (PlatUtils.IsXiaoMi) {\r\n            let method = \"m=rlevel\";\r\n            let url: string = POST_ServerUrl + method + `&level_id=${level}&level_name=${encodeURI(levelName)}&status=${status}`;\r\n            utils.commomHttpRequest(url, function (ret, data) {\r\n                if (ret) {\r\n                    utils.showLog(\"关卡数据上报成功！\");\r\n                } else {\r\n                    utils.showLog(\"关卡数据上报失败！\");\r\n                }\r\n            }.bind(this));\r\n        }\r\n    }\r\n\r\n    /**\r\n* 上报自定义事件\r\n* @param level 当前关卡ID\r\n* @param levelName 关卡名称\r\n* @param status 状态\r\n*/\r\n    public sendEvent(eventName: string) {\r\n        if (PlatUtils.IsXiaoMi) {\r\n            let method = \"m=revent\";\r\n            let url: string = POST_ServerUrl + method + `&event=${encodeURI(eventName)}`;\r\n            utils.commomHttpRequest(url, function (ret, data) {\r\n                if (ret) {\r\n                    utils.showLog(\"上报自定义事件成功！\");\r\n                } else {\r\n                    utils.showLog(\"上报自定义事件失败！\");\r\n                }\r\n            }.bind(this));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取系统信息\r\n     */\r\n    public getSystemInfo() {\r\n        if (PlatUtils.IsXiaoMi) {\r\n            //@ts-ignore\r\n            this._sysInfo = qg.getSystemInfoSync();\r\n            utils.showLog(\"获取系统信息成功：\" + JSON.stringify(this._sysInfo));\r\n        }\r\n    }\r\n\r\n    public GameExit() {\r\n        if (PlatUtils.IsXiaoMi) {\r\n            //@ts-ignore\r\n            //可以退出游戏\r\n            qg.exitApplication({\r\n                success: () => {\r\n                    utils.showLog(\"exit Game success\");\r\n                },\r\n                fail: () => {\r\n                    utils.showLog(\"exit Game fail\");\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}