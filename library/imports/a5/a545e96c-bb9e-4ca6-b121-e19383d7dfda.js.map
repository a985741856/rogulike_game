{"version":3,"sources":["assets\\common-plugin\\Scripts\\AdAgentFaceBook.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AdAgent from \"./AdAgent\";\r\nimport { BannerLocation } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\nimport FBAdManager from \"./FaceBookSdk/FBAdManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class AdAgentFaceBook extends AdAgent {\r\n\r\n    _sysData: any = null;\r\n    _curBannerAd: any = null;\r\n    _videoAd: any = null;\r\n    _insertAd: any = null;\r\n    _oldAd: any = null;\r\n    _appBox: any = null; //游戏盒子广告\r\n\r\n    _videoCallback: Function = null;\r\n    _isVideoLoaded: boolean = false;\r\n    _isVideoShow: boolean = false;\r\n    //@ts-ignore\r\n    qq: any = window.qq;\r\n    public Init() {\r\n        if (PlatUtils.IsFaceBook) {\r\n            utils.registerServerInitEvent(() => {\r\n                this._initAd();\r\n            }, this);\r\n        }\r\n    }\r\n\r\n\r\n    public get ServerConfig() {\r\n        return utils.Tool_Facebook.ServerConfig;\r\n    }\r\n\r\n\r\n    _initAd() {\r\n        utils.showLog(\"facebook init ad>>>>>>>>\")\r\n        FBAdManager.addInterstitial(utils.config.faceBookConfig.insertId, 3);\r\n        FBAdManager.addRewardedVideo(utils.config.faceBookConfig.videoId, 3);\r\n        FBAdManager.addBanner(utils.config.faceBookConfig.bannerId);\r\n        setTimeout(() => {\r\n            FBAdManager.loadAll();\r\n        }, 3000);\r\n    }\r\n\r\n    _bannerShow: boolean = false;\r\n    _bannerSizePercent: number = 0.5;\r\n    _bannerBottom: number = 0;\r\n    _oldBannerLocation: BannerLocation = BannerLocation.None;\r\n\r\n    _curBannerHeight: number = 240;\r\n\r\n    _moveBtn: cc.Node = null;\r\n    _cur_level: any = null;\r\n    _createBanner(location: BannerLocation, args: any = null) {\r\n        if (PlatUtils.IsFaceBook) {\r\n            FBAdManager.showBannerAsync().then(() => {\r\n                utils.showLog(\"显示Banner广告: 成功\");\r\n            }).catch(e => {\r\n                utils.showLog(\"显示Banner广告: 失败，原因: \" + e.message);\r\n            });\r\n        }\r\n    }\r\n\r\n    _showBannerTimer(location: BannerLocation, args: any) {\r\n        let locationTmp: BannerLocation = location;\r\n        let argsTmp: any = args;\r\n        utils.showLog(`显示Banner广告xxx！location:${locationTmp}; 间隔时间:${utils.Tool_Facebook.ServerConfig.refresh_ad_time}:优先级：${this.ServerConfig.banner_first_ad}`);\r\n\r\n        this._createBanner(locationTmp, argsTmp)\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    _showBannerTimerId: number = 0;\r\n    public ShowBanner(location: BannerLocation = BannerLocation.Home, args: any = null) {\r\n        if (PlatUtils.IsFaceBook) {\r\n\r\n            if (utils.ServerConfig) {\r\n                let locationTmp: BannerLocation = location;\r\n                let argsTmp: any = args;\r\n                this._moveBtn = args ? args.moveBtn : null;\r\n                this._cur_level = args ? args.cur_level : null;\r\n                this._showBannerTimer(locationTmp, argsTmp);\r\n            } else {\r\n                utils.showLog(\"服务器配置数据未初始化!\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public HideBanner(location: BannerLocation = BannerLocation.Home) {\r\n        if (PlatUtils.IsFaceBook) {\r\n            utils.showLog(\"隐藏广告条\");\r\n\r\n\r\n            this._bannerShow = false;\r\n            clearInterval(this._showBannerTimerId);\r\n            FBAdManager.hideBannerAsync().then(() => {\r\n                utils.showLog(\"隐藏Banner广告: 成功\");\r\n            }).catch(e => {\r\n                utils.showLog(\"隐藏Banner广告: 失败，原因: \" + e.message);\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    public ShowVideo(callback: Function) {\r\n        if (PlatUtils.IsFaceBook) {\r\n            this._videoCallback = callback;\r\n            if (FBAdManager.isRewardedVideoReady()) {\r\n                FBAdManager.showRewardedVideo().then(() => {\r\n                    utils.showLog(\"播放激励视频广告: 成功\");\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(true, \"\");\r\n                        this._videoCallback = null;\r\n                    }\r\n                }).catch(e => {\r\n                    utils.showLog(\"视频播放失败：\" + e.message);\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(false, \"Ad playback failed!\");\r\n                        this._videoCallback = null;\r\n                    }\r\n                });\r\n            } else {\r\n                utils.showLog(\"激励视频广告未加载！\");\r\n                if (this._videoCallback) {\r\n                    this._videoCallback(false, \"Video ad not loaded successfully！\");\r\n                    this._videoCallback = null;\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 显示插屏\r\n     * 2001\t触发频率限制\t小程序启动一定时间内不允许展示插屏广告\r\n     * 2002\t触发频率限制\t距离小程序插屏广告或者激励视频广告上次播放时间间隔不足，不允许展示插屏广告\r\n     * 2003\t触发频率限制\t当前正在播放激励视频广告或者插屏广告，不允许再次展示插屏广告\r\n     * 2004\t广告渲染失败\t该项错误不是开发者的异常情况，或因小程序页面切换导致广告渲染失败\r\n     * 2005\t广告调用异常\t插屏广告实例不允许跨页面调用\r\n     * 销毁插屏广告后才能重新创建\r\n     * @param location \r\n     */\r\n    public ShowInterstitial(location: BannerLocation = null) {\r\n        if (PlatUtils.IsFaceBook) {\r\n            if (this.ServerConfig) {\r\n                utils.delayCall(this._createInsterstitial.bind(this), this.ServerConfig.intersititia_delay_show_time || 0);\r\n            }else{\r\n                this._createInsterstitial.bind(this)\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    _isShow: boolean = false;\r\n    public _createInsterstitial() {\r\n        if (FBAdManager.isInterstitialAdReady()) {\r\n            FBAdManager.showInterstitialAd().then(() => {\r\n                utils.showLog(\"播放插屏广告: 成功\");\r\n            }).catch(e => {\r\n                utils.showLog(\"播放插屏广告: 失败，原因: \" + e.message);\r\n            });\r\n        } else {\r\n            utils.showLog(\"插屏广告没有加载成功！\")\r\n        }\r\n    }\r\n\r\n}\r\n"]}