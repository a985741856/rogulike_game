{"version":3,"sources":["assets\\scripts\\UI\\redPoint.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { cocosz } from \"../Framework/CocosZ\";\r\nimport Constant from \"../Framework/Constant\";\r\nimport GameDate from \"../Game/gameDate\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nenum RedPointType {\r\n    none = 0,\r\n    sign,\r\n    turntable,\r\n    online\r\n}\r\n\r\n@ccclass\r\nexport default class RedPoint extends cc.Component {\r\n\r\n    @property({ type: cc.Enum(RedPointType), tooltip: \"红点类型\" })\r\n    type: number = RedPointType.none;\r\n\r\n    @property({ tooltip: \"点击父节点刷新红点\" })\r\n    refreshOnClick: boolean = true;\r\n\r\n    @property({ tooltip: \"是否刷新\" })\r\n    isRefresh: boolean = false\r\n\r\n    @property({ tooltip: \"是否缓动角度\" })\r\n    isTweenAngle: boolean = false;\r\n\r\n    @property({ tooltip: \"是否缓动缩放\" })\r\n    isTweenScale: boolean = false;\r\n\r\n    @property({ tooltip: \"是否监听\" })\r\n    isListen: boolean = false;\r\n\r\n    start() {\r\n        this.node.opacity = 0;\r\n        // 刷新\r\n        this.setRedPoint();\r\n        if (this.isRefresh) {\r\n            cc.tween(this.node)\r\n                .delay(1)\r\n                .call(() => { this.setRedPoint(); })\r\n                .union()\r\n                .repeatForever()\r\n                .start();\r\n        }\r\n        // 缓动角度\r\n        if (this.isTweenAngle) {\r\n            cc.tween(this.node).by(0.25, { angle: 15 }).by(0.25 * 2, { angle: -30 }).by(0.25, { angle: 15 }).delay(1).union().repeatForever().start();\r\n        }\r\n        // 缓动缩放\r\n        if (this.isTweenScale) {\r\n            cc.tween(this.node).by(0.25, { scale: 0.1 }).by(0.25 * 2, { scale: -0.2 }).by(0.25, { scale: 0.1 }).delay(1).union().repeatForever().start();\r\n        }\r\n        // 监听事件\r\n        if (this.isListen) {\r\n            cc.game.on(Constant.E_GAME_LOGIC, this._onGameMessageHandler, this);\r\n        }\r\n    }\r\n\r\n    /** 销毁监听 */\r\n    protected onDestroy(): void {\r\n        cc.game.targetOff(this);\r\n    }\r\n\r\n    /** 监听事件 */\r\n    private _onGameMessageHandler(event: any) {\r\n        switch (event.type) {\r\n            \r\n        }\r\n    }\r\n\r\n    /** 监听消息 */\r\n    onClick() {\r\n        // 本地存储\r\n        switch (this.type) { }\r\n        // 点击父节点刷新红点\r\n        if (this.refreshOnClick) {\r\n            this.setRedPoint();\r\n        }\r\n    }\r\n\r\n    /** 显示 */\r\n    show() {\r\n        this.node.opacity = 255;\r\n        // 点击监听\r\n        if (this.node.parent) {\r\n            this.node.parent.on(cc.Node.EventType.TOUCH_END, this.onClick, this);\r\n        }\r\n    }\r\n\r\n    /** 隐藏 */\r\n    hide() {\r\n        this.node.opacity = 0;\r\n        // 取消监听\r\n        if (this.node.parent) {\r\n            this.node.parent.off(cc.Node.EventType.TOUCH_END, this.onClick, this);\r\n        }\r\n    }\r\n\r\n    /** 设置红点  */\r\n    setRedPoint() {\r\n        switch (this.type) {\r\n            case RedPointType.sign: {\r\n                let bool = (new Date().toDateString() != cocosz.dataMgr.LastDailyBonusTime);\r\n                bool ? this.show() : this.hide();\r\n                break;\r\n            }\r\n            case RedPointType.turntable: {\r\n                let bool = (cocosz.useCJTimes < Constant.commonCJTimes);\r\n                bool ? this.show() : this.hide();\r\n                break;\r\n            }\r\n            case RedPointType.online: {\r\n                let arr = cocosz.dataMgr.receiveToday;\r\n                for (let i = 0; i < arr.length; i++) {\r\n                    if (!arr[i]) {\r\n                        if (cocosz.dataMgr.OnlineToday > GameDate.TimeReward[i].time) {\r\n                            this.show();\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n                this.hide();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}