{"version":3,"sources":["assets\\common-plugin\\Scripts\\FaceBookSdk\\FBAdManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// fb文档 https://developers.facebook.com/docs/games/instant-games/sdk/fbinstant6.3\n// 使用的话，直接看广告管理器 FBAdManager\n/*\n使用步骤\n* 1. addXXXXAd() 添加相应的广告，以及预加载的数量（默认为3)\n* 1.1. 插屏 addInterstitial\n* 1.2. 激励视频 addRewardedVideo\n* 1.3. banner addBanner\n\n* 2. loadAll() 预加载所有广告实例\n\n* 3. isXXXReady() 检查是否可以播放\n* 3.1. 插屏  isInterstitialAdReady\n* 3.2. 激励视频 isRewardedVideoReady\n* 3.3. banner isBannerReady\n\n* 4. showXXXAsync() 播放广告，并检查播放状态\n* 4.1. 插屏 showInterstitialAd\n* 4.2. 激励视频 showRewardedVideo\n* 4.3. banner showBannerAsync\n\n* 5. hideXXXAsync() 隐藏广告（banner专属)\n* 5.1. 插屏 不需要\n* 5.2. 激励视频 不需要\n* 5.3. banner hideBannerAsync\n\n* 其他：\n* 6. 判断是否支持特定api\n* 6.1 判断是否支持banner广告\n// \n*/\n\nimport { utils } from \"../Utils\";\n\nconst FB_MAX_AD_INSTANCE = 3;   // FB允许的最多广告实例数量\nconst FB_INIT_AD_COUNT = 3;     // 预加载的广告实例数量\n\nconst FB_BANNER_REFRESH_INTERVAL = 30+10; // FB: Banner广告有播放间隔限制 30 seconds (由于网络原因，需要多加一点时间)\nconst FB_INTERSTITIAL_REFRESH_INTERVAL = 30+10; // FB: 插屏广告有播放间隔限制\nconst FB_REWARDED_VIDEO_REFRESH_INTERVAL = 0;   // FB: 激励视频没有播放间隔限制\n\nconst FB_MAX_BANNER_ERROR = 1;              // banner加载连续出现N次错误后，终止加载\nconst FB_MAX_INTERSTITIAL_ERROR = 3;        // 插屏加载连续出现N次错误后，终止加载\nconst FB_MAX_REWARDED_VIDEO_ERROR = 3;      // 激励视频加载连续出现N次错误后，终止加载\n\nconst FB_AUTO_LOAD_ON_PLAY = true;          // 插屏、激励视频是否在播放完毕后自动加载\nconst FB_AUTO_RELOAD_DELAY = 1;             // 自动重新加载时，延迟加载等待的时间\n\nconst FB_AD_DELAY_FOR_FIRST_BANNER = 0;         // 首个banner广告延迟N秒显示\nconst FB_AD_DELAY_FOR_FIRST_INTERSTITIAL = 30;  // 首个插屏广告需要延迟30秒播放（避免游戏前30秒就播放广告）\nconst FB_AD_DELAY_FOR_FIRST_REWARDED_VIDEO = 0; // 首个激励视频广告延迟N秒显示\n\nenum FB_AD_TYPE{\n    INTERSTITIAL = 0,\n    REWARDED_VIDEO = 1,\n    BANNER = 2\n}\n\nenum FB_AD_STATE{\n    NONE,\n    NEW,\n    LOADING,\n    LOADED,\n    PLAYING\n}\n\nfunction getStateName(state:FB_AD_STATE){\n    let str = \"NONE\";\n    switch(state){\n        case FB_AD_STATE.NEW:\n            str = \"NEW\";\n            break;\n        case FB_AD_STATE.LOADING:\n            str = \"LOADING\";\n            break;\n        case FB_AD_STATE.LOADED:\n            str = \"LOADED\";\n            break;\n        case FB_AD_STATE.PLAYING:\n            str = \"PLAYING\";\n            break;\n    }\n\n    return str;\n}\n\nasync function waitTimeSecond(timeoutSecond:number, callback?) {\n    return new Promise<void>((resolve, reject)=>{\n        setTimeout(()=>{\n            if(callback){\n                callback();\n            }\n            resolve();\n        }, timeoutSecond * 1000);\n    });\n}\n\ninterface FB_ERROR{\n    code: string;\n    message: string;\n}\n\nconst ErrorTooManyAdInstance:FB_ERROR = {\n    code: \"EXCEED_MAX_AD_INSTANCE\",\n    message: \"广告对象不允许超过 \" + FB_MAX_AD_INSTANCE\n}\n\nconst ErrorNoReadyAdInstance:FB_ERROR = {\n    code: \"NO_READY_AD_INSTANCE\",\n    message: \"没有加载完毕的广告，或者广告播放太频繁\"\n}\n\nconst ErrorNotReadyForLoad:FB_ERROR = {\n    code: \"NOT_READY_FOR_LOAD\",\n    message: \"当前状态不允许再次加载\"\n}\n\nconst ErrorAdIsLoading:FB_ERROR = {\n    code: \"AD_IS_LOADING\",\n    message: \"广告正在加载\"\n}\n\nconst ErrorNotReadyForPlay:FB_ERROR = {\n    code: \"NOT_READY_FOR_PLAYING\",\n    message: \"没有可以播放的广告\"\n}\n\nconst ErrorAdIsPlaying:FB_ERROR = {\n    code: \"AD_IS_PLAYING\",\n    message: \"广告正在播放\"\n}\n\nconst ErrorNoBannerAdInstance:FB_ERROR = {\n    code: \"NO_BANNER_AD\",\n    message: \"没有添加Banner广告\"\n}\n\nconst ErrorApiNotSupport:FB_ERROR = {\n    code: \"API_NOT_SUPPORT\",\n    message: \"广告接口不支持\"\n}\n\nconst ErrorTooFastShow:FB_ERROR = {\n    code: \"TOO_FAST_SHOW\",\n    message: \"广告播放太频繁\"\n}\n\nconst ErrorNotPlaying:FB_ERROR = {\n    code: \"NOT_PLAYING\",\n    message: \"广告没有播放\"\n}\n\nconst ErrorTooManyErrors:FB_ERROR = {\n    code: \"TOO_MANY_ERRORS\",\n    message: \"太多错误, 停止操作\"\n}\n\nconst FB_API_BANNER = \"loadBannerAdAsync\";\n\nconst FB_ERROR_CODE_RATE_LIMITED = \"RATE_LIMITED\";\nconst FB_ERROR_CLIENT_UNSUPPORTED_OPERATION = \"CLIENT_UNSUPPORTED_OPERATION\";\nconst FB_ERROR_ADS_NO_FILL = \"ADS_NO_FILL\";\n\n// state : NONE -> NEW -> LOADING -> LOADED -> SHOWING -> (SHOWED) NONE\n\ninterface FBAdOption{\n    autoLoadOnPlay: boolean,\n    maxLoadError: number,      // 最多失误多少次后不再加载    \n}\n\ninterface AdTimerOption{\n    refreshInterval: number,   // 播放间隔\n    delayForFirstAd: number,   // 第一个广告延迟N秒播放（避免游戏前30秒就播放广告）\n}\n\nfunction getOption(opt:FBAdOption, key:string, defaultValue:any){\n    if(opt && typeof(opt[key])!= \"undefined\") {\n        return opt[key];\n    }\n\n    return defaultValue;\n}\n\n// 广告计时器\nclass AdTimer{\n    protected _lastShowTime:number = 0;    // 上次显示时间\n    protected _refreshInterval:number = 0;    // 刷新间隔, <=0 表示无限制\n\n    constructor(interval:number, delay:number){\n        this._refreshInterval = interval>0?interval:0;\n        this._lastShowTime = 0;\n        if(delay>0){\n            this._lastShowTime = Date.now() + delay * 1000 - this._refreshInterval * 1000;\n        }\n    }\n\n    public isReadyToRefresh(){\n        return this.getNextRefreshInterval() <= 0;\n    }\n\n    public getNextRefreshInterval(){\n        let refreshInterval = 0;\n\n        if(this._refreshInterval>0 && this._lastShowTime > 0){\n            let currentTime = Date.now();\n            refreshInterval = this._refreshInterval - (currentTime - this._lastShowTime)/1000;\n        }\n\n        return refreshInterval;\n    }\n\n    public updateLastShowTime(){\n        this._lastShowTime = Date.now();\n    }\n}\n\nclass FBAdUnitBase{\n    protected _state:FB_AD_STATE;\n    protected _adId:string;\n    protected _type:FB_AD_TYPE;\n\n    // protected _lastShowTime:number = 0;    // 上次显示时间\n    // protected _refreshInterval:number = 0;    // 刷新间隔, <=0 表示无限制\n\n    protected _maxLoadError:number = 0;\n    protected _errorCounter:number = 0;\n    protected _fatalError:boolean = false;\n\n    protected _sharedTimer:AdTimer = null;\n\n    constructor(id:string, type:FB_AD_TYPE, sharedTimer:AdTimer, opt?:FBAdOption){\n        this._adId = id;\n        this._state = FB_AD_STATE.NONE;\n        this._type = type;\n        this._sharedTimer = sharedTimer;\n\n        this._fatalError = false;\n        utils.showLog(!!sharedTimer, \"sharedTimer is invalid\", sharedTimer);\n        \n        // this._refreshInterval = getOption(opt, \"refreshInterval\", 0);\n        this._maxLoadError = getOption(opt, \"maxLoadError\", 0);\n\n        // const delayForFirstAd = getOption(opt, \"delayForFirstAd\", 0);\n        // if(delayForFirstAd > 0) {\n        //     this._lastShowTime = Date.now() + delayForFirstAd * 1000 - this._refreshInterval * 1000;\n        // }else{\n        //     this._lastShowTime = 0;\n        // }\n    }\n\n    public getStateName(){\n        return getStateName(this._state);\n    }\n\n    public getAdTypeName(){\n        if(this._type == FB_AD_TYPE.INTERSTITIAL){\n            return \"插屏广告\";\n        }\n        if(this._type == FB_AD_TYPE.REWARDED_VIDEO){\n            return \"激励视频广告\";\n        }\n        if(this._type == FB_AD_TYPE.BANNER){\n            return \"Banner\";\n        }\n\n        return \"UNKNOWN\";\n    }\n\n    public getInfo(){\n        return `[${this.getAdTypeName()}:${this._adId}:${this.getStateName()}]`;\n    }\n\n    public isReadyToRefresh(){\n        // return this.getNextRefreshInterval() <= 0;\n        return this._sharedTimer.isReadyToRefresh();\n    }\n\n    public getNextRefreshInterval(){\n        return this._sharedTimer.getNextRefreshInterval();\n    }\n\n    protected updateLastShowTime(){\n        this._sharedTimer.updateLastShowTime();\n    }\n\n    protected increaseErrorCounter(){\n        this._errorCounter++;\n    }\n\n    protected resetErrorCounter(){\n        this._errorCounter = 0;\n    }\n\n    protected setFatalError(){\n        this._fatalError = true;\n    }\n\n    public isErrorTooMany(){\n        return this._fatalError || (this._maxLoadError>0 && this._errorCounter >= this._maxLoadError);\n    }\n}\n\n// 有状态的广告对象\nabstract class FBStatefulAdUnit extends FBAdUnitBase{\n    private _adInstance:FBInstant.AdInstance;\n\n    private _autoLoadOnPlay:boolean; // 播放完毕后是否立即自动加载\n    \n    constructor(id:string, type:number, sharedTimer:AdTimer, opt?:FBAdOption){\n        super(id, type, sharedTimer, opt);\n        this._adInstance = null;\n        this._autoLoadOnPlay = getOption(opt, \"autoLoadOnPlay\", false);\n    }\n\n    protected abstract createAdInstanceAsync(adId:string):Promise<FBInstant.AdInstance>;\n\n    // 预加载广告\n    public async loadAsync(){\n        // [1] 获取 AdInstance\n        if(this._adInstance == null){\n            if(this._state == FB_AD_STATE.NONE){\n                // 只能创建一次\n                this._state = FB_AD_STATE.NEW;\n\n                utils.showLog(\"获取广告对象: \" + this.getInfo());\n\n                this._adInstance = await this.createAdInstanceAsync(this._adId);\n            }else{\n                // 已经在创建对象了 （new-ing)\n                utils.showLog(\"当前状态未满足加载条件, 正在获取广告对象: \" + this.getInfo());\n                return;\n            }\n        }else{\n            // 对象已经创建好\n            // 可以进行预加载\n        }\n\n        // [2] 检查是否满足预加载条件\n        if(this._state != FB_AD_STATE.NEW){\n            // 只有 NEW 状态才能进行加载\n            utils.showLog(\"当前状态未满足加载条件: \" + this.getInfo());\n            if(this._state == FB_AD_STATE.LOADING){\n                utils.showLog(\"广告正在加载中，不要重复加载\" + this.getInfo());\n                throw ErrorAdIsLoading;\n            }else{\n                throw ErrorNotReadyForLoad;\n            }\n        }\n\n        if(this.isErrorTooMany()){\n            utils.showLog(\"太多错误，停止加载: \" + this.getInfo());\n            throw ErrorTooManyErrors;\n        }\n\n        try{\n            // [3] 加载广告\n            // 设置为加载中\n            this._state = FB_AD_STATE.LOADING;\n\n            utils.showLog(\"开始加载广告: \" + this.getInfo());\n            await this._adInstance.loadAsync();\n\n            // [4] 成功加载\n            this._state = FB_AD_STATE.LOADED;\n            this.resetErrorCounter();\n\n            utils.showLog(\"广告加载成功: \" + this.getInfo());\n            return true;\n        }catch(e){\n            // [5] 加载失败\n            // 异常能正常进入promise的catch分支\n\n            // 加载失败，不需要重置 adInstance\n            // this._adInstance = null;\n            // 状态回退到加载前\n\n            utils.showLog(\"广告加载失败: \" + this.getInfo(), e);\n            if((e as FB_ERROR).code == FB_ERROR_ADS_NO_FILL){\n                // 遇到 NOT FILL错误，就不能再继续加载了\n                utils.showLog(\"广告无法填充，不再继续请求: \" + this.getInfo());\n                this.setFatalError();\n            }else{\n                this.increaseErrorCounter();\n                this._state = FB_AD_STATE.NEW;\n    \n                // [6] 加载失败，自动重新加载\n                // 适当延迟\n                let delayTime = 10 * this._errorCounter + FB_AUTO_RELOAD_DELAY;\n                utils.showLog(\"延迟\" + delayTime + \"秒后, 自动重新加载: \" + this.getInfo());\n                waitTimeSecond(delayTime, this.loadAsync.bind(this));\n           }\n\n            throw e;\n        }\n    }\n\n    // 广告是否加载完毕\n    public isReady(){\n        return this._adInstance != null && this._state == FB_AD_STATE.LOADED;\n    }\n\n    // 播放广告\n    public async showAsync(){\n        // [1.1] 判断是否满足播放条件\n        if(!this.isReady()){\n            utils.showLog(\"当前状态未满足播放条件: \" + this.getInfo());\n            if(this._state == FB_AD_STATE.PLAYING){\n                throw ErrorAdIsPlaying;\n            }else{\n                throw ErrorNotReadyForPlay;\n            }\n        }\n        \n        // [1.2] 是否满足播放间隔\n        if(!this.isReadyToRefresh()){\n            utils.showLog(\"播放太频繁，还需间隔\" + this.getNextRefreshInterval() + \" 秒: \" + this.getInfo());\n            throw ErrorTooFastShow;\n        }\n\n        try{\n            // [2] 播放广告\n            // 设置为播放中\n            this._state = FB_AD_STATE.PLAYING;\n\n            utils.showLog(\"开始播放广告: \" + this.getInfo());\n            await this._adInstance.showAsync();\n\n            utils.showLog(\"播放广告完毕: \" + this.getInfo());\n\n            // [3] 播放完毕后重置广告对象\n            this._adInstance = null;\n            this._state = FB_AD_STATE.NONE;\n            this.updateLastShowTime();\n\n            // [4] 播完自动加载\n            if(this._autoLoadOnPlay){\n                // TODO: 应该适当延迟\n                utils.showLog(\"延迟\" + FB_AUTO_RELOAD_DELAY + \"秒后, 自动重新加载: \" + this.getInfo());\n                waitTimeSecond(FB_AUTO_RELOAD_DELAY, this.loadAsync.bind(this));\n            }\n            return true;\n        }catch(e){\n            // [5] 播放完毕后重置广告对象\n            utils.showLog(\"播放广告失败: \" + this.getInfo(), e);\n            if(e.code == FB_ERROR_CODE_RATE_LIMITED){\n                // 播放太频繁，可忽略\n                // 状态回退\n                this._state = FB_AD_STATE.LOADED;\n            }else{\n                this._adInstance = null;\n                this._state = FB_AD_STATE.NONE;\n    \n                // [6] 失败自动重新加载\n                if(this._autoLoadOnPlay){\n                    utils.showLog(\"延迟\" + FB_AUTO_RELOAD_DELAY + \"秒后, 自动重新加载: \" + this.getInfo());\n                    waitTimeSecond(FB_AUTO_RELOAD_DELAY, this.loadAsync.bind(this));\n                }    \n            }\n\n            throw e;\n        }\n\n        // return false;\n    }\n}\n\n// 插屏广告\nclass FBInterstitialUnit extends FBStatefulAdUnit{\n    constructor(id:string, sharedTimer:AdTimer, opt?:FBAdOption){\n        super(id, FB_AD_TYPE.INTERSTITIAL, sharedTimer, opt);\n    }\n\n    protected async createAdInstanceAsync(adId: string){\n        return await FBInstant.getInterstitialAdAsync(this._adId);\n    }\n}\n\n// 激励视频广告\nclass FBRewardedVideoUnit extends FBStatefulAdUnit{\n    constructor(id:string, sharedTimer:AdTimer, opt?:FBAdOption){\n        super(id, FB_AD_TYPE.REWARDED_VIDEO, sharedTimer, opt);\n    }\n\n    protected async createAdInstanceAsync(adId: string){\n        return await FBInstant.getRewardedVideoAsync(this._adId);\n    }\n}\n\n// 横幅广告\nclass FBBannerUnit extends FBAdUnitBase{\n    constructor(id:string, sharedTimer:AdTimer,opt?:FBAdOption){\n        super(id, FB_AD_TYPE.BANNER, sharedTimer, opt);\n    }\n\n    // 显示Banner广告, 注意可以调用多次\n    public async showAsync(){\n        if(!this.isReadyToRefresh()){\n            utils.showLog(\"播放太频繁，还需间隔\" + this.getNextRefreshInterval() + \" 秒: \" + this.getInfo());\n            throw ErrorTooFastShow;\n        }\n\n        if(this.isErrorTooMany()){\n            utils.showLog(\"太多错误，停止加载: \" + this.getInfo());\n            throw ErrorTooManyErrors;\n        }\n\n        try{\n            this._state = FB_AD_STATE.PLAYING;\n            utils.showLog(\"开始显示广告: \" + this.getInfo());\n            await FBInstant.loadBannerAdAsync(this._adId);\n            utils.showLog(\"显示广告成功: \" + this.getInfo());\n            \n            // 更新刷新时间\n            this.updateLastShowTime();\n            this.resetErrorCounter();\n        }catch(e){\n            utils.showLog(\"显示广告失败: \" + this.getInfo(), e);\n            if(e.code == FB_ERROR_CODE_RATE_LIMITED){\n                // 播放太频繁，可忽略\n                // 不用重置，保留\n            }else if(e.code == FB_ERROR_ADS_NO_FILL){\n                // 遇到 NOT FILL错误，就不能再继续加载了\n                utils.showLog(\"广告无法填充，不再继续请求: \" + this.getInfo());\n                this.setFatalError();\n            }else{\n                this.increaseErrorCounter();\n            }\n            \n            throw e;\n        }\n    }\n\n    public async hideAsync(){\n        if(this._state != FB_AD_STATE.PLAYING){\n            utils.showLog(\"广告没有在播放中: \" + this.getInfo());\n            throw ErrorNotPlaying;\n        }\n\n        try{\n            utils.showLog(\"隐藏广告: \" + this.getInfo());\n            // TODO: 重复隐藏广告不会报错\n            await FBInstant.hideBannerAdAsync();\n            this._state = FB_AD_STATE.NONE;\n        }catch(e){\n            utils.showLog(\"隐藏广告失败: \" + this.getInfo(), e);\n            \n            // 隐藏失败不做任何操作\n            // this._state = FB_AD_STATE.NONE;\n            throw e;\n        }\n    }\n}\n\nexport default class FBAdManager{\n    public static getVersion(){\n        return \"1.0.2\";\n    }\n\n    private static _interstitialAds:Array<FBStatefulAdUnit> = [];\n    private static _rewardedVideos:Array<FBStatefulAdUnit> = [];\n    private static _banners:Array<FBBannerUnit> = [];\n\n    private static _interstitialTimer:AdTimer = null;\n    private static _rewardedVideoTimer:AdTimer = null;\n    private static _bannerTimer:AdTimer = null;\n\n    private static _bannerSupport = undefined;\n\n    // 插屏广告默认参数\n    public static defaultInterstitialOption:FBAdOption = {\n        autoLoadOnPlay: FB_AUTO_LOAD_ON_PLAY,\n        maxLoadError: FB_MAX_INTERSTITIAL_ERROR,\n    };\n\n    // 激励视频默认参数\n    public static defaultRewardedVideoOption:FBAdOption = {\n        autoLoadOnPlay: FB_AUTO_LOAD_ON_PLAY,\n        maxLoadError: FB_MAX_REWARDED_VIDEO_ERROR,\n    };\n    \n    // banner默认参数\n    public static defaultBannerOption:FBAdOption = {\n        autoLoadOnPlay: FB_AUTO_LOAD_ON_PLAY, // banner不需要这个参数\n        maxLoadError: FB_MAX_BANNER_ERROR,\n    };\n\n    // 插屏广告计时器默认参数\n    public static defaultInterstitialTimerOption:AdTimerOption = {\n        refreshInterval: FB_INTERSTITIAL_REFRESH_INTERVAL,\n        delayForFirstAd: FB_AD_DELAY_FOR_FIRST_INTERSTITIAL\n    };\n\n    // 激励视频计时器默认参数\n    public static defaultRewardedVideoTimerOption:AdTimerOption = {\n        refreshInterval: FB_REWARDED_VIDEO_REFRESH_INTERVAL,\n        delayForFirstAd: FB_AD_DELAY_FOR_FIRST_REWARDED_VIDEO\n    };\n    \n    // banner计时器默认参数\n    public static defaultBannerTimerOption:AdTimerOption = {\n        refreshInterval: FB_BANNER_REFRESH_INTERVAL,\n        delayForFirstAd: FB_AD_DELAY_FOR_FIRST_BANNER\n    };\n\n    // 1.1 添加插屏广告\n    // 返回已经添加的插屏广告总数\n    public static addInterstitial(id:string, count:number=FB_INIT_AD_COUNT){\n        if(this._interstitialTimer == null){\n            this._interstitialTimer = new AdTimer(this.defaultInterstitialTimerOption.refreshInterval, this.defaultInterstitialTimerOption.delayForFirstAd);\n        }\n\n        for(let i=0;i<count;i++){\n            if(this._interstitialAds.length >= FB_MAX_AD_INSTANCE){\n                utils.showLog(\"添加插屏广告失败, 超出限制: \" + this._interstitialAds.length, id);\n                throw ErrorTooManyAdInstance;\n            }\n    \n            let adUnit = new FBInterstitialUnit(id, this._interstitialTimer, this.defaultInterstitialOption);\n    \n            this._interstitialAds.push(adUnit);\n            utils.showLog(\"添加插屏广告: \" + id, \"count: \" + this._interstitialAds.length);    \n        }\n\n        return this._interstitialAds.length;\n    }\n\n    // 1.2. 添加激励视频广告\n    // 返回已经添加的激励视频总数\n    public static addRewardedVideo(id:string, count:number=FB_INIT_AD_COUNT){\n        if(this._rewardedVideoTimer == null){\n            this._rewardedVideoTimer = new AdTimer(this.defaultRewardedVideoTimerOption.refreshInterval, this.defaultRewardedVideoTimerOption.delayForFirstAd);\n        }\n\n        for(let i=0;i<count;i++){\n            if(this._rewardedVideos.length >= FB_MAX_AD_INSTANCE){\n                utils.showLog(\"添加激励视频广告失败, 超出限制: \" + this._rewardedVideos.length, id);\n                throw ErrorTooManyAdInstance;\n            }\n            \n            let adUnit = new FBRewardedVideoUnit(id, this._rewardedVideoTimer, this.defaultRewardedVideoOption);\n            this._rewardedVideos.push(adUnit);\n            utils.showLog(\"添加激励视频广告: \" + id, \"count: \" + this._rewardedVideos.length);\n        }\n\n        return this._rewardedVideos.length;\n    }\n\n    // 1.3. 添加Banner广告\n    public static addBanner(id:string){\n        if(this._bannerTimer == null){\n            this._bannerTimer = new AdTimer(this.defaultBannerTimerOption.refreshInterval, this.defaultBannerTimerOption.delayForFirstAd);\n        }\n\n        let adUnit = new FBBannerUnit(id, this._bannerTimer, this.defaultBannerOption);\n        this._banners.push(adUnit);\n        utils.showLog(\"添加Banner广告: \" + id, \"count: \" + this._banners.length);\n\n        return adUnit;\n    }\n\n    // 2. 初始化和预加载\n    // Deprecated 此方法用于保持兼容, 建议使用 loadAllAsync\n    public static async loadAll(){\n        utils.showLog(\"初始化广告队列\");\n        return await this.loadAllAsync();\n    }\n\n    // 异步顺序预加载所有广告\n    public static async loadAllAsync(){\n        utils.showLog(\"FBAdManager Version: \" + this.getVersion());\n        utils.showLog(\"初始化广告队列\");\n        // 两次加载间间隔N秒\n        // 先加载激励视频\n        for(let i=0;i<this._rewardedVideos.length;i++){\n            const adUnit = this._rewardedVideos[i];\n\n            if(i>0){\n                await waitTimeSecond(0.1);\n            }           \n            try{\n                await adUnit.loadAsync();\n            }catch(e){\n                \n            }\n        }\n        // 之后加载插屏\n        for(let i=0;i<this._interstitialAds.length;i++){\n            const adUnit = this._interstitialAds[i];\n            if(i>0){\n                await waitTimeSecond(0.1);\n            }           \n            try{\n                await adUnit.loadAsync();\n            }catch(e){\n\n            }\n        }\n    }\n\n    private static _isAdReady(type: FB_AD_TYPE){\n        let adUnits = (type == FB_AD_TYPE.INTERSTITIAL)?this._interstitialAds:this._rewardedVideos;\n        let isReady = false;\n        for(let i=0;i<adUnits.length;i++){\n            const adUnit = adUnits[i];\n            if(adUnit.isReady() && adUnit.isReadyToRefresh()){\n                isReady = true;\n                break;\n            }\n        }\n\n        return isReady;\n    }\n\n    private static _showAsync(type: FB_AD_TYPE){\n        let adUnits = (type == FB_AD_TYPE.INTERSTITIAL)?this._interstitialAds:this._rewardedVideos;\n        let readyUnit:FBStatefulAdUnit = null;\n\n        for(let i=0;i<adUnits.length;i++){\n            const adUnit = adUnits[i];\n            if(adUnit.isReady() && adUnit.isReadyToRefresh()){\n                readyUnit = adUnit;\n                break;\n            }\n        }\n\n        if(readyUnit != null){\n            return readyUnit.showAsync();\n        }\n\n        throw ErrorNoReadyAdInstance;\n    }\n\n    private static _getAdTimer(type: FB_AD_TYPE){\n        if(type == FB_AD_TYPE.INTERSTITIAL){\n            return this._interstitialTimer;\n        }\n        if(type == FB_AD_TYPE.REWARDED_VIDEO){\n            return this._rewardedVideoTimer;\n        }\n        return this._bannerTimer;\n    }\n\n    // 3.1. 判断是否可以播放插屏广告\n    public static isInterstitialAdReady(){\n        return this._isAdReady(FB_AD_TYPE.INTERSTITIAL);\n    }\n\n    // 4.1. 播放插屏广告\n    public static async showInterstitialAd(){\n        return await this._showAsync(FB_AD_TYPE.INTERSTITIAL);\n    }\n\n    // 3.2. 判断是否可以播放激励视频广告\n    public static isRewardedVideoReady(){\n        return this._isAdReady(FB_AD_TYPE.REWARDED_VIDEO);\n    }\n\n    // 4.2. 播放激励视频广告\n    public static async showRewardedVideo(){\n        return await this._showAsync(FB_AD_TYPE.REWARDED_VIDEO);\n    }\n\n    // 6. 检查是否支持对应API\n    public static checkApiSupport(api:string){\n        if(FBInstant.getSupportedAPIs().indexOf(api) >= 0){\n            return true;\n        }\n        else{\n            return false;\n        }\n    }\n\n    // 6.1. 是否支持banner\n    public static isBannerSupport(){\n        if(typeof this._bannerSupport == \"undefined\"){\n            this._bannerSupport = this.checkApiSupport(FB_API_BANNER);   \n        }\n\n        return this._bannerSupport;\n    }\n\n    // 3.3. banner广告是否可以刷新或者重新加载\n    public static isBannerReady(){\n        if(this._banners.length <= 0){\n            throw ErrorNoBannerAdInstance;\n        }\n\n        let adUnit = this._banners[0];\n        return adUnit.isReadyToRefresh();\n    }\n\n    // 4.3. 播放默认banner广告\n    public static async showBannerAsync(){\n        if(!this.isBannerSupport()){\n            throw ErrorApiNotSupport;\n        }\n\n        if(this._banners.length <= 0){\n            throw ErrorNoBannerAdInstance;\n        }\n\n        let adUnit = this._banners[0];\n        return await adUnit.showAsync();\n    }\n\n    // 5.3. 隐藏默认banner广告\n    public static async hideBannerAsync(){\n        if(!this.isBannerSupport()){\n            throw ErrorApiNotSupport;\n        }\n\n        if(this._banners.length <= 0){\n            throw ErrorNoBannerAdInstance;\n        }\n\n        let adUnit = this._banners[0];\n        return await adUnit.hideAsync();\n    }\n}"]}