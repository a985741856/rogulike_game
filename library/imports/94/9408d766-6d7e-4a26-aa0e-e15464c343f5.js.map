{"version":3,"sources":["assets\\scripts\\UI\\UITrySkinPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { access } from \"fs\";\r\nimport PlatUtils from \"../../common-plugin/Scripts/PlatUtils\";\r\nimport { utils } from \"../../common-plugin/Scripts/Utils\";\r\nimport { BannerLocation } from \"../../common-plugin/Scripts/YZ_Constant\";\r\nimport { cocosz } from \"../Framework/CocosZ\";\r\nimport { PanelName } from \"../Framework/Constant\";\r\nimport UIPage from \"../Framework/UIPage\";\r\nimport Ani from \"../Game/ani\";\r\n\r\nconst { ccclass } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class UITrySkinPanel extends UIPage {\r\n\r\n    private _mask: cc.Node = null;\r\n    private _panel: cc.Node = null;\r\n\r\n    private aniArr: cc.Node[] = [];\r\n\r\n    private btnArr: cc.Node[] = [];\r\n\r\n    skinArr: number[] = [];\r\n\r\n    constructor() {\r\n        super(PanelName.UITrySkinPanel);\r\n        this.isValid() && this.onLoad();\r\n    }\r\n\r\n    protected onLoad() {\r\n        this._panel = this._page.getChildByName(\"Panel\");\r\n        this._mask = this._page.getChildByName(\"Mask\");\r\n\r\n        this.aniArr[0] = this._panel.getChildByName(\"ani0\");\r\n        this.aniArr[1] = this._panel.getChildByName(\"ani1\");\r\n        this.aniArr[2] = this._panel.getChildByName(\"ani2\");\r\n\r\n        let btnNames: string[] = [\"BtnVideo0\", \"BtnVideo1\", \"BtnVideo2\", \"BtnPass\"];\r\n        for (let i = 0; i < btnNames.length; i++) {\r\n            let btn: cc.Node = cc.find(btnNames[i], this._panel);\r\n            if (btn) {\r\n                this.btnArr[i] = btn;\r\n                btn.on(cc.Node.EventType.TOUCH_END, this._onBtnClickedHandler, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onOpen() {\r\n        utils.SendEvent(\"页面-皮肤试用\");\r\n        // 暂停游戏逻辑\r\n        cocosz.pauseCount++;\r\n        // 未解锁的皮肤id数组\r\n        let arr = cocosz.dataMgr.getRandomLockSkin();\r\n        if (arr.length > 0) {\r\n            // 随机3个皮肤\r\n            for (let i = 0; i < 3; i++) {\r\n                if (arr.length > 0) {\r\n                    let index = Math.floor(Math.random() * arr.length);\r\n                    let id = arr[index];\r\n                    arr.splice(index, 1);\r\n                    this.skinArr[i] = id;\r\n                    // 显示任务\r\n                    let aniTs = this.aniArr[i].getComponent(Ani);\r\n                    aniTs.setSkinById(id);\r\n                    aniTs.setWeaponById(cocosz.dataMgr.CurRange);\r\n                    this.aniArr[i].opacity = 0;\r\n                    cocosz.scheduleOnce(() => {\r\n                        if (this._page && this.aniArr[i]) {\r\n                            cc.tween(this.aniArr[i])\r\n                                .set({ y: 500, opacity: 255 })\r\n                                .to(0.4, { y: 50 }, { easing: \"sineOut\" })\r\n                                .start();\r\n                        }\r\n                    }, 0.3 * i)\r\n                } else {\r\n                    // 皮肤不够隐藏\r\n                    this.aniArr[i].active = false;\r\n                    this.btnArr[i].active = false;\r\n                }\r\n            }\r\n        } else {\r\n            // 没有未解锁皮肤，自动隐藏\r\n            cocosz.uiMgr.closePanel(PanelName.UITrySkinPanel);\r\n        }\r\n    }\r\n\r\n    protected onClose(): void {\r\n        cocosz.gameMgr.gameStart(cocosz.curLevel);\r\n    }\r\n\r\n    /**\r\n     * 所有按钮点击事件\r\n     * @param event \r\n     * @param data \r\n     */\r\n    private async _onBtnClickedHandler(event: cc.Event, data: any) {\r\n        //播放按钮点击音效\r\n        await cocosz.audioMgr.playBtnEffect().catch();\r\n        switch (event.target.name) {\r\n            case \"BtnVideo0\":\r\n            case \"BtnVideo1\":\r\n            case \"BtnVideo2\": {\r\n                utils.SendEvent(\"视频-弹窗角色试用-播放\")\r\n                cocosz.watchAD(() => {\r\n                    // 视频成功\r\n                    utils.SendEvent(\"视频-弹窗角色试用-成功\")\r\n                    if (event.target.name == \"BtnVideo0\") {\r\n                        cocosz.gameMgr.gameCtr.curUseSkinId = this.skinArr[0];\r\n                    } else if (event.target.name == \"BtnVideo1\") {\r\n                        cocosz.gameMgr.gameCtr.curUseSkinId = this.skinArr[1];\r\n                    } else if (event.target.name == \"BtnVideo2\") {\r\n                        cocosz.gameMgr.gameCtr.curUseSkinId = this.skinArr[2];\r\n                    }\r\n                    cocosz.uiMgr.closePanel(PanelName.UITrySkinPanel);\r\n                }, () => {\r\n                    // 视频失败\r\n                    utils.SendEvent(\"视频-弹窗角色试用-失败\")\r\n                    cocosz.uiMgr.closePanel(PanelName.UITrySkinPanel);\r\n                })\r\n                break;\r\n            }\r\n            case \"BtnPass\": {\r\n                cocosz.uiMgr.closePanel(PanelName.UITrySkinPanel);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}