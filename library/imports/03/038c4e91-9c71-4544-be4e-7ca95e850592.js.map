{"version":3,"sources":["assets\\common-plugin\\Scripts\\TryGameNode.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\r\nimport { SubLocation } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TryGameNode extends cc.Component {\r\n    _data: any = null;\r\n    _icon: cc.Sprite = null;\r\n    _nameLabel: cc.Label = null;\r\n    _gameJumpInterval: number = -1;\r\n    _jumpInfo: any = null;\r\n    _index: number = -1;\r\n    _jumping: boolean = false; // 控制是否在跳转\r\n    _isFirst: boolean = false;\r\n    _mask: cc.Node = null;\r\n\r\n    onLoad() {\r\n        this._icon = cc.find(\"Mask/Icon\", this.node).getComponent(cc.Sprite);\r\n        this._mask = cc.find(\"Mask\", this.node);\r\n\r\n        // this._nameLabel = cc.find(\"NameLabel\", this.node).getComponent(cc.Label);\r\n        // this._nameLabel.string = \"\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param data 交叉推广数据\r\n     * data:{\r\n\t   \"jump_list\": [\r\n           {                                                        // 交叉推广挂件内容信息\r\n\t\t    \"icon\": \"http://xcx.youletd.com/img/icon/fgdxc.png\",\r\n\t\t    \"name\": \"翻滚的香肠大冒险\",\r\n\t\t    \"path\": \"\",\r\n\t\t    \"js_jump\": \"true\",\r\n\t\t    \"qr_code\": \"http://xcx.youletd.com/img/qrcode/q_fgdxc.jpg\",\r\n\t\t    \"appid\": \"wx2c4ed4218224b042\"\r\n            }\r\n        ]\r\n     * }\r\n     * \r\n     */\r\n    public init(data: any) {\r\n        this._data = data;\r\n        if (this._data) {\r\n            this._jumpInfo = this._data.jump_list;\r\n            this._gameJumpInterval = this._data.jump_refresh_time;\r\n            this._isFirst = true;\r\n            this.node.active = false;\r\n        } else {\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 跳转成功过后显示下一个\r\n     */\r\n    showNextItem() {\r\n        this.unscheduleAllCallbacks();\r\n        this.jump();\r\n        this.schedule(this.jump, this._gameJumpInterval);\r\n    }\r\n\r\n    onEnable() {\r\n        this.jump();\r\n        this.schedule(this.jump, this._gameJumpInterval);\r\n        this.node.on(cc.Node.EventType.TOUCH_START, (event) => {\r\n            if (this._jumpInfo[this._index] && this._jumpInfo[this._index].appid) {\r\n                utils.showLog(`小游戏跳转! info=${this._jumpInfo[this._index]}`);\r\n                if (PlatUtils.IsDouyin) {\r\n                    utils.Tool_Douyin.showMoreGamesModal();\r\n                } else if (PlatUtils.IsQQ) {\r\n                    utils.adManager.ShowAppBox(true);\r\n                } else {\r\n                    let index: number = this._index;\r\n                    this._postClickData(this._jumpInfo[index].appid);\r\n                    utils.navigateToMiniGame(this._jumpInfo[index], (ret) => {\r\n                        if (ret) {\r\n                            // 上报数据\r\n                            if (this._jumpInfo && this._jumpInfo[index] && this._jumpInfo[index].appid) {\r\n                                this._postData(this._jumpInfo[index].appid);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                this.showNextItem();\r\n\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.unscheduleAllCallbacks();\r\n        this.node.targetOff(this);\r\n    }\r\n\r\n    jump() {\r\n        if (this._jumping) return;\r\n\r\n        this._jumping = true;\r\n\r\n        this._index = this._index + 1;\r\n        if (this._index >= this._jumpInfo.length) {\r\n            this._index = 0;\r\n        }\r\n        let contentSize = this._icon.node.getContentSize();\r\n        if (this._jumpInfo[this._index] && this._jumpInfo[this._index].icon) {\r\n            // this._setName(this._jumpInfo[this._index].name);\r\n            let remoteUrl = this._jumpInfo[this._index].icon;\r\n            CompatibleTool.LoadRes(remoteUrl, (err, texture) => {\r\n                if (!err && cc.isValid(this) && this._icon) {\r\n                    this._icon.spriteFrame = new cc.SpriteFrame(texture);\r\n                    this._icon.node.setContentSize(contentSize);\r\n                    if (this._isFirst) {\r\n                        utils.showLog(\"当前试玩第一次加载！！！！！\");\r\n                        this._mask.active = true;\r\n                        this._isFirst = false;\r\n                    }\r\n                }\r\n                this._jumping = false;\r\n            });\r\n        } else {\r\n            this._jumping = false;\r\n        }\r\n    }\r\n\r\n    _setName(name: string) {\r\n        if (!name) {\r\n            this._nameLabel.string = \"\";\r\n        } else {\r\n            if (name.length > 5) {\r\n                this._nameLabel.string = name.slice(0, 5) + \"...\";\r\n                this._nameLabel.node.scale = 0.7;\r\n            } else {\r\n                this._nameLabel.string = name;\r\n            }\r\n        }\r\n    }\r\n\r\n    // _postData(appid: string) {\r\n    //     utils.postData(appid);\r\n    // }\r\n\r\n    /**\r\n     * 上报跳转成功\r\n     * @param appid \r\n     */\r\n    _postData(appid: string) {\r\n        utils.postDataByLocation(appid, SubLocation.isTryGame, 1);\r\n    }\r\n\r\n\r\n    /**\r\n     * 上报点击\r\n     * @param appid \r\n     */\r\n    _postClickData(appid: string) {\r\n        utils.postDataByLocation(appid, SubLocation.isTryGame, 0);\r\n    }\r\n\r\n}\r\n"]}