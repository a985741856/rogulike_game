{"version":3,"sources":["assets\\common-plugin\\Scripts\\MoreGamesWidget.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import MoreGamesPanel from \"./MoreGamesPanel\";\r\nimport { utils } from \"./Utils\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport AldUtils from \"./AldUtils\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\nimport { SubLocation } from \"./YZ_Constant\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MoreGamesWidget extends cc.Component {\r\n\r\n    @property(cc.Prefab)\r\n    prefab: cc.Prefab = null;\r\n\r\n    @property(cc.Prefab)\r\n    prefab1: cc.Prefab = null;\r\n\r\n\r\n    btnMoreGames: cc.Node = null;\r\n    moreGamesPanel: MoreGamesPanel = null;\r\n\r\n    bgTexture: cc.SpriteFrame;\r\n    onLoad() {\r\n        this.btnMoreGames = this.node.getChildByName(\"Btn_MoreGames\");\r\n\r\n        this.btnMoreGames.active = false;\r\n        let self = this;\r\n        let back = this.btnMoreGames.getChildByName(\"Background\").getComponent(cc.Sprite);\r\n        let backUrl\r\n        if (utils.ServerConfig) {\r\n            backUrl = utils.ServerConfig.more_game_icon;\r\n        } else {\r\n            cc.warn(\"没有服务器配置\");\r\n        }\r\n        if (backUrl && !this.bgTexture) {\r\n            CompatibleTool.LoadRes(backUrl, (err, texture) => {\r\n                if (!err && cc.isValid(this) && back.node) {\r\n                    let size: cc.Size = back.node.getContentSize();\r\n                    self.bgTexture = new cc.SpriteFrame(texture);\r\n                    back.spriteFrame = self.bgTexture;\r\n                    back.node.setContentSize(size);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        utils.registerServerInitEvent(() => {\r\n            this._setBtnVisible();\r\n        }, this);\r\n    }\r\n\r\n    onDisable() {\r\n        utils.unregisterServerInitEvent(this);\r\n    }\r\n\r\n    _setBtnVisible() {\r\n        let valid: boolean = true;\r\n        if (utils.isShowMoreGamesWidget()) {\r\n            if (PlatUtils.IsQQ) {\r\n                this.btnMoreGames.active = true;\r\n            } else if (PlatUtils.Is4399) {\r\n                this.btnMoreGames.active = true;\r\n            } else if (PlatUtils.IsNativeAndroid && utils.Tool_Native && utils.config.nativeAndroidConfig.channel == \"oppo\") {\r\n                this.btnMoreGames.active = true;\r\n            } else if (utils.ServerConfig.show_oppo_rec && utils.ServerConfig.show_oppo_rec == \"true\") {\r\n                this.btnMoreGames.active = true;\r\n            } else {\r\n                let gameList: any = utils.getRecommondGameList();\r\n                if (gameList) {\r\n                    if (gameList.length > 0 || CC_DEBUG) {\r\n                        this.btnMoreGames.active = true;\r\n                    } else {\r\n                        cc.warn(\"\b\b交叉推广数据列表长度为0, 更多游戏按钮不显示!\");\r\n                        valid = false;\r\n                    }\r\n                } else {\r\n                    cc.warn(\"\b\b交叉推广数据列表数据为null, 更多游戏按钮不显示!\");\r\n                    valid = false;\r\n                }\r\n            }\r\n\r\n        } else {\r\n            valid = false;\r\n        }\r\n\r\n        if (!valid) {\r\n            this.node.destroy();\r\n        }\r\n    }\r\n\r\n    onBtnClickedHandler(event: cc.Event, data: any) {\r\n        if (PlatUtils.IsQQ) {\r\n            utils.adManager.ShowAppBox(true);\r\n            return;\r\n        } else if (PlatUtils.Is4399) {\r\n            utils.Tool_4399.showRecommend();\r\n            return;\r\n        } else if (PlatUtils.IsNativeAndroid && utils.Tool_Native && utils.Tool_Native.moreGameShowType == 1) {\r\n            //如果是原生平台，判断显示的类型\r\n            utils.Tool_Native.showMoreGames();\r\n            utils.postDataByLocation(\"123\", SubLocation.isMoreGame, 0);\r\n        } else if (PlatUtils.IsDouyin) {\r\n            utils.Tool_Douyin.showMoreGamesModal();\r\n        }\r\n        //  else if (PlatUtils.IsOPPO) {\r\n        //     utils.oppoTool.showOppoGamePortal();\r\n        // } \r\n        else {\r\n\r\n            if (utils.ServerConfig.show_oppo_rec && utils.ServerConfig.show_oppo_rec == \"true\") {\r\n                utils.showLog(\"服务器配置显示官方互推！\");\r\n                utils.oppoTool.showOppoGamePortal();\r\n                return;\r\n            }\r\n            let jumpList: any = utils.getRecommondGameList();\r\n            if (jumpList && jumpList.length > 0) {\r\n                utils.showLog(\"MoreGamePanel 交叉推广数据:\", JSON.stringify(jumpList));\r\n                let panel;\r\n                if (utils.ServerConfig.more_game_skin == 2 || CC_DEBUG) {\r\n                    panel = cc.instantiate(this.prefab1);\r\n                    panel.zIndex = 999999;\r\n                    this.moreGamesPanel = panel.getComponent(\"MoreGamesPanel1\");\r\n                } else {\r\n                    panel = cc.instantiate(this.prefab);\r\n                    panel.zIndex = 999999;\r\n                    this.moreGamesPanel = panel.getComponent(\"MoreGamesPanel\");\r\n                }\r\n\r\n                cc.director.getScene().addChild(panel);\r\n                this.moreGamesPanel._location = SubLocation.isMoreGame;\r\n                this.moreGamesPanel.init(jumpList);\r\n                this.moreGamesPanel.show();\r\n                AldUtils.SendEvent(\"点击更多游戏按钮\");\r\n\r\n            } else {\r\n                utils.showLog(\"获取交叉推广数据失败!\");\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n}\r\n"]}