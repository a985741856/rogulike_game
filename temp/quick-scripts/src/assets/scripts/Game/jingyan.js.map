{"version":3,"sources":["assets\\scripts\\Game\\jingyan.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { VibrateType } from \"../../common-plugin/Scripts/YZ_Constant\";\r\nimport { cocosz } from \"../Framework/CocosZ\";\r\nimport Constant from \"../Framework/Constant\";\r\nimport { gameMgr } from \"./gameMgr\";\r\nimport { upgradeMgr } from \"./UpgradeMgr\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Jingyan extends cc.Component {\r\n\r\n    isRun: boolean = false;\r\n\r\n    // 成功距离\r\n    moveSpeed: number = 1000;\r\n\r\n    onLoad() { }\r\n\r\n    start(): void { }\r\n\r\n    init() {\r\n        this.isRun = false;\r\n        cc.game.on(Constant.E_Skill_Citie, (e) => { this.isRun = true; }, this);\r\n    }\r\n\r\n    finish() {\r\n        upgradeMgr.curJingyan += 1;\r\n        cc.game.emit(Constant.E_GAME_LOGIC, { type: Constant.E_Jingyan_Finish });\r\n        if (!cocosz.isPause) {\r\n            gameMgr.playEffect(\"jingyan\");\r\n            gameMgr.shakeEffect(0, 0, true, VibrateType.Long);\r\n        }\r\n        // 回收\r\n        cc.game.targetOff(this);\r\n        gameMgr && gameMgr.isValid && gameMgr.nodePut(\"jingyan\", this.node);\r\n    }\r\n\r\n    private _time: number = -1;\r\n    protected update(dt: number): void {\r\n        if (this.isRun == false) {\r\n            if (++this._time % 10 == 0) {\r\n                this.activating();\r\n            }\r\n        }\r\n        else {\r\n            this.followTo(dt);\r\n        }\r\n    }\r\n\r\n    activating() {\r\n        if (upgradeMgr && upgradeMgr.isValid && gameMgr && gameMgr.playerTs && gameMgr.playerTs.isValid) {\r\n            let from: cc.Vec2 = this.node.getPosition();\r\n            let to: cc.Vec2 = gameMgr.playerTs.node.getPosition();\r\n            if (from.sub(to).mag() < upgradeMgr.jingyanRange) {\r\n                this.isRun = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    followTo(dt) {\r\n        if (upgradeMgr && upgradeMgr.isValid && gameMgr && gameMgr.playerTs && gameMgr.playerTs.isValid) {\r\n            let from = this.node.getPosition();\r\n            let to = gameMgr.playerTs.node.getPosition();\r\n            let div = to.subSelf(from);\r\n            let moveDis = this.moveSpeed * dt;\r\n            // 成功到达\r\n            if (div.mag() < moveDis) {\r\n                this.finish();\r\n            } else {\r\n                this.node.setPosition(from.addSelf(div.normalizeSelf().mulSelf(moveDis)));\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}