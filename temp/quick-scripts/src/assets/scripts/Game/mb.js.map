{"version":3,"sources":["assets\\scripts\\Game\\mb.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport { cocosz } from \"../Framework/CocosZ\";\r\nimport { ZindexLayer } from \"../Framework/Constant\";\r\nimport { gameMgr } from \"./gameMgr\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MB extends cc.Component {\r\n    @property({ type: cc.AudioClip, tooltip: \"音效\" })\r\n    clip: cc.AudioClip = null;\r\n\r\n    protected _spAni: sp.Skeleton = null;\r\n\r\n    onLoad() {\r\n        // spine动画\r\n        this._spAni = this.node.getChildByName(\"ani\").getComponent(sp.Skeleton);\r\n    }\r\n\r\n\r\n    start() {\r\n        this.node.zIndex = ZindexLayer.zindex_mb;\r\n        this._spAni.setAnimation(0, \"daiji\", false);\r\n    }\r\n\r\n    time: number = -1;\r\n    isAtk: boolean = false;\r\n    isHart: boolean = false;\r\n    canChangeState: boolean = true;\r\n    update(dt) {\r\n        if (cocosz.isPause || !gameMgr.isGameStart || gameMgr.isWin || gameMgr.isFail) {\r\n            return;\r\n        }\r\n        if (++this.time % 15 == 0) {\r\n            if (gameMgr && gameMgr.playerTs && gameMgr.playerTs.isDeath == false) {\r\n                let p1 = this.node.getPosition();\r\n                let p2 = gameMgr.playerTs.node.getPosition();\r\n                let dis = p1.subSelf(p2).mag();\r\n                if (dis < 400) {\r\n                    this.atkStart();\r\n                    if (dis < 300) {\r\n                        this.atkEnemy();\r\n                    }\r\n                } else {\r\n                    this.atkEnd();\r\n                }\r\n            } else {\r\n                this.atkEnd();\r\n            }\r\n        }\r\n    }\r\n\r\n    atkEnemy() {\r\n        if (this.isHart && gameMgr && gameMgr.playerTs) {\r\n            gameMgr.playerTs.hart(1, null);\r\n        }\r\n    }\r\n\r\n    atkStart() {\r\n        if (this.canChangeState && this.isAtk == false) {\r\n            this.canChangeState = false;\r\n            this.isAtk = true;\r\n            this.node.stopAllActions();\r\n            cc.tween(this.node)\r\n                .call(() => {\r\n                    this._spAni.setAnimation(0, \"doudong\", true);\r\n                })\r\n                .delay(0.5)\r\n                .call(() => {\r\n                    if (this.clip && this.clip.isValid) gameMgr.playClip(this.clip, this.node);\r\n                    this._spAni.setAnimation(0, \"zheng\", false);\r\n                    this._spAni.addAnimation(0, \"zheng2\", true);\r\n                    this.isHart = true;\r\n                })\r\n                .delay(3)\r\n                .call(() => {\r\n                    this.canChangeState = true;\r\n                })\r\n                .start();\r\n\r\n        }\r\n    }\r\n\r\n    atkEnd() {\r\n        if (this.canChangeState && this.isAtk == true) {\r\n            this.isAtk = false;\r\n            this.isHart = false;\r\n            this._spAni.setAnimation(0, \"daiji\", false);\r\n        }\r\n    }\r\n\r\n}\r\n"]}