{"version":3,"sources":["assets\\scripts\\Framework\\AudioMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlatUtils from \"../../common-plugin/Scripts/PlatUtils\";\r\nimport { cocosz } from \"./CocosZ\";\r\n\r\nexport default class AudioMgr {\r\n\r\n    private static _inst: AudioMgr;\r\n    public static get inst(): AudioMgr {\r\n        if (!AudioMgr._inst) {\r\n            AudioMgr._inst = new AudioMgr();\r\n        }\r\n        return AudioMgr._inst;\r\n    }\r\n\r\n    private _curMusicId: number = -1;\r\n    private _curMusicClip: cc.AudioClip = null;\r\n    private _videoOn: boolean = false;\r\n    public set videoOn(value: boolean) {\r\n        this._videoOn = value;\r\n    }\r\n    public get videoOn() {\r\n        return this._videoOn;\r\n    }\r\n\r\n    public get AudioOn() {\r\n        return cocosz.dataMgr.AudioOn;\r\n    }\r\n    public set AudioOn(value: boolean) {\r\n        cocosz.dataMgr.AudioOn = value;\r\n\r\n        if (value) {\r\n            if (this._curMusicClip) {\r\n                this._curMusicId = this._play(this._curMusicClip, true, 1);\r\n            }\r\n        } else {\r\n            this.stopAll();\r\n        }\r\n    }\r\n\r\n    // audioList: Array<cc.AudioClip> = [];\r\n\r\n    /**\r\n     * 播放背景音乐\r\n     * @param id  \r\n     */\r\n    public playBgm(loop: boolean = true) {\r\n        if (!this.AudioOn) return;\r\n        let str = \"bgm_ui\";\r\n        if (cc.director.getScene().name == \"Home\") {\r\n            str = \"bgm_ui\";\r\n        } else if (cc.director.getScene().name == \"Game\") {\r\n            str = \"bgm_6\";\r\n        } else {\r\n            return;\r\n        }\r\n        const res_bgm = cocosz.resMgr.getRes(str, cc.AudioClip);\r\n        if (res_bgm) {\r\n            this.stopAll();\r\n            setTimeout(() => { cc.audioEngine.playMusic(res_bgm, true); }, 0);\r\n        }\r\n    }\r\n\r\n    _guideAudioId: number = -1;\r\n    /** 播放新手音效 */\r\n    public playGuideAudio(name: string) {\r\n        if (this._guideAudioId != -1) {\r\n            cc.audioEngine.stop(this._guideAudioId);\r\n            this._guideAudioId = -1;\r\n        }\r\n        this._guideAudioId = cocosz.audioMgr.playEffect(name);\r\n    }\r\n\r\n    /**\r\n     * 播放音效\r\n     * @param url 音频路径\r\n     * @param loop 是否循环\r\n     * @param volume 音量\r\n     */\r\n    public playEffect(url: string, loop: boolean = false, volume: number = 1) {\r\n        if (this.videoOn || !this.AudioOn) return;\r\n        const music = cocosz.resMgr.getRes(url, cc.AudioClip);\r\n        if (music) {\r\n            this.audioIdList[url] = cc.audioEngine.play(music, loop, volume);\r\n            return this.audioIdList[url];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * 播放音效\r\n    * @param url 音频路径\r\n    * @param loop 是否循环\r\n    * @param volume 音量\r\n    */\r\n    public playClip(clip: cc.AudioClip, loop: boolean = false, volume: number = 1) {\r\n        if (this.videoOn || !this.AudioOn) return;\r\n        if (clip && clip.isValid) {\r\n            this.audioIdList[clip.name] = cc.audioEngine.play(clip, loop, volume);\r\n            return this.audioIdList[clip.name];\r\n        }\r\n    }\r\n\r\n    audioIdList: Array<number> = [];\r\n    public stopEffect(url: string) {\r\n        if (this.audioIdList[url] >= 0) {\r\n            cc.audioEngine.stop(this.audioIdList[url]);\r\n            this.audioIdList[url] = null;\r\n        }\r\n    }\r\n\r\n    public checkEffect(url: string) {\r\n        if (this.audioIdList[url]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**按钮音效 */\r\n    public playBtnEffect() {\r\n        return new Promise((resolve, reject) => {\r\n            this.playEffect(\"btn\");\r\n            setTimeout(() => {\r\n                resolve(1);\r\n            }, 200);\r\n        });\r\n    }\r\n\r\n    /**\r\n   * 播放胜利音效\r\n   */\r\n    public playEffectWinner(volume: number = 1) {\r\n        this.stopAll();\r\n        setTimeout(() => {\r\n            if (cocosz.gameMode != 6) {\r\n                this.playEffect(\"win\");\r\n            } else {\r\n                this.playEffect(\"zombie_win\");\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * 播放失败音效\r\n     */\r\n    public playEffectFailed(volume: number = 1) {\r\n        this.stopAll();\r\n        setTimeout(() => {\r\n            if (cocosz.gameMode != 6) {\r\n                this.playEffect(\"fail\");\r\n            } else {\r\n                this.playEffect(\"zombie_fail\");\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 暂停所有音效\r\n     */\r\n    public pauseAll() {\r\n        cc.audioEngine.pauseAll();\r\n    }\r\n\r\n    public resumeAll() {\r\n        // utils.delayCall(() => {\r\n        if (!this._videoOn) cc.audioEngine.resumeAll();\r\n        // }, 0)\r\n    }\r\n\r\n    public stopAll() {\r\n        cc.audioEngine.stopAll();\r\n        this.audioIdList = [];\r\n    }\r\n\r\n    private _play(clip: cc.AudioClip, loop: boolean, volume: number) {\r\n        if (!this.AudioOn) return -1;\r\n        return cc.audioEngine.play(clip, loop, volume);\r\n    }\r\n\r\n}"]}