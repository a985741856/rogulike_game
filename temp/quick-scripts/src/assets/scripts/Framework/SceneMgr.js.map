{"version":3,"sources":["assets\\scripts\\Framework\\SceneMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { gameMgr } from \"../Game/gameMgr\";\r\nimport setMap from \"../Game/setMap\";\r\nimport GuideLayer, { guideLayer } from \"../UI/GuideLayer\";\r\nimport { cocosz } from \"./CocosZ\";\r\n\r\nexport default class SceneMgr {\r\n\r\n    private static _inst: SceneMgr;\r\n    public static get inst(): SceneMgr {\r\n        if (!SceneMgr._inst) {\r\n            SceneMgr._inst = new SceneMgr();\r\n        }\r\n        return SceneMgr._inst;\r\n    }\r\n\r\n    private _activeScene: string = \"\";\r\n    private _timeInterval: number = 0;\r\n\r\n    public loadScene(name: string, onLunch: Function) {\r\n        if (this._activeScene == name) {\r\n            let curTime: number = (new Date()).getTime();\r\n            if (curTime - this._timeInterval < 1000) {\r\n                return;\r\n            }\r\n        }\r\n        this._timeInterval = new Date().getTime();\r\n        // 加载场景开始前\r\n        this.loadBefore(name, () => {\r\n            // 加载场景\r\n            cc.director.loadScene(name, () => {\r\n                this._activeScene = name;\r\n                onLunch();\r\n                // 加载场景完成后\r\n                this.loadFinish(name);\r\n            });\r\n        });\r\n    }\r\n\r\n    /** 加载场景开始前 */\r\n    loadBefore(name: string, call: Function) {\r\n        // 显示加载动画\r\n        if (guideLayer && guideLayer.isValid) {\r\n            if (name == \"Home\") {\r\n                guideLayer.node.zIndex = cc.macro.MAX_ZINDEX;\r\n                guideLayer.hideFjAni();\r\n                guideLayer.showBgAni();\r\n            } else if (name == \"Game\") {\r\n                console.log(cocosz.gameMode);\r\n                guideLayer.node.zIndex = cc.macro.MAX_ZINDEX;\r\n                if ([5, 7].includes(cocosz.gameMode)) {\r\n                    // 夺旗模式\r\n                    guideLayer.hideFjAni();\r\n                    guideLayer.showBgAni();\r\n                } else {\r\n                    guideLayer.hideBgAni();\r\n                    guideLayer.showFjAni();\r\n                }\r\n            }\r\n        }\r\n        // 跳转前释放\r\n        if (name == \"Home\") {\r\n            // 逐帧释放关卡节点\r\n            if (gameMgr && gameMgr.map && gameMgr.map.isValid) {\r\n                let mapTs = gameMgr.map.getComponent(setMap);\r\n                if (mapTs) {\r\n                    setTimeout(() => { mapTs.release(call) }, 100);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        call && call();\r\n    }\r\n\r\n    /** 加载场景完成后 */\r\n    loadFinish(name: string) {\r\n        if (name == \"Home\") {\r\n            // 加载动画(zindex)\r\n            if (guideLayer && guideLayer.isValid) {\r\n                guideLayer.node.zIndex = cc.macro.MIN_ZINDEX;\r\n            }\r\n            // 释放资源\r\n            // this.releaseRes();\r\n        }\r\n        else if (name == \"Game\") {\r\n            if (guideLayer && guideLayer.isValid) {\r\n                guideLayer.node.zIndex = cc.macro.MIN_ZINDEX;\r\n            }\r\n        }\r\n        // 刷新背景音效\r\n        cocosz.audioMgr.playBgm();\r\n    }\r\n\r\n    /** 释放游戏资源 */\r\n    releaseRes() {\r\n        // 释放游戏音效\r\n        let audio_game: any = [];\r\n        cocosz.getDirWithPath(\"audio_game\", cc.AudioClip, audio_game);\r\n        cocosz.resMgr.releaseResArray(audio_game, cc.AudioClip);\r\n\r\n        if (6 == cocosz.gameMode || 8 == cocosz.gameMode) {\r\n            // 释放地下城音效\r\n            let audio_zombie: any = [];\r\n            cocosz.getDirWithPath(\"audio_zombie\", cc.AudioClip, audio_zombie);\r\n            cocosz.resMgr.releaseResArray(audio_zombie, cc.AudioClip);\r\n            // 释放僵尸预制体\r\n            let prefab_zombie: any = [];\r\n            cocosz.getDirWithPath(\"prefab_zombie\", cc.Prefab, prefab_zombie);\r\n            cocosz.resMgr.releaseResArray(prefab_zombie, cc.Prefab);\r\n            // 释放技能预制体\r\n            let prefab_zombie_skill: any = [];\r\n            cocosz.getDirWithPath(\"prefab_zombie_skill\", cc.Prefab, prefab_zombie_skill);\r\n            cocosz.resMgr.releaseResArray(prefab_zombie_skill, cc.Prefab);\r\n            // 释放技能图片\r\n            let tex_zombie: any = [];\r\n            cocosz.getDirWithPath(\"tex_zombie\", cc.SpriteFrame, tex_zombie);\r\n            cocosz.resMgr.releaseResArray(tex_zombie, cc.SpriteFrame);\r\n        }\r\n    }\r\n}\r\n"]}