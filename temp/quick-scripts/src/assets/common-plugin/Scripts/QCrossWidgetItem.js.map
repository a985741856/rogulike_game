{"version":3,"sources":["assets\\common-plugin\\Scripts\\QCrossWidgetItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { SubLocation } from \"./YZ_Constant\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class QCrossWidgetItem extends cc.Component {\r\n\r\n    /*\r\n    {\r\n        \"name\": \"翻滚的香肠大冒险\",\r\n        \"appid\": \"wx2c4ed4218224b042\",\r\n        \"icon\": \"https://xcx.youletd.com/img/icon/fgdxc.png\",\r\n       \"logo\": \"https://xcx.youletd.com/img/logo/4.png\",\r\n        \"is_jump\": \"true\",\r\n        \"path\": \"\",\r\n        \"qr_code\": \"https://xcx.youletd.com/img/qrcode/q_fgdxc.jpg\"\r\n    }\r\n    */\r\n    data: any = null;\r\n\r\n    private _sprite: cc.Sprite = null;\r\n    private _dataDirty: boolean = false;\r\n    public _isReward: boolean = false;\r\n\r\n    public _location: SubLocation = null;\r\n\r\n    onLoad() {\r\n        this._sprite = this.node.getComponent(cc.Sprite);\r\n    }\r\n\r\n    public init(data: any) {\r\n        this.data = data;\r\n        this._dataDirty = true;\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this._dataDirty) {\r\n            this._dataDirty = false;\r\n            this.updateItem();\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onItemClickHandler, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.node.targetOff(this);\r\n    }\r\n\r\n    private _onItemClickHandler() {\r\n        console.log(\"_onItemClickHandler\");\r\n\r\n        if (PlatUtils.IsDouyin) {\r\n            utils.Tool_Douyin.showMoreGamesModal();\r\n            return;\r\n        }\r\n\r\n        if (this.data && this.data.appid) {\r\n            this._postClickData(this.data.appid);\r\n        }\r\n        //如果是激励模式就直接跳转\r\n        if (this._location == SubLocation.isReward) {\r\n            utils.navigateToMiniGame(this.data, (ret) => {\r\n                if (ret) {\r\n                    // 上报数据\r\n                    if (this.data && this.data.appid) {\r\n                        this._postData(this.data.appid);\r\n                    }\r\n                    utils.showLog(\"激励插屏跳转成功！下发奖励！\");\r\n                    utils.adManager.videoCallBack && utils.adManager.videoCallBack(ret);\r\n                    utils.adManager.videoCallBack = null;\r\n\r\n                } else {\r\n                    utils.showLog(\"激励插屏跳转失败！\");\r\n                    utils.adManager.videoCallBack && utils.adManager.videoCallBack(false, \"获取试玩奖励失败！\");\r\n                }\r\n                utils.adManager.videoCallBack = null;\r\n                utils.adManager.hideRewardInsert();\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (this.data.is_jump && this.data.is_jump == \"true\" && this.data.appid) {\r\n            utils.showLog(\"直接跳转!\", this.data.appid);\r\n            utils.navigateToMiniGame(this.data, (ret) => {\r\n                if (ret) {\r\n                    // 上报数据\r\n                    if (this.data && this.data.appid) {\r\n                        this._postData(this.data.appid);\r\n                    }\r\n                }\r\n            });\r\n        } else if (this.data.is_jump && this.data.is_jump == \"false\" && this.data.qr_code) {\r\n            if (PlatUtils.IsWechat) {\r\n                utils.showLog(\"二维码跳转!\", this.data.qr_code);\r\n                utils.wechatTool.previewImage(this.data.qr_code);\r\n                // // 上报数据\r\n                // if (this.data && this.data.appid) {\r\n                //     this._postData(this.data.appid);\r\n                // }\r\n            } else {\r\n                utils.showLog(\"不支持二维码跳转!\");\r\n            }\r\n        } else {\r\n            utils.showLog(\"没有is_jump直接跳转!\", this.data.appid);\r\n            if (this.data.appid) {\r\n                utils.navigateToMiniGame(this.data, (ret) => {\r\n                    if (ret) {\r\n                        // 上报数据\r\n                        if (this.data.appid) {\r\n                            this._postData(this.data.appid);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    updateItem() {\r\n\r\n        if (this.data && this.data.logo) {\r\n            let temp = cc.loader.getRes(this.data.logo);\r\n            if (temp) {\r\n                if (cc.isValid(this) && this._sprite) {\r\n                    let size: cc.Size = this.node.getContentSize();\r\n                    this._sprite.spriteFrame = new cc.SpriteFrame(temp);\r\n                    this.node.setContentSize(size);\r\n                }\r\n            } else {\r\n                CompatibleTool.LoadRes(this.data.logo, (err, texture) => {\r\n                    if (!err && cc.isValid(this) && this._sprite) {\r\n                        let size: cc.Size = this.node.getContentSize();\r\n                        this._sprite.spriteFrame = new cc.SpriteFrame(texture);\r\n                        this.node.setContentSize(size);\r\n                    }\r\n                });\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 上报跳转成功\r\n     * @param appid \r\n     */\r\n    _postData(appid: string) {\r\n        utils.postDataByLocation(appid, this._location, 1);\r\n    }\r\n\r\n\r\n    /**\r\n     * 上报点击\r\n     * @param appid \r\n     */\r\n    _postClickData(appid: string) {\r\n        utils.postDataByLocation(appid, this._location, 0);\r\n    }\r\n}\r\n"]}