{"version":3,"sources":["assets\\common-plugin\\Scripts\\GameBoxListGameItem.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,iCAAgC;AAChC,yCAAoC;AACpC,mDAA8C;AAExC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAAiD,uCAAY;IAA7D;QAAA,qEAqHC;QAnHG;;;;;;;;;;;UAWE;QACF,UAAI,GAAQ,IAAI,CAAC;QAEjB,UAAI,GAAc,IAAI,CAAC;QACvB,eAAS,GAAa,IAAI,CAAC;QAC3B,iBAAW,GAAa,IAAI,CAAC;QAE7B,gBAAU,GAAY,KAAK,CAAC;QAC5B,kBAAY,GAAW,CAAC,CAAC,CAAC,UAAU;;IAgGxC,CAAC;IA9FG,oCAAM,GAAN;QACI,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAC5C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAChE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;QAC1E,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;IACtF,CAAC;IAEM,kCAAI,GAAX,UAAY,IAAS;QACjB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IAC3B,CAAC;IAED,oCAAM,GAAN,UAAO,EAAU;QACb,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,UAAU,EAAE,CAAC;SACrB;IACL,CAAC;IAED,sCAAQ,GAAR;QAAA,iBA0BC;QAzBG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,UAAC,KAAe;YACtD,KAAI,CAAC,SAAS,CAAC,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACjC,IAAI,KAAI,CAAC,IAAI,CAAC,MAAM,IAAI,aAAK,CAAC,UAAU,CAAC,UAAU,CAAC,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;gBAEnE,aAAK,CAAC,OAAO,CAAC,OAAO,EAAE,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACzC,YAAY;gBACZ,EAAE,CAAC,qBAAqB,CAAC;oBACrB,KAAK,EAAE,KAAI,CAAC,IAAI,CAAC,MAAM;oBACvB,IAAI,EAAE,KAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE;oBAClD,OAAO,YAAC,GAAG;oBACX,CAAC;oBACD,IAAI,YAAC,GAAG;wBACJ,8BAA8B;wBAC9B,aAAK,CAAC,OAAO,CAAC,qCAAe,IAAI,CAAC,SAAS,CAAC,GAAG,CAAG,CAAC,CAAC;oBACxD,CAAC;iBACJ,CAAC,CAAC;aACN;iBAAM,IAAI,KAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBAC1B,IAAI,mBAAS,CAAC,QAAQ,EAAE;oBACpB,aAAK,CAAC,OAAO,CAAC,QAAQ,EAAE,KAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;oBAC3C,aAAK,CAAC,UAAU,CAAC,YAAY,CAAC,KAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;iBACpD;qBAAM;oBACH,aAAK,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;iBAC9B;aACJ;QACL,CAAC,EAAE,IAAI,CAAC,CAAC;IACb,CAAC;IAED,uCAAS,GAAT;QACI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IAED,wCAAU,GAAV;QAAA,iBAqBC;QApBG,IAAI,IAAI,CAAC,IAAI,EAAE;YACX,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;gBAChB,IAAI,QAAQ,GAAW,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;gBACtC,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC3B,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBAChC,QAAQ,IAAI,KAAK,CAAC;iBACrB;gBACD,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,QAAQ,CAAC;gBACjC,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,QAAQ,CAAC;aACtC;YAED,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;gBAChB,wBAAc,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,UAAC,GAAG,EAAE,OAAO;oBAChD,IAAI,CAAC,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,KAAI,CAAC,IAAI,KAAI,CAAC,IAAI,IAAI,KAAI,CAAC,IAAI,CAAC,WAAW,EAAE;wBAChE,KAAI,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;qBACvD;gBACL,CAAC,CAAC,CAAC;aACN;SACJ;IAEL,CAAC;IAED,uCAAS,GAAT,UAAU,KAAa;QACnB,8CAA8C;QAC9C,+DAA+D;QAC/D,uBAAuB;QACvB,IAAI,GAAG,GAAW,oDAAkD,KAAK,iBAAY,aAAK,CAAC,MAAM,CAAC,YAAY,CAAC,KAAO,CAAC;QACvH,aAAK,CAAC,OAAO,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;QACjC,aAAK,CAAC,iBAAiB,CAAC,GAAG,EAAE,UAAC,GAAG,EAAE,IAAI;YACnC,IAAI,GAAG,EAAE;gBACL,+BAA+B;gBAC/B,aAAK,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;aAC5B;iBAAM;gBACH,aAAK,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;aAC5B;QACL,CAAC,CAAC,CAAC;QACH,WAAW;QACX,8BAA8B;QAC9B,IAAI;IAER,CAAC;IAnHgB,mBAAmB;QADvC,OAAO;OACa,mBAAmB,CAqHvC;IAAD,0BAAC;CArHD,AAqHC,CArHgD,EAAE,CAAC,SAAS,GAqH5D;kBArHoB,mBAAmB","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameBoxListGameItem extends cc.Component {\r\n\r\n    /*\r\n    {\r\n    \"id\": 274,\r\n    \"icon\": \"http://ff.td68x.com/xcx/ylyxhz/44r4.png\",\r\n    \"app_path\": \"pages/index/index?ald_media_id=5778&ald_link_key=21c462bc56b283b3\",\r\n    \"name\": \"快乐游戏盒子\",\r\n    \"qr_code\": \"http://ff.td68x.com/xcx/ylyxhz/44xp.png\",\r\n    \"home_type\": 4,\r\n    \"home_name\": \"休闲精选\",\r\n    \"app_id\": \"\"\r\n\r\n    */\r\n    data: any = null;\r\n\r\n    icon: cc.Sprite = null;\r\n    labelName: cc.Label = null;\r\n    labelShadow: cc.Label = null;\r\n\r\n    _dataDirty: boolean = false;\r\n    lastPostTime: number = 0; //最后一次上报时间\r\n\r\n    onLoad() {\r\n        let mask = this.node.getChildByName(\"Mask\");\r\n        this.icon = mask.getChildByName(\"Icon\").getComponent(cc.Sprite);\r\n        this.labelName = this.node.getChildByName(\"Label\").getComponent(cc.Label);\r\n        this.labelShadow = this.node.getChildByName(\"LabelShadow\").getComponent(cc.Label);\r\n    }\r\n\r\n    public init(data: any) {\r\n        this.data = data;\r\n        this._dataDirty = true;\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this._dataDirty) {\r\n            this._dataDirty = false;\r\n            this.updateItem();\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, (event: cc.Event) => {\r\n            this._postData(this.data.app_id);\r\n            if (this.data.app_id && utils.wechatTool.checkAppId(this.data.app_id)) {\r\n\r\n                utils.showLog(\"直接跳转!\", this.data.app_id);\r\n                //@ts-ignore\r\n                wx.navigateToMiniProgram({\r\n                    appId: this.data.app_id,\r\n                    path: this.data.app_path ? this.data.app_path : \"\",\r\n                    success(res) {\r\n                    },\r\n                    fail(res) {\r\n                        // utils.showLog(\"跳转失败！\", id);\r\n                        utils.showLog(`跳转失败! ; res=${JSON.stringify(res)}`);\r\n                    }\r\n                });\r\n            } else if (this.data.qr_code) {\r\n                if (PlatUtils.IsWechat) {\r\n                    utils.showLog(\"二维码跳转!\", this.data.qr_code);\r\n                    utils.wechatTool.previewImage(this.data.qr_code);\r\n                } else {\r\n                    utils.showLog(\"不支持二维码跳转!\");\r\n                }\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.node.targetOff(this);\r\n    }\r\n\r\n    updateItem() {\r\n        if (this.data) {\r\n            if (this.data.name) {\r\n                let gameName: string = this.data.name;\r\n                if (this.data.name.length > 4) {\r\n                    gameName = gameName.slice(0, 4);\r\n                    gameName += \"...\";\r\n                }\r\n                this.labelName.string = gameName;\r\n                this.labelShadow.string = gameName;\r\n            }\r\n\r\n            if (this.data.icon) {\r\n                CompatibleTool.LoadRes(this.data.icon, (err, texture) => {\r\n                    if (!err && cc.isValid(this) && this.icon && this.icon.spriteFrame) {\r\n                        this.icon.spriteFrame = new cc.SpriteFrame(texture);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    _postData(appid: string) {\r\n        // let curTime: number = new Date().getTime();\r\n        // let interval: number = (curTime - this.lastPostTime) / 1000;\r\n        // if (interval >= 3) {\r\n        let url: string = `https://apps.youlesp.com/gbs?m=rclickV2&app_id=${appid}&game_id=${utils.config.wechatconfig.appID}`;\r\n        utils.showLog(\"上报数据, url=\", url);\r\n        utils.commomHttpRequest(url, (ret, data) => {\r\n            if (ret) {\r\n                // this.lastPostTime = curTime;\r\n                utils.showLog(\"数据上报成功！\");\r\n            } else {\r\n                utils.showLog(\"数据上报失败！\");\r\n            }\r\n        });\r\n        // } else {\r\n        //     cc.warn(\"上报的间隔时间小于3秒\");\r\n        // }\r\n\r\n    }\r\n\r\n}\r\n"]}