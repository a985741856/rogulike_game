{"version":3,"sources":["assets\\common-plugin\\Scripts\\YZ_RecordWidget.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"./Utils\";\r\nimport PlatUtils from \"./PlatUtils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class YZ_RecordWidget extends cc.Component {\r\n\r\n    _panel: cc.Node = null;\r\n    _normalBtn: cc.Node = null;\r\n    _actionBtn: cc.Node = null;\r\n    _isRecording: boolean = false;\r\n    _originScale: number = 1;\r\n\r\n    onLoad() {\r\n        this._panel = this.node.getChildByName(\"Panel\");\r\n        this._panel.active = false;\r\n        let background: cc.Node = this._panel.getChildByName(\"Background\");\r\n        this._normalBtn = background.getChildByName(\"normalBtn\");\r\n        this._actionBtn = background.getChildByName(\"actionBtn\");\r\n        this._originScale = this._actionBtn.scale;\r\n    }\r\n\r\n    _onGameMessage(event: any) {\r\n        switch (event.type) {\r\n            case \"YZ_RecordStart\": {\r\n                this._updateState();\r\n                break;\r\n            }\r\n            case \"YZ_RecordEnd\": {\r\n                this._updateState();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        cc.game.on(\"YZ_CommonMessage\", this._onGameMessage, this);\r\n\r\n        utils.registerServerInitEvent(() => {\r\n\r\n            this._panel.on(cc.Node.EventType.TOUCH_END, (event: cc.Event) => {\r\n                event.stopPropagation();\r\n                if (!utils.isRecording) {\r\n                    utils.recordStart();\r\n                } else {\r\n                    utils.isSuccess = undefined;\r\n                    if (utils.cur_tool && utils.cur_tool.isClickEnd != undefined) {\r\n                        utils.cur_tool.isClickEnd = true;\r\n                    }\r\n                    utils.recordEnd();\r\n                }\r\n            }, this);\r\n\r\n\r\n            this._updateState();\r\n\r\n            if (utils.isShowRecordWidget()) {\r\n                this._panel.active = true;\r\n            } else {\r\n                utils.showLog(\"不支持录屏!\");\r\n                this.node.destroy();\r\n            }\r\n        }, this);\r\n\r\n        // if (PlatUtils.IsDouyin) {\r\n        //     utils.showLog(\"record onEnable\");\r\n        //     utils.Tool_Douyin.isAutoShare = true;\r\n        // }\r\n        if (utils.cur_tool && utils.cur_tool.isAutoShare != undefined) {\r\n            utils.cur_tool.isAutoShare = true;\r\n        }\r\n\r\n    }\r\n\r\n    onDisable() {\r\n        cc.game.targetOff(this);\r\n\r\n        // utils.isRecording = false;\r\n        // this._updateState();\r\n        // if (PlatUtils.IsDouyin) {\r\n        //     utils.showLog(\"record onDisable\");\r\n        //     // utils.Tool_Douyin.isAutoShare = false;\r\n        // }\r\n        // utils.recordEnd();\r\n\r\n    }\r\n\r\n    _updateState() {\r\n        if (utils.isRecording) {\r\n            this._normalBtn.active = false;\r\n            this._actionBtn.active = true;\r\n            this._actionBtn.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.3, this._originScale * 0.8), cc.scaleTo(0.3, this._originScale))));\r\n        } else {\r\n            this._normalBtn.active = true;\r\n            this._actionBtn.stopAllActions();\r\n            this._actionBtn.active = false;\r\n        }\r\n    }\r\n}\r\n"]}