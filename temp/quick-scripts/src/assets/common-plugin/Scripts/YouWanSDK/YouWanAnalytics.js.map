{"version":3,"sources":["assets\\common-plugin\\Scripts\\YouWanSDK\\YouWanAnalytics.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlatUtils from \"../PlatUtils\";\nimport { utils } from \"../Utils\";\nimport YZ_Constant from \"../YZ_Constant\";\nimport YZ_LocalStorage from \"../YZ_LocalStorage\";\nimport EventAdInfo, { AdEventParameter, YwAdStatus, YwAdType } from \"./EventAdInfo\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class YouWanAnalytics {\n    private static LOGIN_URL: string = \"http://as.youlesp.com/as/login\";\n    private static EVENT_AD_URL: string = \"http://e.youlesp.com/ae/ad\";\n\n\n    // private static LOGIN_URL: string = \"http://192.168.31.108:8080/as/login\";\n    // private static EVENT_AD_URL: string = \"http://192.168.31.108:8080/ae/ad\";\n\n\n    private static get _yw_uid(): number {\n        return parseInt(YZ_LocalStorage.getItem(YZ_Constant.ST_YOUWAN_UID, \"-1\"));\n    }\n\n    public static login(callBackFunc?: Function) {\n        if (!utils.config.otherconfig.yw_app_id) {\n            this.showLog(\"yw_app_id 未配置，不进行上报！\");\n            return;\n        }\n        let data: any = {};\n        this.getDeviceInfo(data);\n        this.getStaticParame(data)\n        this.connect(this.LOGIN_URL, data, (res, data) => {\n            if (res) {\n                this.showLog(\"登录成功! >>result:\" + JSON.stringify(data) + \" #uid=\" + data.uid);\n                YZ_LocalStorage.setItem(YZ_Constant.ST_YOUWAN_UID, data.uid);\n            } else {\n                this.showLog(\"登录失败!\");\n            }\n            callBackFunc && callBackFunc(res, data);\n        });\n    }\n\n    public static EventAd(adType: YwAdType, adStatus: YwAdStatus) {\n        if (!utils.config.otherconfig.yw_app_id) {\n            this.showLog(\"yw_app_id 未配置，不进行上报！\");\n            return;\n        }\n        if (!PlatUtils.IsOPPO) return;\n\n        let adInfo = new EventAdInfo(adType, adStatus);\n        let data: any = {};\n        this.getStaticParame(data);\n        data.ad_data = [];\n        data.ad_data[0] = adInfo.toJsonData();\n\n        this.connect(this.EVENT_AD_URL, data, (res) => {\n            if (res) {\n                this.showLog(`上报广告事件成功:${JSON.stringify(adInfo.toJsonData())}`);\n            } else {\n                this.showLog(`上报广告事件失败:${JSON.stringify(adInfo.toJsonData())}`);\n            }\n        });\n    }\n\n    public static EventAdWithObj(adType: YwAdType, adStatus: YwAdStatus, adEventParameter: AdEventParameter) {\n        if (!utils.config.otherconfig.yw_app_id) {\n            this.showLog(\"yw_app_id 未配置，不进行上报！\");\n            return;\n        }\n        if (!PlatUtils.IsOPPO) return;\n\n        let adInfo = new EventAdInfo(adType, adStatus, adEventParameter);\n        let data: any = {};\n        this.getStaticParame(data);\n        data.ad_data = [];\n        data.ad_data[0] = adInfo.toJsonData();\n        this.connect(this.EVENT_AD_URL, data, (res) => {\n            if (res) {\n                this.showLog(`上报广告事件成功:${JSON.stringify(adInfo.toJsonData())}`);\n            } else {\n                this.showLog(`上报广告事件失败:${JSON.stringify(adInfo.toJsonData())}`);\n            }\n        });\n    }\n\n    private static getStaticParame(data: any) {\n        data.app_id = utils.config.otherconfig.yw_app_id;\n        data.sdk_version = utils.utilsVersion;\n        data.app_type = 1;\n        if (this._yw_uid != -1) {\n            data.uid = this._yw_uid;\n        }\n        data.country = \"CN\"\n        data.uuid = YZ_LocalStorage.getItem(YZ_Constant.ST_UUID, \"\") || utils.generateUUID();\n        if (PlatUtils.IsOPPO) {\n            data.channel = \"oppo\";\n            data.app_version = utils.config.oppoconfig.version;\n        }\n    }\n\n\n    private static getDeviceInfo(data: any) {\n        let systemInfo: any = {};\n        if (PlatUtils.IsOPPO) {\n            systemInfo = utils.oppoTool.SysInfo;\n            data.pkg = utils.config.oppoconfig.packageName;\n            data.device_id = utils.oppoTool._device_id;\n            data.kernel_version = systemInfo.platformVersionCode;\n            data.device_model = systemInfo.model;\n            data.device_manufactory = systemInfo.brand;\n            data.screen_height = systemInfo.screenHeight;\n            data.screen_width = systemInfo.screenWidth;\n            data.language = systemInfo.language;\n            data.os = \"Android\";\n            if (systemInfo.system.indexOf(\" \") > -1) {\n                data.os_version_release = systemInfo.system.substr(systemInfo.system.indexOf(\" \") + 1);\n            } else {\n                data.os_version_release = systemInfo.system;\n            }\n        }\n    }\n\n\n\n    private static connect(url: string, parame: any, callBackFunc?: Function) {\n        let xhr = new XMLHttpRequest();\n        xhr.timeout = 6000;    // 单位毫秒\n        xhr.open('POST', url + \"?time_stamp=\" + (new Date()).getTime());\n        xhr.send(`data=${JSON.stringify(parame)}`);\n        this.showLog(\"connect：#url=\" + url);\n        this.showLog(`connect： #parame==${JSON.stringify(parame)}`);\n\n        xhr.onreadystatechange = () => {\n            this.showLog(\"请求状态改变, reaedyState=\", xhr.readyState, \"; status=\", xhr.status + \" ; responseText=\", xhr.responseText);\n            if (xhr.readyState == 4) {\n                if (xhr.status == 200) {\n                    if (xhr.responseText) {\n                        try {\n                            let result = JSON.parse(xhr.responseText);\n                            if (result.code == 0) {\n                                callBackFunc && callBackFunc(true, result.data || \"\");\n                            } else {\n                                callBackFunc && callBackFunc(false);\n                            }\n                        } catch (error) {\n                            this.showLog(\"connect erro：#msg=\" + error);\n                        }\n\n                    }\n                } else {\n                    this.showLog(`connect erro： #parame==${JSON.stringify(parame)}`);\n                    callBackFunc && callBackFunc(false);\n                }\n            }\n        }\n        xhr.ontimeout = () => {\n            this.showLog(\"connect timeout!\");\n            callBackFunc && callBackFunc(false);\n        }\n        xhr.onerror = () => {\n            this.showLog(\"connect onerror!\");\n            callBackFunc && callBackFunc(false);\n\n        }\n    }\n\n    private static showLog(msg, ...any: any[]): void {\n        utils.showLog(`[YouWan] --- ${msg}`, any);\n    }\n\n\n\n}\n"]}