{"version":3,"sources":["assets\\common-plugin\\Scripts\\YZ_Tool_Cocosplay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\nimport YZ_Constant, { LevelStatus } from \"./YZ_Constant\";\r\nimport YZ_LocalStorage from \"./YZ_LocalStorage\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n// const GameSDK = require('./GameSDK.js');\r\n// const AdSDK = require('./AdSDK.js');\r\nlet ST_DefaultServerConfig: string = \"\";\r\nconst ST_ServerUrl: string = \"http://apps.youlesp.com/gss?\";\r\nconst POST_ServerUrl: string = \"http://report.youlesp.com/gss?\";\r\nconst QTT_ServerUrl: string = \"https://newidea4-gamecenter-backend.1sapp.com/x/open/user/ticket?\"\r\nconst QTT_Report: string = \"https://newidea4-gamecenter-backend.1sapp.com/x/open/report/round\"\r\n/**\r\n * cocos工具类\r\n */\r\n@ccclass\r\nexport default class YZ_Tool_Cocosplay {\r\n\t_sysInfo: any = {};\r\n\tpublic get SysInfo() {\r\n\t\treturn this._sysInfo;\r\n\t}\r\n\r\n\t/**\r\n * 服务器配置信息\r\n */\r\n\t_serverConfig: any = null;\r\n\tpublic get ServerConfig() {\r\n\t\treturn this._serverConfig;\r\n\t}\r\n\t_shareCallback: Function = null;\r\n\t_isShare: boolean = false;\r\n\r\n\t//设备UID\r\n\t_uid: string = \"0\";\r\n\r\n\tpublic get uid() {\r\n\t\t// if (this._service_uid != \"0\") return this._uid;\r\n\t\t// this._login();\r\n\t\treturn \"0\";\r\n\t}\r\n\r\n\t//服务器返回UID\r\n\t_service_uid: string = \"0\";\r\n\r\n\t/**\r\n\t * 服务器返回UID\r\n\t */\r\n\tpublic get serviceId() {\r\n\t\tif (this._service_uid != \"0\") return this._service_uid;\r\n\t\tthis.reportLogin();\r\n\t\treturn \"0\";\r\n\t}\r\n\r\n\r\n\t_loginTime: number = 0;\r\n\t_loginInterval: number = 30;\r\n\tasync _login() {\r\n\r\n\t\tlet curTime: number = new Date().getTime();\r\n\t\tlet interval: number = (curTime - this._loginTime) / 1000;\r\n\t\tif (interval > 0 && interval < 30) {\r\n\t\t\tutils.showLog(`登录请求间隔小于：${this._loginInterval}秒`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._loginTime = curTime;\r\n\t\tlet self = this;\r\n\t\tutils.showLog(\"cocos暂时不获取uid，uid全部为0\");\r\n\t\tthis._uid = \"0\";\r\n\t\t// this.reportLogin();\r\n\r\n\t}\r\n\r\n\t_reportLoginTime: number = 0;\r\n\t_reportLoginInterval: number = 30;\r\n\tisReport: boolean = false;\r\n\t/**\r\n\t * 上报登录接口获取UID\r\n\t */\r\n\treportLogin() {\r\n\t\tif (this.isReport) return;\r\n\t\tthis.isReport = true;\r\n\t\tlet self = this;\r\n\t\tlet curTime: number = new Date().getTime();\r\n\t\tlet interval: number = (curTime - self._reportLoginTime) / 1000;\r\n\t\t// utils.showLog(interval, \" <<<<<<,interval\", \" _reportLoginTime >>>\", self._reportLoginTime);\r\n\t\t// console.log(curTime, curTime - self._reportLoginTime, interval)\r\n\t\tif (interval > 0 && interval < 30) {\r\n\t\t\tutils.showLog(`上报登录获取UID小于：${self._reportLoginInterval}秒`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tself._reportLoginTime = curTime;\r\n\t\tlet method = \"m=login\";\r\n\t\tlet url: string = ST_ServerUrl + method + `&device_data=0`;\r\n\r\n\t\tutils.commomHttpRequest(url, (ret, data) => {\r\n\t\t\tif (ret) {\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tlet result = JSON.parse(data);\r\n\t\t\t\t\tutils.showLog(\"data=\" + data);\r\n\t\t\t\t\tutils.showLog(\"result=\" + result);\r\n\t\t\t\t\tutils.showLog(\"result.uid=\" + result.uid);\r\n\t\t\t\t\tif (result.uid) {\r\n\t\t\t\t\t\tself._service_uid = \"\" + result.uid;\r\n\t\t\t\t\t\tconsole.log(\"self._service_uid:\" + self._service_uid)\r\n\t\t\t\t\t\tutils.showLog(\"服务器请求登录成功! _service_uid=\" + self._service_uid);\r\n\t\t\t\t\t\tYZ_LocalStorage.setItem(YZ_Constant.ST_SERVICE_UID, self._service_uid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tutils.showLog(\"获取数据失败1\");\r\n\t\t\t}\r\n\t\t\tthis.isReport = false;\r\n\t\t})\r\n\t}\r\n\r\n\tnickName: string = \"\";\r\n\t/**\r\n\t * \r\n\t * @param data 配置数据\r\n\t */\r\n\tpublic init(data: string) {\r\n\t\tif (PlatUtils.ISCocos) {\r\n\t\t\t/**\r\n\t\t\t * Param Json对象:\r\n\t\t\t{\r\n\t\t\terror,  // int 错误代码：0、成功（见文末）\r\n\t\t\tuserId,  // int当前玩家id\r\n\t\t\tnickName,  // string当前玩家名称\r\n\t\t\theadUrl,  // string 当前玩家头像地址\r\n\t\t\tlocation,  //string当前玩家地址\r\n\t\t\tsex,  // string 玩家性别：\"f\" - 女；\"m\" - 男；\"x\" – 未知\r\n\t\t\tage // int 当前玩家年龄\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\t//@ts-ignore\r\n\t\t\tGameSDK.setOnInitCB((param) => {\r\n\t\t\t\tif (param.error == 0) {\r\n\t\t\t\t\tutils.showLog(\"初始化成功\")\r\n\t\t\t\t\tthis._uid = param.userId;\r\n\t\t\t\t\tthis.nickName = param.nickName\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tutils.showLog(\"utils.config.cocosConfig.appID:\" + utils.config.cocosConfig.appID)\r\n\t\t\t//@ts-ignore\r\n\t\t\tGameSDK.init(utils.config.cocosConfig.appID);\r\n\t\t\t//@ts-ignore\r\n\t\t\tAdSDK.init();\r\n\t\t\tif (data) {\r\n\t\t\t\tlet configObj: any = JSON.parse(data);\r\n\t\t\t\tif (configObj && configObj.cocos) {\r\n\t\t\t\t\tST_DefaultServerConfig = JSON.stringify(configObj.cocos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._service_uid = YZ_LocalStorage.getItem(YZ_Constant.ST_SERVICE_UID);\r\n\t\t\tthis._service_uid = this._service_uid ? this._service_uid : \"0\";\r\n\r\n\t\t\ttry {\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tthis._sysInfo = GameSDK.getSystemInfoSync()\r\n\t\t\t\tutils.showLog(\"cocos 小游戏平台信息: \" + JSON.stringify(this.SysInfo));\r\n\t\t\t} catch (e) {\r\n\t\t\t\tutils.showLog(\"cocos 小游戏平台数据获取失败!\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._loadConfig();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t_loadConfig() {\r\n\t\tif (PlatUtils.ISCocos) {\r\n\t\t\tlet method: string = \"m=g\";\r\n\t\t\tutils.commomHttpRequest(ST_ServerUrl + method, (ret, data) => {\r\n\t\t\t\tif (ret) {\r\n\t\t\t\t\tutils.showLog(\"cocos服务器配置数据获取成功: data = \" + data);\r\n\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\tlet result = JSON.parse(data);\r\n\t\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\t\tif (!utils.DebugLoacalConfig) {\r\n\t\t\t\t\t\t\t\tthis._serverConfig = result;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcc.warn(\"开启了本地数据测试，使用本地配置!\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tutils.showLog(\"cocos服务器配置数据不是合法的JSON数据, 使用本地配置!\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.showLog(\"cocos服务器配置数据获取失败, 使用本地配置!\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this._serverConfig) {\r\n\t\t\t\t\tthis._serverConfig = JSON.parse(ST_DefaultServerConfig);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this._serverConfig.shares) {\r\n\t\t\t\t\t\tif (this._serverConfig.shares.sy_title) {\r\n\t\t\t\t\t\t\tutils.config.otherconfig.shareTitle = this._serverConfig.shares.sy_title;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this._serverConfig.shares.sy_img) {\r\n\t\t\t\t\t\t\tutils.config.otherconfig.shareImgUrl = this._serverConfig.shares.sy_img;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this._serverConfig.is_local_pos_id\r\n\t\t\t\t\t\t&& this._serverConfig.is_local_pos_id == \"false\") {\r\n\t\t\t\t\t\t// 使用服务器下发的广告id\r\n\t\t\t\t\t\tutils.showLog(\"使用服务器下发的广告id\");\r\n\t\t\t\t\t\t// utils.config.cocosConfig.bannerId = this._serverConfig.banner_pos_id;\r\n\t\t\t\t\t\t// utils.config.cocosConfig.insertId = this._serverConfig.intersititia_pos_id;\r\n\t\t\t\t\t\t// utils.config.cocosConfig.videoId = this._serverConfig.video_pos_id;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tutils.showLog(\"使用本地配置的广告ID\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tutils.emitServerInitEvent();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic getSystemInfo() {\r\n\t\tif (PlatUtils.ISCocos) {\r\n\t\t\treturn this._sysInfo;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic share(callback: Function = null) {\r\n\t}\r\n\r\n\tpublic isOverMinVersion(minVersion: string) {\r\n\t\tlet curVersion: string = this._sysInfo.SDKVersion;\r\n\t\treturn this._compareVersion(curVersion, minVersion) >= 0;\r\n\t}\r\n\r\n\r\n\t_compareVersion(v1, v2) {\r\n\t\tif (!v1 || !v2) return -1;\r\n\r\n\t\tv1 = v1.split('.')\r\n\t\tv2 = v2.split('.')\r\n\t\tconst len = Math.max(v1.length, v2.length)\r\n\r\n\t\twhile (v1.length < len) {\r\n\t\t\tv1.push('0')\r\n\t\t}\r\n\t\twhile (v2.length < len) {\r\n\t\t\tv2.push('0')\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tconst num1 = parseInt(v1[i])\r\n\t\t\tconst num2 = parseInt(v2[i])\r\n\r\n\t\t\tif (num1 > num2) {\r\n\t\t\t\treturn 1\r\n\t\t\t} else if (num1 < num2) {\r\n\t\t\t\treturn -1\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0\r\n\t}\r\n\r\n\t/**\r\n\t * 上报关卡数据\r\n\t * @param level 当前关卡ID\r\n\t * @param levelName 关卡名称\r\n\t * @param status 状态\r\n\t */\r\n\tpublic postLevel(level: string, status: LevelStatus, levelName?: string) {\r\n\t\tif (PlatUtils.ISCocos) {\r\n\t\t\tlet method = \"m=rlevel\";\r\n\t\t\tlet url: string = POST_ServerUrl + method + `&level_id=${level}&level_name=${encodeURI(levelName)}&status=${status}`;\r\n\t\t\tutils.commomHttpRequest(url, function (ret, data) {\r\n\t\t\t\tif (ret) {\r\n\t\t\t\t\tutils.showLog(\"关卡数据上报成功！\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.showLog(\"关卡数据上报失败！\");\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\t}\r\n}\r\n"]}