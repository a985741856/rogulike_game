{"version":3,"sources":["assets\\common-plugin\\Scripts\\GameBox.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameBoxSlideItem from \"./GameBoxSlideItem\";\r\nimport { utils } from \"./Utils\";\r\nimport GameBoxListItem from \"./GameBoxListItem\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n\r\n/**\r\n * 游戏盒子\r\n */\r\n@ccclass\r\nexport default class GameBox extends cc.Component {\r\n\r\n    // onLoad () {}\r\n    @property({ type: cc.PageView, tooltip: \"顶部滚动视图\" })\r\n    slidePageView: cc.PageView = null;\r\n\r\n    @property({ type: cc.Node, tooltip: \"推荐列表\" })\r\n    listContent: cc.Node = null;\r\n\r\n    @property({ type: cc.Node, tooltip: \"顶部的幻灯片节点\" })\r\n    topSlideNode: cc.Node = null;\r\n\r\n    @property({ type: cc.Node, tooltip: \"推荐列表节点\" })\r\n    recommentNode: cc.Node = null;\r\n\r\n    @property({ type: cc.Node, tooltip: \"推荐列表Banner节点\" })\r\n    recommentBanner: cc.Node = null;\r\n\r\n\r\n    _boxInfo: any = null;\r\n    _dataDirty: boolean = false;\r\n    _slideList: GameBoxSlideItem[] = null;\r\n    _appIdList: string[] = [];\r\n\r\n    onLoad() {\r\n        this.initListener();\r\n    }\r\n\r\n    onEnable() {\r\n        this.postData();\r\n        utils.registerServerInitEvent(() => {\r\n            this._setNodeVisible();\r\n        }, this);\r\n    }\r\n\r\n    onDisable() {\r\n        utils.unregisterServerInitEvent(this);\r\n    }\r\n\r\n    _setNodeVisible() {\r\n        this.initData();\r\n\r\n        if (this._boxInfo) {\r\n            this.initUi();\r\n        } else {\r\n            this.node.destroy();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初始化UI\r\n     */\r\n    protected initUi(): void {\r\n        this.slidePageView.removeAllPages();\r\n        this.listContent.removeAllChildren();\r\n        utils.showLog(\"gamebox initUi\")\r\n        if (!this._boxInfo) return;\r\n        let slideData: any = this._boxInfo.banners;\r\n        let listData: any = this._boxInfo.infos\r\n        for (let i = 0; i < slideData.length; i++) {\r\n            let slideNode: cc.Node = cc.instantiate(this.topSlideNode);\r\n            let slideItem: GameBoxSlideItem = slideNode.getComponent(\"GameBoxSlideItem\");\r\n            slideNode.active = true;\r\n            slideItem.initData(slideData[i]);\r\n            this.slidePageView.addPage(slideNode);\r\n        }\r\n\r\n        for (let i = 0; i < listData.length; i++) {\r\n            let listNode: cc.Node = cc.instantiate(this.recommentNode);\r\n            let listItem: GameBoxListItem = listNode.getComponent(\"GameBoxListItem\");\r\n            let data = listData[i];\r\n            listItem.init(data)\r\n            this.listContent.addChild(listNode);\r\n            if (data.banner) {\r\n                let banner: cc.Node = cc.instantiate(this.recommentBanner);\r\n                let slideItem: GameBoxSlideItem = banner.getComponent(\"GameBoxSlideItem\");\r\n                banner.active = true;\r\n\r\n                slideItem.initData(data.banner);\r\n                this.listContent.addChild(banner);\r\n            }\r\n        }\r\n\r\n        this.startAutoChange();\r\n    }\r\n\r\n    /**\r\n     * 开启轮播\r\n     */\r\n    startAutoChange() {\r\n        this.schedule(() => {\r\n            let count = this.slidePageView.getPages().length;\r\n            let index = this.slidePageView.getCurrentPageIndex();\r\n            index = ((index < count) && (index + 1 !== count)) ? (index + 1) : 0;\r\n            this.slidePageView.scrollToPage(index, 2);\r\n        }, 3); //3秒一换\r\n    }\r\n\r\n\r\n    /**\r\n     * 初始化监听事件\r\n     */\r\n    newPage: cc.Node = null;\r\n    protected initListener(): void {\r\n        // var _pool = new cc.NodePool();\r\n        // this.slidePageView.node.on('scroll-began', () => {\r\n        //     if (this.slidePageView.getCurrentPageIndex() == this.slidePageView.content.childrenCount - 1) {\r\n        //         if (!this.newPage) {\r\n        //             this.newPage = cc.instantiate(this.slidePageView.getPages()[0]);\r\n        //         }\r\n        //         this.slidePageView.addPage(this.newPage);\r\n\r\n        //     }\r\n        // });\r\n\r\n        // this.slidePageView.node.on('scroll-ended', () => {\r\n        //     if (this.slidePageView.getPages().length == 4) {\r\n        //         _pool.put(this.slidePageView.content.children[1]);\r\n        //         this.newPage = _pool.get();\r\n        //         this.slidePageView.getPages().splice(1, 1);\r\n        //     }\r\n        // })\r\n    }\r\n\r\n\r\n    /**\r\n     * 初始化数据\r\n     * @param {boxInfo} 游戏盒子的json数据\r\n     */\r\n    public initData(): void {\r\n        utils.showLog(\"gamebox initData\")\r\n\r\n        this._boxInfo = utils._wechatTool.gameBoxServerConfig;\r\n        if (this._boxInfo) {\r\n            utils.showLog(\"Gamebox 游戏盒子数据:\", JSON.stringify(this._boxInfo));\r\n        } else {\r\n            utils.showLog(\"Gamebox 游戏盒子数据获取失败!\", this._boxInfo);\r\n        }\r\n    }\r\n\r\n    postData() {\r\n        let url: string = `https://apps.youlesp.com/gbs?m=rclickV2&app_id=100000000001&game_id=${utils.config.wechatconfig.appID}`;\r\n        utils.showLog(\"上报数据, url=\", url);\r\n        utils.commomHttpRequest(url, (ret, data) => {\r\n            if (ret) {\r\n                utils.showLog(\"数据上报成功！\");\r\n            } else {\r\n                utils.showLog(\"数据上报失败！\");\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n\r\n    update(dt) {\r\n        if (this._dataDirty) {\r\n            this._dataDirty = false;\r\n            this.node.active = true;\r\n        }\r\n    }\r\n}\r\n"]}