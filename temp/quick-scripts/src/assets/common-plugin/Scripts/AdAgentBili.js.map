{"version":3,"sources":["assets\\common-plugin\\Scripts\\AdAgentBili.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AdAgent from \"./AdAgent\";\r\nimport { BannerLocation } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * bili广告组件\r\n */\r\n@ccclass\r\nexport default class AdAgentBili extends AdAgent {\r\n\r\n\r\n\t_videoCallback: Function = null;\r\n\t_isVideoLoaded: boolean = false;\r\n\r\n\t_videoAd: any = null;\r\n\t_bannerAd: any = null;\r\n\t//@ts-ignore\r\n\tbl = window.bl;\r\n\r\n\tpublic Init() {\r\n\r\n\t}\r\n\t_curBannerAd: any = null;\r\n\t_bannerSizePercent: number = 0.1;\r\n\t_bannerBottom: number = 0;\r\n\tpublic ShowBanner(location: BannerLocation, args: any = null) {\r\n\r\n\t\tlet argsTmp: any = args;\r\n\r\n\t\tif (argsTmp && argsTmp.width) {\r\n\t\t\tthis._bannerSizePercent = argsTmp.width < 0 ? 0 : argsTmp.width;\r\n\t\t\tthis._bannerSizePercent = argsTmp.width > 1 ? 1 : argsTmp.width;\r\n\t\t}\r\n\r\n\t\tif (argsTmp && argsTmp.bottom) {\r\n\t\t\tthis._bannerBottom = argsTmp.bottom < 0 ? 0 : argsTmp.bottom;\r\n\t\t\tthis._bannerBottom = argsTmp.bottom > cc.winSize.height ? cc.winSize.height : argsTmp.bottom;\r\n\t\t}\r\n\t\t// let bannerId: string = utils.config.biliConfig.bannerId;\r\n\t\t// utils.showLog(\"显示Banner广告: bannerId=\" + bannerId);\r\n\t\tconsole.log(\"显示Banner广告\");\r\n\t\tlet params = {\r\n\t\t\tleft: 0,\r\n\t\t\twidth: 300,\r\n\t\t\ttop: 0\r\n\t\t};\r\n\t\t//@ts-ignore\r\n\t\tlet curBannerAd = bl.createBannerAd(params);\r\n\t\tif (curBannerAd) {\r\n\t\t\tcurBannerAd.onError((err) => {\r\n\t\t\t\tutils.showLog(\"广告条加载失败! \", JSON.stringify(err));\r\n\t\t\t\tif (curBannerAd) {\r\n\t\t\t\t\tcurBannerAd.destroy();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlet self = this;\r\n\t\t\tcurBannerAd.onLoad(() => {\r\n\t\t\t\tcurBannerAd.show().then(() => {\r\n\t\t\t\t\tif (self._curBannerAd) {\r\n\t\t\t\t\t\tself._curBannerAd.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself._curBannerAd = curBannerAd;\r\n\t\t\t\t\tutils.showLog(\"Banner广告显示成功!\");\r\n\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tutils.showLog(\"Banner广告出错\", JSON.stringify(err));\r\n\t\t\t\t\tif (curBannerAd) {\r\n\t\t\t\t\t\tcurBannerAd.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tcurBannerAd.onResize((res) => {\r\n\t\t\t\tcurBannerAd.style.width = utils.Tool_Bili.SysInfo.screenWidth * self._bannerSizePercent;\r\n\t\t\t\tcurBannerAd.style.left = (utils.Tool_Bili.SysInfo.screenWidth - res.width) * 0.5;\r\n\r\n\t\t\t\tif (self._bannerBottom == cc.winSize.height) {\r\n\t\t\t\t\tcurBannerAd.style.top = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurBannerAd.style.top = utils.Tool_Bili.SysInfo.screenHeight - res.height - self._bannerBottom;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tutils.showLog(\"广告条创建失败!\");\r\n\t\t}\r\n\t}\r\n\r\n\tpublic ShowInterstitial() {\r\n\t\tutils.showLog(\"哔哩平台暂时无插屏广告\");\r\n\t}\r\n\r\n\r\n\tpublic HideBanner(location: BannerLocation = BannerLocation.Home) {\r\n\t\tif (PlatUtils.IsBili) {\r\n\t\t\tif (this._bannerAd) {\r\n\t\t\t\tthis._bannerAd.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic ShowVideo(callback: Function) {\r\n\t\tif (PlatUtils.IsBili) {\r\n\t\t\tthis._videoCallback = callback;\r\n\t\t\tlet self = this;\r\n\t\t\tthis.showRewardedVideoAd({\r\n\t\t\t\tonSuccess(res) {\r\n\t\t\t\t\t// 广告成功展示\r\n\t\t\t\t\tutils.showLog(\"bili视频展示成功！\");\r\n\t\t\t\t},\r\n\t\t\t\tonFail(e) {\r\n\t\t\t\t\t// 广告失败了\r\n\t\t\t\t\tutils.showLog(\"bili视频广告展示失败！\");\r\n\t\t\t\t\tutils.Tool_Bili.share((res, msg) => {\r\n\t\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\t\tself._videoCallback && self._videoCallback(true, \"\");\r\n\t\t\t\t\t\t\tself._videoCallback = null;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tself._videoCallback && self._videoCallback(false, \"分享成功才可以获取奖励哦!\");\r\n\t\t\t\t\t\t\tself._videoCallback = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tonClose(e) {\r\n\t\t\t\t\t// 用户关闭了广告\r\n\t\t\t\t\tif (e.isEnded) {\r\n\t\t\t\t\t\t// 用户看完了\r\n\t\t\t\t\t\tutils.showLog(\"bili视频广告观看完毕，发送奖励\");\r\n\t\t\t\t\t\tself._videoCallback && self._videoCallback(true, \"\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 用户没看完\r\n\t\t\t\t\t\tself._videoCallback && self._videoCallback(false, \"观看完视频才能获得奖励!\");\r\n\t\t\t\t\t\tself._videoCallback = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate showRewardedVideoAd({ onSuccess, onFail, onClose }) {\r\n\t\t// 创建激励视频对象实例:\r\n\t\tconst ad = this.bl.createRewardedVideoAd();\r\n\r\n\t\tfunction adLoadHandler(e) {\r\n\t\t\t// !!!!!!\r\n\t\t\t// 重要！此处必须先 off 本次事件回调。\r\n\t\t\t// !!!!!!\r\n\t\t\tad.offLoad(adLoadHandler);\r\n\r\n\t\t\t// 加载成功\r\n\t\t\tad.show()\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\t// 激励视频展示失败\r\n\t\t\t\t\tif (typeof onFail === 'function') {\r\n\t\t\t\t\t\tonFail(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn Promise.reject(e);\r\n\t\t\t\t})\r\n\t\t\t\t.then((res) => {\r\n\t\t\t\t\t// 成功展示激励视频\r\n\t\t\t\t\tif (typeof onSuccess === 'function') {\r\n\t\t\t\t\t\tonSuccess(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction adErrorHandler(e) {\r\n\t\t\t// 激励广告出错\r\n\t\t\tif (typeof onFail === 'function') {\r\n\t\t\t\tonFail(e);\r\n\t\t\t}\r\n\t\t\tad.offLoad(adLoadHandler);\r\n\t\t\tad.offClose(adCloseHandler);\r\n\t\t\tad.offError(adErrorHandler);\r\n\t\t\tad.destroy();\r\n\t\t}\r\n\r\n\t\tfunction adCloseHandler(e) {\r\n\t\t\t// 用户点击“关闭广告”\r\n\t\t\tif (typeof onClose === 'function') {\r\n\t\t\t\tonClose(e);\r\n\t\t\t}\r\n\t\t\tad.offLoad(adLoadHandler);\r\n\t\t\tad.offClose(adCloseHandler);\r\n\t\t\tad.offError(adErrorHandler);\r\n\t\t\tad.destroy();\r\n\t\t}\r\n\r\n\t\t// 监听加载成功事件\r\n\t\tad.offLoad(adLoadHandler);\r\n\t\tad.onLoad(adLoadHandler);\r\n\r\n\t\t// 监听错误事件\r\n\t\tad.offError(adErrorHandler);\r\n\t\tad.onError(adErrorHandler);\r\n\r\n\t\t// 监听用户关闭事件\r\n\t\tad.offClose(adCloseHandler);\r\n\t\tad.onClose(adCloseHandler);\r\n\r\n\t\t// 加载\r\n\t\tad.load();\r\n\r\n\t\treturn ad;\r\n\t}\r\n\r\n\r\n}\r\n"]}