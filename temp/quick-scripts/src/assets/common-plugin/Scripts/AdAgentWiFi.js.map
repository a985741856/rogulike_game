{"version":3,"sources":["assets\\common-plugin\\Scripts\\AdAgentWiFi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AdAgent from \"./AdAgent\";\r\nimport { BannerLocation } from \"./YZ_Constant\";\r\nimport PlatUtils from \"./PlatUtils\";\r\nimport { utils } from \"./Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class AdAgentWiFi extends AdAgent {\r\n\r\n    _sysData: any = null;\r\n    _curBannerAd: any = null;\r\n    _videoAd: any = null;\r\n    _insertAd: any = null;\r\n    _oldAd: any = null;\r\n    _appBox: any = null; //游戏盒子广告\r\n\r\n    _videoCallback: Function = null;\r\n    _isVideoLoaded: boolean = false;\r\n    _isVideoShow: boolean = false;\r\n    //@ts-ignore\r\n    wuji: any = window.wuji;\r\n    public Init() {\r\n        if (PlatUtils.IsWiFi) {\r\n            utils.registerServerInitEvent(() => {\r\n                this._sysData = utils.wifiTool.getSystemInfo();\r\n            }, this);\r\n        }\r\n    }\r\n\r\n\r\n    public get ServerConfig() {\r\n        return utils.wifiTool.ServerConfig;\r\n    }\r\n\r\n\r\n    _initVideoAd() {\r\n        if (!this._videoAd) {\r\n            utils.showLog(\"初始化视频!\");\r\n\r\n            var example = {\r\n                adUnitId: '', // 该字段必传，值可以先为空\r\n            }\r\n            this._videoAd = this.wuji.createRewardedVideoAd(example);\r\n\r\n            this._videoAd.onLoad(() => {\r\n                utils.showLog('激励视频加载完成');\r\n                this._videoAd\r\n                    .show()\r\n                    .then(() => utils.showLog('激励视频展示成功'))\r\n                    .catch(err => {\r\n                        utils.showLog('激励视频展示失败', err);\r\n                        // 可以手动加载一次\r\n                        this._videoAd\r\n                            .load()\r\n                            .then(() => {\r\n                                utils.showLog(\"手动加载成功\");\r\n                                // 加载成功后需要再显示广告\r\n                                return this._videoAd.show();\r\n                            });\r\n                    });\r\n            });\r\n\r\n            this._videoAd.onError((err) => {\r\n                utils.showLog('激励视频错误', err);\r\n                if (this._videoCallback) {\r\n                    this._videoCallback(false, \"暂无视频广告!\");\r\n                    this._videoCallback = null;\r\n                }\r\n            });\r\n\r\n            this._videoAd.onClose((res) => {\r\n                this._isVideoShow = false;\r\n                if (res.isEnded) {\r\n                    // 正常播放结束，可以下发游戏奖励\r\n                    utils.showLog('激励视频广告完成，发放奖励');\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(true, \"\");\r\n                        this._videoCallback = null;\r\n                    }\r\n                } else {\r\n                    // 播放中途退出，不下发游戏奖励\r\n                    utils.showLog('激励视频广告取消关闭，不发放奖励');\r\n                    if (this._videoCallback) {\r\n                        this._videoCallback(false, \"观看完视频才能获得奖励!\");\r\n                        this._videoCallback = null;\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    _createBanner(location: BannerLocation, args: any = null) {\r\n        if (PlatUtils.IsWiFi) {\r\n\r\n            var { windowWidth, windowHeight } = this._sysData;\r\n            var targetBannerAdWidth = windowWidth - 20;\r\n            var example = {\r\n                adUnitId: '',  // 该字段必传，但是值可以先为空\r\n                style: {\r\n                    top: windowHeight, // 置于屏幕底部\r\n                    left: (windowWidth - targetBannerAdWidth) / 2, // 居中\r\n                    width: targetBannerAdWidth,\r\n                    //height: 200, // 宽高比是固定的，height值可不传\r\n                }\r\n            }\r\n            this._curBannerAd = this.wuji.createBannerAd(example);\r\n            this._curBannerAd.onLoad(() => {\r\n                this._curBannerAd.show()\r\n                    .then(() => utils.showLog('banner ad 展示成功'))\r\n                    .catch(err => utils.showLog(err));\r\n            })\r\n        }\r\n    }\r\n\r\n    _showBannerTimer(location: BannerLocation, args: any) {\r\n        let locationTmp: BannerLocation = location;\r\n        let argsTmp: any = args;\r\n        this._createBanner(locationTmp, argsTmp)\r\n    }\r\n\r\n    ShowInterstitial() {\r\n        utils.showLog(\"连尚小游戏没有插屏广告！\");\r\n    }\r\n\r\n    _bannerShow: boolean = true;\r\n    _showBannerTimerId: number = 0;\r\n    public ShowBanner(location: BannerLocation = BannerLocation.Home, args: any = null) {\r\n        if (PlatUtils.IsWiFi) {\r\n            if (this.ServerConfig) {\r\n                let locationTmp: BannerLocation = location;\r\n                let argsTmp: any = args;\r\n\r\n                let interval: number = 30;\r\n                if (this.ServerConfig.refresh_ad_time) {\r\n                    interval = this.ServerConfig.refresh_ad_time;\r\n                }\r\n\r\n                utils.showLog(`显示Banner广告！location:${locationTmp}; args:${JSON.stringify(argsTmp)}; 间隔时间:${this.ServerConfig.refresh_ad_time}`);\r\n\r\n                var { windowWidth, windowHeight } = this._sysData;\r\n                var targetBannerAdWidth = windowWidth - 20;\r\n                var example = {\r\n                    adUnitId: '',  // 该字段必传，但是值可以先为空\r\n                    adIntervals: interval,\r\n                    style: {\r\n                        top: windowHeight, // 置于屏幕底部\r\n                        left: (windowWidth - targetBannerAdWidth) / 2, // 居中\r\n                        width: targetBannerAdWidth,\r\n                        //height: 200, // 宽高比是固定的，height值可不传\r\n                    }\r\n                }\r\n                if (this._curBannerAd) {\r\n                    this._curBannerAd.offLoad();\r\n                    this._curBannerAd.destroy();\r\n                }\r\n\r\n                this._curBannerAd = this.wuji.createBannerAd(example);\r\n                this._curBannerAd.onLoad(() => {\r\n                    this._curBannerAd.show()\r\n                        .then(() => utils.showLog('banner ad 展示成功'))\r\n                        .catch(err => utils.showLog(err));\r\n                })\r\n\r\n\r\n\r\n\r\n\r\n            } else {\r\n                utils.showLog(\"服务器配置数据未初始化!\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public HideBanner(location: BannerLocation = BannerLocation.Home) {\r\n        if (PlatUtils.IsWiFi) {\r\n            utils.showLog(\"隐藏广告条\");\r\n            this._bannerShow = false;\r\n            clearInterval(this._showBannerTimerId);\r\n            if (this._curBannerAd) {\r\n                this._curBannerAd.hide();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    public ShowVideo(callback: Function) {\r\n        if (PlatUtils.IsWiFi) {\r\n            this._videoCallback = callback;\r\n            this._isVideoShow = true;\r\n\r\n            if (!this._videoAd) {\r\n                this._initVideoAd();\r\n            } else {\r\n                this._videoAd.load();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}