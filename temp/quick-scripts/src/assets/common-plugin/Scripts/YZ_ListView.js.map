{"version":3,"sources":["assets\\common-plugin\\Scripts\\YZ_ListView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { SubLocation } from \"./YZ_Constant\";\r\nimport CompatibleTool from \"./CompatibleTool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class YZ_ListView extends cc.Component {\r\n\r\n    _scrollView: cc.ScrollView = null;\r\n    _content: cc.Node = null;\r\n    _itemObj: cc.Node = null;\r\n\r\n    _visibleCount: number = 5;\r\n    _totalCount: number = 0;\r\n\r\n    _itemSize: cc.Size = cc.size(0, 0);\r\n    _spaceX: number = 0;\r\n    _bannerSize: cc.Size = cc.size(0, 0);\r\n\r\n    _itemArray: cc.Node[] = [];\r\n\r\n    _curOffsetX: number = 0;\r\n    _minOffsetX: number = 0;\r\n    _maxOffsetX: number = 0;\r\n\r\n    // 起始位置的索引值\r\n    _startIndex: number = 0;\r\n    // 滑动方向 -1 向左， 1 向右\r\n    _scrollDir: number = 0;\r\n\r\n    // 交叉推广数据,数组\r\n    _recommendData: any = null;\r\n    _dataDirty: boolean = false;\r\n    _isInit: boolean = false;\r\n    _isScorllBar: boolean = false; //是否滚动条\r\n\r\n    public _location: SubLocation = null; //显示位置\r\n\r\n\r\n    onLoad() {\r\n        this._scrollView = this.getComponent(cc.ScrollView);\r\n        this._content = this._scrollView.content;\r\n        this._itemObj = cc.find(\"GamePage\", this._content);\r\n        this._itemSize = this._itemObj.getContentSize();\r\n        this._startIndex = 0;\r\n        this._bannerSize = this.node.getContentSize();\r\n    }\r\n\r\n    onEnable() {\r\n        this._scrollView.node.on(\"scrolling\", this.OnScroll, this);\r\n        this._scrollView.node.on(\"scroll-ended\", this.onScrollEnded, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this._scrollView.node.targetOff(this);\r\n    }\r\n\r\n    _itemPosX: number = 0;\r\n    _itemtmp: cc.Node = null;\r\n    _itemToCenterLength: number = 0;\r\n    _percent: number = 1;\r\n    update(dt: number) {\r\n        if (this._isInit) {\r\n            if (this._scrollView) {\r\n                if (this._scrollView.isScrolling) {\r\n                    for (let i = 0; i < this._itemArray.length; i++) {\r\n                        this._itemtmp = this._itemArray[i];\r\n                        this._itemToCenterLength = Math.abs(this._itemtmp.x + this._content.x - this._bannerSize.width * 0.5);\r\n                        if ((this._itemSize.width - this._itemToCenterLength) > 0) {\r\n                            this._percent = (this._itemSize.width - this._itemToCenterLength) / this._itemSize.width;\r\n                            // if (!this._isScorllBar) {\r\n                            //     this._itemtmp.scale = 1 + this._percent * 0.2;\r\n                            // }\r\n                        } else {\r\n                            if (!this._isScorllBar) {\r\n                                this._itemtmp.scale = 1;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.autoScroll(dt);\r\n        }\r\n\r\n        if (this._dataDirty) {\r\n            this._dataDirty = false;\r\n            this._updateContent();\r\n        }\r\n    }\r\n\r\n    public init(data: any, isScorllBar: boolean = false) {\r\n        if (data) {\r\n            this._recommendData = data;\r\n            this._totalCount = data.length;\r\n            this._dataDirty = true;\r\n            this._isScorllBar = isScorllBar;\r\n            if (this._isScorllBar) {\r\n                this._location = SubLocation.isScrollbar;\r\n                this._autoScrollInterval = 0.3;\r\n            } else {\r\n                this._location = SubLocation.isYzBanner;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateContent() {\r\n        // 初始化content大小\r\n        let num: number = this._recommendData.length;\r\n        this._content.setContentSize(cc.size(this._itemSize.width * num, this._itemSize.height));\r\n        this.InitObjs();\r\n    }\r\n\r\n    InitObjs() {\r\n        let obj: cc.Node = null;\r\n        for (let i = 0; i < this._totalCount; i++) {\r\n            obj = cc.instantiate(this._itemObj);\r\n            obj.x = this._spaceX * 0.5 + this._itemSize.width * 0.5 + this._itemSize.width * i + this._spaceX * i;\r\n            obj.y = 0;\r\n            obj.getComponentInChildren(\"GameItem\").init(this._recommendData[i], this._location);\r\n            this._content.addChild(obj);\r\n            this._itemArray.push(obj);\r\n        }\r\n\r\n        let unvisibleCount: number = this._totalCount - this._visibleCount;\r\n        this._maxOffsetX = (this._spaceX + this._itemSize.width) * unvisibleCount * -1;\r\n\r\n        this._itemObj.destroy();\r\n\r\n        this._isInit = true;\r\n    }\r\n\r\n    OnScroll(scrollview: cc.ScrollView, eventType: cc.ScrollView.EventType, customEventData: any) {\r\n        this._content.stopAllActions();\r\n        this._canAutoScroll = false;\r\n\r\n        if (this._scrollView.getScrollOffset().x < this._curOffsetX) {\r\n            this._scrollDir = -1;\r\n        } else {\r\n            this._scrollDir = 1;\r\n        }\r\n        this._curOffsetX = this._scrollView.getScrollOffset().x;\r\n\r\n        if (this._scrollView.getScrollOffset().x == 0) {\r\n            // utils.showLog(\"到达最左端......\");\r\n            // 向右滑动，到达最左端\r\n            this._arriveLeft();\r\n        } else if (this._scrollView.getScrollOffset().x == this._maxOffsetX) {\r\n            // utils.showLog(\"到达最右端......\");\r\n            // 向左滑动，到达最右端\r\n            this._arriveRight();\r\n        }\r\n\r\n    }\r\n\r\n    onScrollEnded(scrollview: cc.ScrollView, eventType: cc.ScrollView.EventType, customEventData: any) {\r\n        let stopIdx: number = 0;\r\n        let tmp: number = Math.abs(this._curOffsetX) % (this._itemSize.width + this._spaceX);\r\n        if (tmp > (this._itemSize.width + this._spaceX) * 0.5) {\r\n            // 前进一格\r\n            stopIdx = Math.ceil(Math.abs(this._curOffsetX) / (this._itemSize.width + this._spaceX));\r\n        } else {\r\n            // 后退一格\r\n            stopIdx = Math.floor(Math.abs(this._curOffsetX) / (this._itemSize.width + this._spaceX));\r\n        }\r\n        let posX: number = (this._itemSize.width + this._spaceX) * stopIdx * -1;\r\n        this._curOffsetX = posX;\r\n        this.scroll(posX, 0.3);\r\n    }\r\n\r\n    _arriveLeft() {\r\n        this._scrollView.setContentPosition(CompatibleTool.position(this._maxOffsetX, 0));\r\n        this._curOffsetX = this._maxOffsetX;\r\n        this._startIndex = (this._visibleCount + this._startIndex) % this._totalCount;\r\n        this.refreshItem();\r\n    }\r\n\r\n    _arriveRight() {\r\n        this._scrollView.setContentPosition(CompatibleTool.position(0, 0));\r\n        this._curOffsetX = 0;\r\n        this._startIndex = (this._startIndex + this._totalCount - this._visibleCount) % this._totalCount;\r\n        this.refreshItem();\r\n    }\r\n\r\n    private refreshItem() {\r\n        let posIdx: number = 0;\r\n        let obj: cc.Node = null;\r\n        for (let i = 0; i < this._totalCount; i++) {\r\n            posIdx = (this._totalCount - this._startIndex + i) % this._totalCount;\r\n            obj = this._itemArray[i];\r\n            obj.x = this._spaceX * 0.5 + this._itemSize.width * 0.5 + this._spaceX * posIdx + this._itemSize.width * posIdx;\r\n        }\r\n    }\r\n\r\n    _canAutoScroll: boolean = true;\r\n    _autoScrollInterval: number = 2.5;\r\n    _timeTmp: number = 0;\r\n    autoScroll(dt: number) {\r\n        if (this._canAutoScroll) {\r\n            this._timeTmp += dt;\r\n            if (this._timeTmp >= this._autoScrollInterval) {\r\n                this._timeTmp = 0;\r\n                let posX: number = this._curOffsetX - this._itemSize.width - this._spaceX;\r\n                this._curOffsetX = posX;\r\n                this._scrollDir = -1;\r\n                if (this._isScorllBar) {\r\n                    this.scroll(posX, 0);\r\n                } else {\r\n                    this.scroll(posX, 0.5);\r\n                }\r\n\r\n            }\r\n        } else {\r\n            this._timeTmp = 0;\r\n        }\r\n    }\r\n\r\n    scroll(posX: number, duration: number) {\r\n        this._content.runAction(cc.sequence(cc.moveTo(duration, CompatibleTool.position(posX, 0)), cc.callFunc(() => {\r\n            this._canAutoScroll = true;\r\n            if (this._scrollDir == 1 && this._curOffsetX == 0) {\r\n                this._arriveLeft();\r\n            } else if (this._scrollDir == -1 && this._curOffsetX == this._maxOffsetX) {\r\n                this._arriveRight();\r\n            }\r\n        })));\r\n    }\r\n}\r\n"]}